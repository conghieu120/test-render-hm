import{r as l,k as e,a$ as _,p as B,q as K,j as V,P as G}from"./index-rD5D3wIe.js";import{Q as v}from"./queryKey.const-4yptRpGc.js";import{u as R}from"./useQuery-DGelT77v.js";import{l as M,e as J,f as U}from"./automationService-ItdDN5Ql.js";import{T as N}from"./index-CwHt7GoT.js";import{u as k}from"./useTranslation-CdVDZguR.js";import{P as X}from"./Pagination-Du9klKsI.js";import{L as Y}from"./LogDetails-QJ8vM_Bw.js";import{u as T}from"./theme-CwYL3eQV.js";import{T as Z}from"./Table-CkCjhjFV.js";import{B as j}from"./index-Cnfr_LhE.js";import{I as O}from"./Icon-BO7gCnsj.js";import{T as I}from"./index.esm-76RBLqwT.js";import{c as ee}from"./compareVersion-JynyrHBx.js";import{F as y}from"./index-D0qsI2Ko.js";import{M as te}from"./index-DduQbOjH.js";import{R as se,C as D}from"./row-D9yJnvb0.js";import{S as ae}from"./index-Cw8dqNCZ.js";import{D as oe}from"./index-BtUR3eQT.js";import{T as re}from"./index-WqkPP-4X.js";import{f as ie}from"./index-B3nBNj8d.js";import{T as g}from"./index-e-kTAu8U.js";import"./commonjsHelpers-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./LeftOutlined-hwnj7f46.js";import"./responsiveObserver-CoLEQsUO.js";import"./TextArea-D8GM8mUo.js";import"./index-VaFpLiuL.js";import"./index-R7zUTNyO.js";import"./EyeOutlined-D2K23cwb.js";import"./SearchOutlined-DPpNmpde.js";import"./addEventListener-Dnrwfmdl.js";import"./DownOutlined-U_yyBD4s.js";import"./index-C97G-hLo.js";import"./index-c2ufQ9kY.js";import"./Dropdown-BA274VvY.js";import"./index-BUNugdcr.js";import"./PurePanel-CzAY4fQy.js";import"./extendsObject-BTpHJDoQ.js";import"./EllipsisOutlined-Cvv2ECO7.js";import"./Overflow-wzPxOxK8.js";import"./collapse-C1MjllT7.js";import"./index-DEeuvegC.js";import"./gapSize-U1swVQyS.js";import"./index-Rll6gE4e.js";import"./CheckOutlined-CxcD5R4P.js";import"./index-DQqevswW.js";function le({filterState:t,setFilterState:s}){const[a,n]=l.useState(t.page),[i,u]=l.useState(t.limit),{t:c}=k(),d=(...h)=>{const[m,f]=h;n(m),u(f),s(p=>({...p,page:m,limit:f}))};l.useEffect(()=>{n(t.page),u(t.limit)},[t]);const{data:r}=R({queryFn:()=>M(t),queryKey:[v.scheduleProfileList,t]});return e.jsxs("div",{className:"w-full h-[65px] flex items-center justify-end mt-2 gap-x-[10px] pr-[20px]",children:[e.jsx("div",{children:e.jsx(N,{label:`${c("Total")} : ${r==null?void 0:r.data.data.meta.total}`})}),(r==null?void 0:r.data.data.content.length)>0&&e.jsx(X,{pageSize:isNaN(i)?10:i,current:a,pageSizeOptions:[15,20,50,100],total:r==null?void 0:r.data.meta.total,showQuickJumper:!0,showSizeChanger:!0,onChange:d,locale:{items_per_page:c("page"),jump_to:c("Go to"),page:c("Page")}})]})}const ne={"header-fixed":"_header-fixed_8q965_1"},ce=({columns:t,filterState:s,selectedRowKeys:a,setSelectedRowKeys:n})=>{const i=T(),u=l.useRef(null),[c]=_(),d=c.get("schedule"),{data:r,isLoading:h}=R({queryFn:()=>M({...s,schedule_id:d?Number(d):""}),queryKey:[v.scheduleProfileList,s],refetchOnMount:!0,refetchOnWindowFocus:!0}),f={selectedRowKeys:a,onChange:p=>{n(p)}};return e.jsx("div",{className:"w-full h-[calc(100vh-200px)] overflow-auto pr-4",children:e.jsx(Z,{style:{borderColor:i.borderNormal},className:`${ne["header-fixed"]} w-full`,rowSelection:f,columns:t,dataSource:(r==null?void 0:r.data.data.content)||[],rowKey:"id",loading:h,pagination:!1,ref:u,size:"large"})})};function me({item:t}){const[s]=k(),a=l.useContext(A),n=i=>{i.stopPropagation(),a==null||a.setItemViewLog(!0),a==null||a.setScheduleId(t.id)};return e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsxs("div",{className:"cursor-pointer gap-x-1 flex items-center",onClick:i=>n(i),children:[e.jsx(O.IconWorkLogDetailFigma,{width:16,height:16}),e.jsx(N,{className:"!text-[14px]",label:s("Log Detail")})]})})}const ue={1:{backgroundColor:"#6D6D6D",label:"Pending"},2:{backgroundColor:"#E0822D",label:"Running"},3:{backgroundColor:"#2CDE35",label:"Complete"},4:{backgroundColor:"#EF1517",label:"Error"}};function de({status:t}){const s=ue[t],a=(s==null?void 0:s.backgroundColor)||"",n=(s==null?void 0:s.label)||"";return e.jsx(N,{className:"px-3 py-1 rounded-[5px] text-white text-nowrap",style:{backgroundColor:a},label:n})}const pe=[{title:e.jsx(g,{className:"text-nowrap",title:"No.STT"}),align:"center",render:(t,s,a)=>{const n=s.page?s.page-1:0,i=s.limit||0;return n*i+a+1}},{title:e.jsx(g,{className:"text-nowrap",title:"Uuid"}),align:"center",render:(t,s)=>s.profile_uuid},{title:e.jsx(g,{className:"text-nowrap",title:"Name"}),align:"center",render:(t,s)=>s.profile_name},{title:e.jsx(g,{className:"text-nowrap",title:"Status"}),align:"center",render:(t,s)=>e.jsx(de,{status:s.status})},{title:e.jsx(g,{className:"text-nowrap",title:"Start run time"}),align:"center",dataIndex:"start_run_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"End run time"}),align:"center",dataIndex:"end_run_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"Expected start time"}),align:"center",dataIndex:"start_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"End time"}),align:"center",dataIndex:"end_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"Operation"}),fixed:"right",align:"center",render:t=>e.jsx(me,{item:t})}],xe=({filterState:t,setFilterState:s,selectedRowKeys:a,setSelectedRowKeys:n})=>{const i=T(),[u,c]=l.useState(!1),[d]=_(),[r,h]=l.useState(d.get("campaign")),[m]=y.useForm(),f=B(),{message:p}=K.useApp(),b=V(),{t:o}=k(),$=window.api.APP_VERSION,[P,S]=l.useState(!1);l.useEffect(()=>{h(d.get("campaign"))},[d.get("campaign")]);const q=()=>{s(x=>({...x,page:1,limit:15,status:void 0,startTime:void 0})),m.setFieldValue("status",void 0),m.setFieldValue("startTime",void 0),c(!1)};l.useEffect(()=>{const x=ee($,"4.0.14");S(x!==-1)},[]);const z=()=>{const x=m.getFieldsValue(),C=x.status,E=x.startTime;s(w=>({...w,page:1,status:C,startTime:E})),c(!1)},H=async()=>{await J({ids:a}).then(()=>{n([]),b.invalidateQueries(v.scheduleProfileList),p.success(o("Deleted success")+"!")}).catch(x=>{p.error(x)})},F=async()=>{const x="work_log_"+ie(new Date,"dd_MM_yyyy_HH_mm_ss")+".csv",C={limit:1e4,page:1,status:t.status,startTime:t.startTime};await U({rowSelected:a,filter:C}).then(w=>{const Q={data:w.data,fileName:x};window.api.exportFile(Q).then(W=>{W&&p.success(o("Export Success")+"!")})}).catch(w=>{p.error(w.data.title)})};return e.jsxs("div",{className:"w-full flex gap-x-[10px] py-[10px]",children:[r!==null&&e.jsx(j,{type:"warning",label:o("Back to campaign"),onClick:()=>f(`${G.campaign}/${r}`,{state:{isActiveTabSchedule:!0}})}),e.jsx(j,{onClick:()=>c(!0),type:"primary",buttonMenu:!0,icon:e.jsx(O.IconFilterFigma,{width:"1em",height:"1em"}),label:o("Filter work log")}),a.length>0?e.jsxs("div",{className:"flex gap-x-[10px]",children:[P&&e.jsx(j,{onClick:()=>F(),type:"primary",buttonMenu:!0,icon:e.jsx(I,{}),label:o("Export")}),e.jsx(j,{type:"error",buttonMenu:!0,label:`${o("Delete")} ${a.length} ${a.length>1?o("work logs"):o("work log")}`,onClick:H})]}):P&&e.jsx(j,{onClick:()=>F(),type:"primary",buttonMenu:!0,solid:!0,icon:e.jsx(I,{}),label:o("Export all")}),e.jsx(te,{title:e.jsx("div",{className:"text-[20px]",style:{color:i.textActiveNormal},children:o("Filter work log")}),open:u,onCancel:()=>c(!u),onOk:()=>m.submit(),footer:[e.jsxs("div",{className:"flex justify-end gap-x-5",children:[e.jsx(j,{onClick:q,label:o("Reset"),type:"error",solid:!0},1),e.jsx(j,{type:"primary",onClick:()=>m.submit(),label:o("Filter"),solid:!0},2)]},1)],children:e.jsx(y,{onFinish:z,form:m,layout:"vertical",className:"max-h-[700px] overflow-y-scroll overflow-x-hidden pr-[2px]",initialValues:{status:t.status,createdDate:t.createdDate},children:e.jsxs(se,{gutter:8,children:[e.jsx(D,{span:24,children:e.jsx(y.Item,{label:e.jsx(L,{label:o("Status")}),name:"status",children:e.jsx(ae,{allowClear:!0,placeholder:o("Select status"),options:[{value:"1",label:o("Pending")},{value:"2",label:o("Running")},{value:"3",label:o("Complete")},{value:"4",label:o("Error")}]})})}),e.jsx(D,{span:24,children:e.jsx(y.Item,{label:e.jsx(L,{label:o("Start date")}),name:"startTime",children:e.jsx(oe.RangePicker,{className:"w-full"})})})]})})})]})},L=({label:t})=>e.jsx(re.Text,{className:"font-semibold text-[14px]",children:t}),A=l.createContext(void 0);function nt(){const t=T(),s=V(),[a]=_(),[n,i]=l.useState({page:1,limit:15,schedule_id:"",status:void 0,startTime:void 0}),[u,c]=l.useState(!1),[d,r]=l.useState(0),[h,m]=l.useState([]);l.useEffect(()=>{window.electron.ipcRenderer.on("campaign_reload",()=>{s.invalidateQueries(v.scheduleProfileList)});const p=a.get("schedule");return i(b=>({...b,schedule_id:p||""})),()=>window.electron.ipcRenderer.removeAllListeners("campaign_reload")},[]),l.useEffect(()=>{a.get("schedule")||i(b=>({...b,schedule_id:""}))},[a.get("schedule")]);const f={scheduleId:d,setScheduleId:r,itemViewLog:u,setItemViewLog:c};return e.jsxs(A.Provider,{value:f,children:[e.jsx(xe,{filterState:n,setFilterState:i,selectedRowKeys:h,setSelectedRowKeys:m}),e.jsx("div",{id:"table-hidemium",className:"h-[calc(100vh-200px)] mr-5 rounded-lg border border-solid shadow-sm overflow-auto",style:{backgroundColor:t.backgroundLight,borderColor:t.borderNormal},children:e.jsx(ce,{columns:pe,filterState:n,selectedRowKeys:h,setSelectedRowKeys:m})}),e.jsx(le,{filterState:n,setFilterState:i}),e.jsx(Y,{open:!!u,setOpen:()=>c(!u),id:d,showVariable:!1})]})}export{A as ProfilesCampContext,nt as default};
