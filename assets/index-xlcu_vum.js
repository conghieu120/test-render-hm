import{r as c,j as z,q as O,k as e,fL as H,a7 as qe,P as de,b$ as le,ab as ve,n as we,l as Se,p as _e,G as Ae,a1 as De,s as Be}from"./index-rD5D3wIe.js";import{F as Ne,H as $e}from"./HeaderContext-BALBRazG.js";import{u as D}from"./useQuery-DGelT77v.js";import{u as ze,d as Oe,b as ue,i as He,j as Ke,s as me,g as Re,k as We,m as Ve,n as Ge,o as Qe,p as Ye}from"./automationService-ItdDN5Ql.js";import{Q as $}from"./queryKey.const-4yptRpGc.js";import{u as ie}from"./useMutation-7pHNuXnK.js";import{B as N}from"./index-Cnfr_LhE.js";import{D as fe}from"./DeleteConfirmModal-DSBDXsxU.js";import{u as T}from"./useTranslation-CdVDZguR.js";import{T as F}from"./index-CwHt7GoT.js";import{T as I}from"./index-e-kTAu8U.js";import{f as he}from"./index-B3nBNj8d.js";import{T as ee}from"./Table-CkCjhjFV.js";import{F as w}from"./index-D0qsI2Ko.js";import{I as X}from"./index-R7zUTNyO.js";import{E as ge,S as ne}from"./index-Cw8dqNCZ.js";import{d as se}from"./index.esm-pljYh1ir.js";import{u as G}from"./theme-CwYL3eQV.js";import{f as Je,g as je,h as Ze,i as Ee}from"./index.esm-By9H6xJu.js";import{C as Xe}from"./index.esm-Clfs4ZBd.js";import{B as Ue}from"./BrowserIcon-BnKFWsow.js";import{T as oe}from"./index-BUNugdcr.js";import{f as et}from"./index-uI2PeSUX.js";import{T as Ce}from"./index-Phk2fyGs.js";import{P as U}from"./Pagination-Du9klKsI.js";import{M as te}from"./index-DduQbOjH.js";import{D as xe}from"./index-CLJiH4Bi.js";import{I as tt}from"./Icon-BO7gCnsj.js";import{f as at}from"./folderService-DJTjQCA7.js";import{c as st}from"./compareVersion-JynyrHBx.js";import{I as K}from"./index-Bn6pjTd0.js";import{S as J}from"./index-DeZc1mMx.js";import{D as ce,d as Z}from"./index-BtUR3eQT.js";import{S as rt}from"./index-DEeuvegC.js";import{R as V}from"./index-Rll6gE4e.js";import{g as lt}from"./PurePanel-CzAY4fQy.js";import"./commonjsHelpers-BosuxZz1.js";import"./row-D9yJnvb0.js";import"./responsiveObserver-CoLEQsUO.js";import"./utils-Dji2qSVF.js";import"./index-bFDahTXa.js";import"./index-WqkPP-4X.js";import"./index-VaFpLiuL.js";import"./TextArea-D8GM8mUo.js";import"./CheckOutlined-CxcD5R4P.js";import"./index-DQqevswW.js";import"./addEventListener-Dnrwfmdl.js";import"./DownOutlined-U_yyBD4s.js";import"./index-C97G-hLo.js";import"./index-c2ufQ9kY.js";import"./LeftOutlined-hwnj7f46.js";import"./Dropdown-BA274VvY.js";import"./extendsObject-BTpHJDoQ.js";import"./EllipsisOutlined-Cvv2ECO7.js";import"./Overflow-wzPxOxK8.js";import"./collapse-C1MjllT7.js";import"./SearchOutlined-DPpNmpde.js";import"./EyeOutlined-D2K23cwb.js";import"./index-BMo3QHL0.js";import"./PlusOutlined-02efxpe5.js";import"./gapSize-U1swVQyS.js";var it=function(t,a){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&a.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,s=Object.getOwnPropertySymbols(t);u<s.length;u++)a.indexOf(s[u])<0&&Object.prototype.propertyIsEnumerable.call(t,s[u])&&(r[s[u]]=t[s[u]]);return r};const{TimePicker:nt,RangePicker:ot}=ce,ct=c.forwardRef((t,a)=>c.createElement(ot,Object.assign({},t,{picker:"time",mode:void 0,ref:a}))),Q=c.forwardRef((t,a)=>{var{addon:r,renderExtraFooter:s}=t,u=it(t,["addon","renderExtraFooter"]);const f=c.useMemo(()=>{if(s)return s;if(r)return r},[r,s]);return c.createElement(nt,Object.assign({},u,{mode:void 0,ref:a,renderExtraFooter:f}))}),Fe=lt(Q,"picker");Q._InternalPanelDoNotUseOrYouWillBeFired=Fe;Q.RangePicker=ct;Q._InternalPanelDoNotUseOrYouWillBeFired=Fe;const re=Q;var Pe=(t=>(t[t.ONCE=1]="ONCE",t[t.INTERVAL=2]="INTERVAL",t[t.DAILY=3]="DAILY",t[t.WEEKLY=4]="WEEKLY",t[t.MONTHLY=5]="MONTHLY",t))(Pe||{}),q=(t=>(t[t.PENDING=1]="PENDING",t[t.RUNNING=2]="RUNNING",t[t.COMPLETE=3]="COMPLETE",t[t.STOP=4]="STOP",t))(q||{}),ke=(t=>(t[t.COMMON=1]="COMMON",t[t.SCHEDULE=2]="SCHEDULE",t))(ke||{});function dt({record:t}){const a=z(),{message:r,modal:s}=O.useApp(),{t:u}=T(),{mutate:f}=ie({mutationFn:o=>ze(t.id,o),onSuccess:()=>{a.invalidateQueries($.schedule),t.status===q.PENDING?r.success("Schedule start success!"):t.status===q.RUNNING&&r.success("Schedule stop success!")},onError:()=>{t.status===q.PENDING?r.error("Schedule start error!"):t.status===q.RUNNING&&r.error("Schedule stop error!")}}),{mutate:d}=ie({mutationFn:()=>Oe([t.id]),onSuccess:()=>{a.invalidateQueries($.schedule),r.success("Schedule deleted success!")},onError:()=>{r.error("Schedule delete error!")}}),x=()=>{fe({html:'<div>You want to <b style="color:red">delete</b> this schedule</div>'}).then(async p=>{p.isConfirmed&&d()})},y=()=>{fe({html:"<div>You want to <b>stop</b> this schedule</div>"}).then(async p=>{p.isConfirmed&&f("STOP")})};return e.jsx(e.Fragment,{children:t.status===q.COMPLETE||t.status===q.STOP?e.jsx(N,{label:u("Delete"),classStyle:"w-fit m-auto",type:"error",solid:1,onClick:o=>{o.stopPropagation(),x()}}):t.status===q.PENDING?e.jsx(N,{label:u("Start"),classStyle:"w-fit m-auto",onClick:o=>{o.stopPropagation(),f("RUNNING")}}):t.status===q.RUNNING?e.jsx(N,{label:u("Stop"),classStyle:"w-fit m-auto",type:"warning",solid:1,onClick:o=>{o.stopPropagation(),y()}}):null})}const ut=({record:t})=>{const a=H();return e.jsx(qe,{to:`${de.work_log}?campaign=${a.campaign_id}&schedule=${t.id}`,children:e.jsx(F,{className:"!text-[14px]",label:t.name})})},mt=({idx:t})=>{const a=c.useContext(pe),r=(a==null?void 0:a.filterSchedule.page)-1;return e.jsx(e.Fragment,{children:r*(a==null?void 0:a.filterSchedule.limit)+t+1})},ye=({text:t})=>{const{t:a}=T();return e.jsx("span",{children:a(t)})},xt=[{title:e.jsx(I,{title:"No.STT"}),width:"5%",render:(t,a,r)=>e.jsx(mt,{idx:r})},{title:e.jsx(I,{title:"Name"}),dataIndex:"name",render:(t,a)=>e.jsx(ut,{record:a})},{title:e.jsx(I,{title:"Execution frequency"}),dataIndex:"execution_frequency",render:(t,a)=>e.jsx(ye,{text:Pe[t]||ke[a.task_type]})},{title:e.jsx(I,{title:"Execution time"}),align:"center",dataIndex:"execute_time"},{title:e.jsx(I,{title:"Start time"}),dataIndex:"start_time",render:t=>t?he(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(I,{title:"End time"}),dataIndex:"end_time",render:t=>t?he(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(I,{title:"Total profile pending"}),align:"center",dataIndex:"total_profile_pending"},{title:e.jsx(I,{title:"Total profile running"}),align:"center",dataIndex:"total_profile_running"},{title:e.jsx(I,{title:"Total profile success"}),align:"center",dataIndex:"total_profile_success"},{title:e.jsx(I,{title:"Total profile error"}),align:"center",dataIndex:"total_profile_error"},{title:e.jsx(I,{title:"Status"}),dataIndex:"status",render:t=>e.jsx(ye,{text:q[t]})},{title:e.jsx(I,{title:"Action"}),align:"center",render:(t,a)=>e.jsx(dt,{record:a})}];function pt(){const t=c.useContext(pe),{campaign_id:a}=H(),{data:r}=D({queryKey:[$.schedule,a,t==null?void 0:t.filterSchedule],queryFn:()=>ue({campaign_id:a,...t==null?void 0:t.filterSchedule}),refetchOnMount:!0,refetchOnWindowFocus:!0});return e.jsx(ee,{dataSource:(r==null?void 0:r.schedules)||[],columns:xt,rowKey:"id",pagination:!1})}const pe=c.createContext(void 0);function ft({filterSchedule:t,setFilterSchedule:a}){const r={filterSchedule:t,setFilterSchedule:a};return e.jsx(pe.Provider,{value:r,children:e.jsx("div",{className:"my-4",children:e.jsx(pt,{})})})}const ht=({campaign:t,arrayField:a,setArrayField:r})=>{c.useEffect(()=>{if(t){const u=JSON.parse(t.variable);r(u)}},[t]);const s=(u,f)=>{const d=[...a];d[f].data=u,r(d)};return e.jsx("div",{className:"w-full h-full",children:e.jsx(w,{children:e.jsx("div",{className:"w-[100%] md:w-[50%] h-full flex flex-col gap-y-[20px]",children:a&&a.length>0?a.map((u,f)=>e.jsx("div",{className:"flex flex-row gap-x-[20px]",children:e.jsxs("div",{className:"flex flex-row gap-x-[20px] items-center",children:[e.jsx(X,{disabled:!0,value:u.label,placeholder:"Please Input"}),"=",e.jsx(X,{placeholder:"Name",value:u.data,onChange:d=>s(d.target.value,f)})]})},f)):e.jsx("div",{className:"",children:e.jsx(ge,{image:ge.PRESENTED_IMAGE_SIMPLE})})})})})},gt=({data:t})=>{const a=H(),{message:r}=O.useApp(),s=z(),{t:u}=T(),f=async()=>{const d={campaign_id:a.campaign_id,profile_uuid:t.uuid},x=await He(d);x.data.type==="success"?(s.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),s.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0}),r.success(x.data.title)):x.data.type==="error"&&r.error(x.data.title)};return e.jsx("div",{className:"w-full h-full flex flex-row gap-x-[5px] justify-center items-center cursor-pointer",children:e.jsx(N,{label:u("Remove"),type:"error",solid:!0,onClick:f})})},jt=()=>{const t=G();return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:t.textActiveNormal},children:"Uuid || "}),"  ",e.jsx(I,{title:"Name"})]})},yt=[{title:e.jsx(jt,{}),dataIndex:"name",className:"text-[16px]",sorter:!0,showSorterTooltip:!1,width:250,render:(t,a)=>a.name||a.uuid},{title:e.jsx(I,{title:"Action"}),className:"text-[14px]",width:120,align:"center",render:(t,a)=>e.jsx(gt,{data:a})}],bt=()=>{const t=c.useContext(Y),a=H(),[r,s]=c.useState({orderByNo:0,orderByName:0,orderByCreatedAt:0}),u=o=>{t==null||t.setSelectedRowKeysIndex(o)},f={selectedRowKeys:t==null?void 0:t.selectedRowKeysIndex,onChange:u},{data:d}=D({queryFn:()=>Ke({campaign_id:a.campaign_id||""}),queryKey:["List_Profile_By_Campaign_Id",a.campaign_id],onSuccess:({data:o})=>{t==null||t.setDataSelectedKey(o.data),typeof(o==null?void 0:o.data[0])=="object"&&(t==null||t.setRows(o.data))}}),{data:x}=D({queryFn:()=>{var p,j,m,i,h;const o=((p=d==null?void 0:d.data)==null?void 0:p.data[0])||{},l=((m=(j=d==null?void 0:d.data)==null?void 0:j.data)==null?void 0:m.length)||0;if(typeof o!="object")return o!=null&&o.includes("local-")?le({browser_uuid:(i=d==null?void 0:d.data)==null?void 0:i.data,limit:l},"local"):le({browser_uuid:(h=d==null?void 0:d.data)==null?void 0:h.data,limit:l},"cloud")},queryKey:["List_Profile_Campaign",d],onSuccess:o=>{const{data:l}=o||{};l!=null&&l.data.content&&(t==null||t.setRows(l==null?void 0:l.data.content))}});c.useEffect(()=>{var C,g;const o=typeof((C=d==null?void 0:d.data)==null?void 0:C.data[0])=="object"?(g=d==null?void 0:d.data)==null?void 0:g.data:x==null?void 0:x.data.data.content,{page:l=1,limit:p=10}=t==null?void 0:t.filterProfile,{orderByName:j}=r;let m=o||[];(j===1||j===2)&&(m=ve.orderBy(o,["name"],[j===1?"asc":"desc"]));const i=(l-1)*p,h=i+p,S=m.slice(i,h);t==null||t.setRows(S)},[d,x,t==null?void 0:t.filterProfile,r]);const y=(o,l,p,j)=>{const{field:m,order:i}=p;switch(m){case"name":s(i==="ascend"?h=>({...h,orderByCreatedAt:0,orderByName:1}):i==="descend"?h=>({...h,orderByCreatedAt:0,orderByName:2}):h=>({...h,orderByCreatedAt:0,orderByName:0}));break;case"created_at_diff":s(i==="ascend"?h=>({...h,orderByName:0,orderByCreatedAt:1}):i==="descend"?h=>({...h,orderByName:0,orderByCreatedAt:2}):h=>({...h,orderByName:0,orderByCreatedAt:0}));break}};return e.jsx("div",{className:"",children:e.jsx(ee,{dataSource:t==null?void 0:t.rows,rowSelection:f,columns:yt,rowKey:"uuid",size:"small",onChange:y,pagination:!1})})};function vt({data:t}){const{theme:a}=we(s=>s.display),r=c.useRef(null);return e.jsx(Se,{theme:{token:{colorBgSpotlight:`${a==="light"?"#FFFFFF":"#39383F"}`,colorTextLightSolid:`${a==="light"?"#000000":"#FFFFFF"}`}},children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("div",{className:"w-fit",children:e.jsx("div",{className:"text-[14px] flex items-center cursor-texts",children:e.jsx(oe,{placement:"right",title:t.name,children:e.jsx("span",{ref:r,className:"w-[145px] ml-[2px] text-ellipsis-1-line text-start border rounded-[3px] border-solid border-transparent transtion duration-150",children:t.name})})})}),e.jsx("div",{className:"flex flex row items-center",children:e.jsxs("div",{className:"flex flex-col flex-nowrap justify-center items-center",children:[(t==null?void 0:t.os)&&((t==null?void 0:t.os)==="win"?e.jsx(Je,{className:"text-[#0078D4]"}):t.os==="mac"?e.jsx(je,{className:"text-[#A6B1B7]"}):t.os==="lin"?e.jsx(Ze,{}):t.os==="android"?e.jsx(Ee,{className:"text-[#AAC148]"}):t.os==="ios"?e.jsx(je,{className:"text-[#A6B1B7]"}):e.jsx(Xe,{className:"text-[#A6B1B7]"})),e.jsx(oe,{placement:"bottom",title:t.source_version,children:e.jsxs("div",{className:"flex gap-x-[5px] flex-nowrap items-center justify-center",children:[e.jsx("span",{className:"mb-[5px]",children:e.jsx(Ue,{browserType:t.browser,width:16,height:16})}),e.jsxs("span",{className:"text-[14px]",children:["/ ",t.version]})]})})]})})]})})}const wt=[{title:e.jsx(I,{title:"Name"}),dataIndex:"name",className:"text-[14px]",sorter:!0,showSorterTooltip:!1,render:(t,a)=>e.jsx(vt,{data:a})},{title:e.jsx(I,{title:"Created at"}),align:"center",sorter:!0,showSorterTooltip:!1,dataIndex:"created_at_diff",className:"text-[14px]",width:200,render:(t,a)=>e.jsx("span",{children:a.created_at_diff?a.created_at_diff:et(new Date(a.created_at),new Date,{addSuffix:!0}).replace("about","")})}],St=[{title:"Profile",key:"profile"},{title:"Profile local",key:"profile_local"}],_t=({setListProfileSelected:t,selectedRowKeys:a,setSelectedRowKeys:r,tabActive:s,setActive:u})=>{const[f,d]=c.useState([]),[x,y]=c.useState("cloud"),[o,l]=c.useState({dataFilter:{page:1,limit:10,search:"",name:[],browser_uuid:[],orderName:0,orderLastOpen:0}}),[p,j]=c.useState(""),{t:m}=T(),i=()=>{const b=St.map(_=>({key:_.key,label:m(_.title)}));d(b)};c.useEffect(()=>{i(),j("")},[s]);const h=b=>{r([]),u(b)},C={selectedRowKeys:a,onChange:b=>{r(b)}},g=(...b)=>{const[_,A]=b;l(L=>({...L,dataFilter:{...L.dataFilter,page:_,limit:A}}))};c.useEffect(()=>{switch(s){case"profile":y("cloud");break;case"profile_local":y("local");break;default:y("cloud");break}},[s]);const{data:n}=D({queryFn:()=>le(o.dataFilter,x),queryKey:["List_Profile_Campaign",o.dataFilter,x]});c.useEffect(()=>{const b=n==null?void 0:n.data.data.content.filter(_=>a.includes(_.uuid)).map(_=>({uuid:_.uuid,name:_.name}));t(b||[])},[a]);const v=(b,_,A,L)=>{const{field:ae,order:R}=A;switch(ae){case"name":l(R==="ascend"?P=>({...P,dataFilter:{...P.dataFilter,orderName:1}}):R==="descend"?P=>({...P,dataFilter:{...P.dataFilter,orderName:2}}):P=>({...P,dataFilter:{...P.dataFilter,orderName:0}}));break;case"created_at_diff":l(R==="ascend"?P=>({...P,dataFilter:{...P.dataFilter,orderLastOpen:1}}):R==="descend"?P=>({...P,dataFilter:{...P.dataFilter,orderLastOpen:2}}):P=>({...P,dataFilter:{...P.dataFilter,orderLastOpen:0}}));break}},k=b=>{b===""||b===null?l(_=>({..._,dataFilter:{..._.dataFilter,name:[],browser_uuid:[]}})):b.includes("-")?l(_=>({..._,dataFilter:{..._.dataFilter,name:[],browser_uuid:[b]}})):l(_=>({..._,dataFilter:{..._.dataFilter,name:[b],browser_uuid:[]}}))};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{defaultActiveKey:s,activeKey:s,items:f,onChange:h}),e.jsxs("div",{className:"pb-[24px] flex gap-x-[10px]",children:[e.jsx(Ne,{placeholder:"search by uuid/name",onClickSearch:b=>k(b),onChange:b=>j(b.target.value),value:p,onPressEnter:b=>{k(b.target.value)}}),e.jsx(N,{onClick:()=>k(p),type:"primary",label:m("search"),solid:!0})]}),e.jsx("div",{className:"max-h-[400px] overflow-auto",children:e.jsx(ee,{rowSelection:C,columns:wt,dataSource:n==null?void 0:n.data.data.content,size:"small",pagination:!1,rowKey:"uuid",onChange:v})}),e.jsxs("div",{className:"w-full flex justify-end mt-[20px] items-center gap-x-[5px]",children:[e.jsx("div",{children:e.jsx("span",{children:`${n!=null&&n.data.meta.total?`${m("Profiles")}: ${(n==null?void 0:n.data.meta.total)||0}`:`${m("Profile")}: ${(n==null?void 0:n.data.meta.total)||0}`}`})}),e.jsx(U,{size:"small",showTitle:!1,showQuickJumper:!0,pageSize:o.dataFilter.limit,current:o.dataFilter.page,pageSizeOptions:[10,20,50,100,200],total:n==null?void 0:n.data.meta.total,onChange:g,showSizeChanger:!0,locale:{page:m("Page"),items_per_page:m("page"),jump_to:m("Go to")}})]})]})},Nt=({isOpen:t,setOpen:a})=>{const r=G(),[s,u]=c.useState([]),[f,d]=c.useState([]),[x,y]=c.useState("profile"),o=c.useContext(Y),{message:l}=O.useApp(),p=z(),{t:j}=T(),m=async()=>{s.length>0?i(f):l.error("Please select profile!")},i=async h=>{const S=o==null?void 0:o.campaign,C={campaign_id:S.id,listProfile:h,user_uuid:S.user_uuid,profile_uuid:h.map(g=>g.uuid)};await me(C).then(g=>{g.data.type==="success"?l.success(g.data.title):g.data.type==="error"&&l.error(g.data.title)}).catch(g=>{l.error(g)}),a(!1),p.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),p.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0})};return c.useEffect(()=>{t&&(p.invalidateQueries("List_Profile_Campaign",{refetchInactive:!0}),p.invalidateQueries("List_Profile_Campaign_Local",{refetchInactive:!0}),p.invalidateQueries("List_Folder_Campaign",{refetchInactive:!0}),u([]))},[t]),e.jsx(e.Fragment,{children:e.jsx(te,{centered:!0,style:{height:"674px",minHeight:"674px"},width:756,title:e.jsx(F,{size:"2xl",color:r.textActiveNormal,label:j("Quickly add profile")}),open:t,onCancel:()=>a(!t),maskClosable:!1,footer:e.jsxs("div",{children:[e.jsx(xe,{}),e.jsxs("div",{className:"w-full flex justify-end gap-x-[5px]",children:[e.jsx(N,{type:"mono",solid:!0,onClick:()=>a(!t),label:j("Cancel")}),e.jsx(N,{type:"primary",onClick:m,solid:!0,label:j("Add")})]})]},1),children:e.jsx(_t,{setListProfileSelected:d,selectedRowKeys:s,setSelectedRowKeys:u,tabActive:x,setActive:y})})})};function Ct({data:t}){const{theme:a}=we(s=>s.display),r=c.useRef(null);return e.jsx(Se,{theme:{token:{colorBgSpotlight:`${a==="light"?"#FFFFFF":"#39383F"}`,colorTextLightSolid:`${a==="light"?"#000000":"#FFFFFF"}`}},children:e.jsx("div",{className:"w-full flex items-center justify-between",children:e.jsx("div",{className:"w-fit",children:e.jsx("div",{className:"text-[14px] flex items-center cursor-texts",children:e.jsx(oe,{placement:"right",title:t.name,children:e.jsx("span",{ref:r,className:"w-[145px] ml-[2px] text-ellipsis-1-line text-start border rounded-[3px] border-solid border-transparent transtion duration-150",children:t.name})})})})})})}const Ft=[{title:e.jsx(I,{title:"Folder name"}),dataIndex:"name",className:"text-[14px]",render:(t,a)=>e.jsx(Ct,{data:a})}],Pt=[{title:"Folder",key:"folder"},{title:"Folder local",key:"folder_local"}],kt=({selectedRowKeys:t,setSelectedRowKeys:a,tabActive:r,setActive:s})=>{const[u,f]=c.useState([]),[d,x]=c.useState("cloud"),[y,o]=c.useState({dataFilter:{page:1,limit:10,search:""}}),{t:l}=T(),[p,j]=c.useState(""),m=()=>{const v=Pt.map(k=>({key:k.key,label:l(k.title)}));f(v)};c.useEffect(()=>{m(),j("")},[r]);const i=v=>{a([]),s(v)},S={selectedRowKeys:t,onChange:v=>{a(v)}},C=(...v)=>{const[k,b]=v;o(_=>({..._,dataFilter:{..._.dataFilter,page:k,limit:b}}))};c.useEffect(()=>{switch(r){case"folder":x("cloud");break;case"folder_local":x("local");break;default:x("cloud");break}},[r]);const{data:g}=D({queryFn:()=>at(y.dataFilter,d),queryKey:["List_Folder_Campaign",y.dataFilter,d]}),n=v=>{o(k=>({...k,dataFilter:{...k.dataFilter,search:v}}))};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{defaultActiveKey:r,activeKey:r,items:u,onChange:i}),e.jsxs("div",{className:"pb-[24px] flex gap-x-[10px]",children:[e.jsx(Ne,{placeholder:"search by folder name",onClickSearch:v=>n(v),onChange:v=>j(v.target.value),value:p,onPressEnter:v=>{n(v.target.value)}}),e.jsx(N,{onClick:()=>n(p),type:"primary",label:l("search"),solid:!0})]}),e.jsx("div",{className:"max-h-[400px] overflow-auto",children:e.jsx(ee,{rowSelection:S,columns:Ft,dataSource:g==null?void 0:g.data.data.content,size:"small",pagination:!1,rowKey:"id"})}),e.jsxs("div",{className:"w-full flex justify-end mt-[20px] items-center gap-x-[5px]",children:[e.jsx("div",{children:e.jsx("span",{children:`${g!=null&&g.data.meta.total?`${l("Folders")}: ${g==null?void 0:g.data.meta.total}`:`${l("Folder")}: ${g==null?void 0:g.data.meta.total}`}`})}),e.jsx(U,{size:"small",showTitle:!1,showQuickJumper:!0,pageSize:y.dataFilter.limit,current:y.dataFilter.page,pageSizeOptions:[10,20,50,100,200],total:g==null?void 0:g.data.meta.total,onChange:C,showSizeChanger:!0,locale:{items_per_page:l("page"),jump_to:l("Go to"),page:l("Page")}})]})]})},It=({isOpen:t,setOpen:a})=>{const r=G(),[s,u]=c.useState([]),[f,d]=c.useState("folder"),x=c.useContext(Y),{message:y}=O.useApp(),o=z(),{t:l}=T(),p=async()=>{if(s.length>0){let m=!1;f==="folder_local"&&(m=!0),Promise.all(s.map(async i=>(await Re(i,m)).data.content)).then(i=>{const h=i.flat();j(h)}).catch(i=>{console.error("Error:",i)})}else y.error("Please select profile!")},j=async m=>{const i=x==null?void 0:x.campaign,h={campaign_id:i.id,listProfile:m,profile_uuid:m.map(S=>typeof S=="string"?S:S.uuid),user_uuid:i.user_uuid};await me(h).then(S=>{S.data.type==="success"?y.success(S.data.title):S.data.type==="error"&&y.error(S.data.title)}).catch(S=>{y.error(S.message||"Insert profile failed!")}),a(!1),o.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),o.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0})};return c.useEffect(()=>{t&&(o.invalidateQueries("List_Profile_Campaign",{refetchInactive:!0}),o.invalidateQueries("List_Profile_Campaign_Local",{refetchInactive:!0}),o.invalidateQueries("List_Folder_Campaign",{refetchInactive:!0}),u([]))},[t]),e.jsx(e.Fragment,{children:e.jsx(te,{centered:!0,style:{height:"674px",minHeight:"674px"},width:756,title:e.jsx(F,{size:"2xl",color:r.textActiveNormal,label:l("Quickly add folder")}),open:t,onCancel:()=>a(!t),maskClosable:!1,footer:e.jsxs("div",{children:[e.jsx(xe,{}),e.jsxs("div",{className:"w-full flex justify-end gap-x-[5px]",children:[e.jsx(N,{type:"mono",solid:!0,onClick:()=>a(!t),label:l("Cancel")}),e.jsx(N,{type:"primary",onClick:p,solid:!0,label:l("Add")})]})]},1),children:e.jsx(kt,{selectedRowKeys:s,setSelectedRowKeys:u,tabActive:f,setActive:d})})})},Tt=({isOpen:t,setOpen:a})=>{const r=G(),[s]=T(),[u]=w.useForm(),f=c.useContext(Y),{message:d}=O.useApp(),x=z(),y=async()=>{const o=await u.validateFields().catch(()=>null);if(!o)return;const l=f==null?void 0:f.campaign,p=await(o==null?void 0:o.listUuid.split(`
`).filter(m=>m.includes("-")).map(m=>({uuid:m.trim()})));if(ve.isEmpty(p)){d.error("not correct format.");return}const j={campaign_id:l.id,listProfile:p,profile_uuid:p.map(m=>m.uuid),user_uuid:l.user_uuid};try{const m=await me(j);m.data.type==="success"?(d.success(m.data.title),x.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),x.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0}),a(!1)):m.data.type==="error"&&d.error(m.data.title)}catch(m){d.error(m.message)}};return c.useEffect(()=>{t&&u.resetFields()},[t]),e.jsx(te,{centered:!0,style:{height:"674px",minHeight:"674px"},width:756,title:e.jsx(F,{size:"2xl",color:r.textActiveNormal,label:s("Add by uuid")}),open:t,onCancel:()=>a(!t),maskClosable:!0,footer:e.jsxs("div",{children:[e.jsx(xe,{}),e.jsxs("div",{className:"w-full flex justify-end gap-x-[5px]",children:[e.jsx(N,{type:"mono",solid:!0,onClick:()=>a(!t),label:s("Cancel")}),e.jsx(N,{type:"primary",onClick:y,solid:!0,label:s("Add")})]})]},1),children:e.jsxs(w,{form:u,layout:"vertical",onFinish:y,children:[e.jsx(Mt,{label:"Uuid",required:!0}),e.jsx(w.Item,{name:"listUuid",label:"",rules:[{required:!0,message:s("This field is required.")}],children:e.jsx(X.TextArea,{rows:6,placeholder:`00e297bc-20a0-482c-a67e-7014dd9b38f0
62603ad9-ff17-432c-b4e5-8b9278ed87c1
...`})})]})})},Mt=({label:t,required:a})=>{const[r]=T();return e.jsxs("div",{className:"flex items-center flex-row gap-x-[3px]",children:[e.jsx(F,{className:"!textx-[14px] font-semibold",label:r(t)}),a&&e.jsx("span",{className:"text-red-700",children:"*"})]})},Y=c.createContext(void 0),Lt=({campaign:t,filterProfile:a,setFilterProfile:r})=>{const[s,u]=c.useState(!1),[f,d]=c.useState(!1),[x,y]=c.useState(!1),[o,l]=c.useState([]),[p,j]=c.useState([]),{message:m}=O.useApp(),[i]=T(),h=_e(),[S,C]=c.useState([]),[g,n]=c.useState(0),v=z(),k=H(),b={dataSelectedKey:o,setDataSelectedKey:l,selectedRowKeysIndex:p,setSelectedRowKeysIndex:j,rows:S,setRows:C,campaign:t,totalProfile:g,setTotalProfile:n,filterProfile:a,setFilterProfile:r},_=async()=>{const A={campaign_id:k.campaign_id,profile_uuid:typeof p=="string"?[p]:p},L=await We(A);L.data.type==="success"?(v.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),v.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0}),j([]),m.success(L.data.title)):L.data.type==="error"&&m.error(L.data.title)};return e.jsx(Y.Provider,{value:b,children:e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-full flex",children:e.jsxs("div",{className:"flex justify-start gap-x-[10px]",children:[e.jsx(N,{onClick:()=>h(de.campaign),label:i("Back"),buttonMenu:!0,type:"warning"}),e.jsx(N,{type:"primary",icon:e.jsx(se,{}),label:i("Add profile"),buttonMenu:!0,onClick:()=>u(!0)}),e.jsx(N,{type:"primary",icon:e.jsx(se,{}),label:i("Add folder"),buttonMenu:!0,onClick:()=>d(!0)}),e.jsx(N,{type:"primary",icon:e.jsx(se,{}),label:i("Add by uuid"),buttonMenu:!0,onClick:()=>y(!0)}),p.length>0&&e.jsx(N,{type:"error",buttonMenu:!0,icon:e.jsx("span",{children:e.jsx(tt.IconDeleteFigma,{width:12,height:12})}),label:`${i("Remove")} ${p.length} ${p.length>1?i("profiles"):i("profile")}`,onClick:_})]})}),e.jsx("div",{className:"py-[20px]",children:e.jsx(bt,{})}),e.jsx(Nt,{isOpen:s,setOpen:u}),e.jsx(It,{isOpen:f,setOpen:d}),e.jsx(Tt,{isOpen:x,setOpen:y})]})})},qt=["auto"],At=({campaign:t,form:a})=>{const r=G(),[s,u]=c.useState(!1),[f,d]=c.useState(!1),[x,y]=c.useState(qt),[o,l]=c.useState(!1),[p,j]=c.useState(""),[m,i]=c.useState(""),{t:h}=T();w.useWatch("profilePerWorker",a),c.useEffect(()=>{if(t){const n=JSON.parse(t.settings);a.setFieldValue("automationProcess",n.profileThread),a.setFieldValue("delayOpen",n.delayOpen),a.setFieldValue("isScreenArrangement",n.isScreenArrangement),a.setFieldValue("arrangementLayoutCol",n.arrangementLayoutCol),a.setFieldValue("arrangementLayoutRow",n.arrangementLayoutRow),a.setFieldValue("screenScalePercent",n.screenScalePercent),a.setFieldValue("autoScaleScreen",n.autoScreenScale),a.setFieldValue("screenSize",n.screenSize),a.setFieldValue("isSetWindowSize",n.isSetWindowSize),a.setFieldValue("profilePerWorker",n.profilePerWorker||10),a.setFieldValue("writeLogs",n.writeLogs!==!1),u(n.autoScreenScale),d(n.isScreenArrangement),y(v=>v.includes(n.screenSize)?[...v]:[...v,n.screenSize])}},[t]);const S=()=>{i("")},C=()=>{p.includes("x")?(y(v=>[...v,p]),a.setFieldValue("screenSize",p),l(!1),i("")):i(`${h("Please enter the following format")} [${h("width")}]x[${h("height")}]. ${h("Ex")}: 1280x800.`)},g=n=>{x.some(k=>k.includes(n.toLowerCase()))?l(!1):(l(!0),j(n))};return e.jsx("div",{style:{backgroundColor:r.backgroundNormal},className:"h-full w-full",children:e.jsx("div",{className:"h-full pb-[26px] pl-2 pr-[30px]",children:e.jsx("div",{className:"mt-4 font-semibold text-[15px]",children:e.jsxs(w,{layout:"vertical",form:a,style:{width:"720px"},children:[e.jsxs("div",{children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Automation processing"}),e.jsx(w.Item,{name:"automationProcess",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,placeholder:"Number of Automation Processing",className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Delay open (Seconds)"}),e.jsx(w.Item,{name:"delayOpen",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:0,placeholder:"Number of Delay open",className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx(F,{className:"!font-semibold !text-[15px] !whitespace-nowrap mt-[8px]",label:"Screen arrangement"}),e.jsx(w.Item,{name:"isScreenArrangement",className:"text-[14px]",valuePropName:"checked",children:e.jsx(J,{onChange:n=>{d(n)}})}),e.jsx(F,{className:"!text-[15px] mt-[8px] text-nowrap",label:"Col"}),e.jsx(w.Item,{name:"arrangementLayoutCol",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,disabled:!f,className:"text-[14px] w-full",type:"number"})}),e.jsx(F,{className:"!text-[15px] mt-[8px]  text-nowrap",label:"Row"}),e.jsx(w.Item,{name:"arrangementLayoutRow",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,disabled:!f,className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx(F,{className:"!text-[15px] mt-[8px]",label:"Auto scale screen"}),e.jsx(w.Item,{name:"autoScaleScreen",valuePropName:"checked",children:e.jsx(J,{disabled:!f,onChange:n=>{u(n)}})}),e.jsxs("div",{style:{opacity:s?"0":"1",visibility:s?"hidden":"visible",willChange:"opacity, visibility"},className:"flex gap-x-5 transition-all",children:[e.jsx(F,{className:"!text-[15px] mt-[8px]",label:"%Scale"}),e.jsx(w.Item,{name:"screenScalePercent",className:"",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,max:100,disabled:!f,className:"text-[14px] w-full",type:"number"})})]})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx(F,{className:"!text-[15px] mt-[8px]",label:h("Auto set window size")}),e.jsx(w.Item,{name:"isSetWindowSize",valuePropName:"checked",children:e.jsx(J,{})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row gap-x-[10px]",children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Screen size"}),m!=""&&e.jsx("span",{children:e.jsx(F,{className:"!text-[13.5px]",color:"red",label:"(* "+m+" )"})})]}),e.jsx("div",{className:"flex flex-row flex-nowrap gap-x-[10px] items-center",children:e.jsx(w.Item,{style:{width:"100%",fontSize:"14px"},name:"screenSize",rules:[{validator(n,v){return v==="auto"||v.includes("x")?Promise.resolve():Promise.reject(new Error(`${h("Please enter the following format")} [${h("width")}]x[${h("height")}] ${h("ex")}: 1280x800.`))}}],children:e.jsx(ne,{showSearch:!0,onSearch:g,onChange:S,className:"text-[14px]",placeholder:"[width]x[height] ex: 1280x800",onDropdownVisibleChange:n=>{n||i("")},dropdownRender:n=>e.jsxs(e.Fragment,{children:[!o&&n,o&&e.jsxs("div",{className:"cursor-pointer p-[8px] rounded-[5px]",onClick:C,children:[h("Create"),' "',p,'"']})]}),options:x.map(n=>({label:h(n),value:n}))})})}),st(window.api.APP_VERSION,"4.0.16")>=0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("p",{className:"mb-0",children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Profile number per thread"}),e.jsxs("span",{className:"italic",children:["(",h("The app will initiate a new thread if more profiles are opened than this number"),")"]})]}),e.jsx(w.Item,{name:"profilePerWorker",className:"mb-2",children:e.jsx(K,{min:1,placeholder:"Number of profiles per worker thread",className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Write logs"}),e.jsx(w.Item,{name:"writeLogs",valuePropName:"checked",children:e.jsx(J,{})})]})]})]})]})})})})},Dt=({tabActive:t,totalProfile:a,filterProfile:r,setFilterProfile:s,filterSchedule:u,setFilterSchedule:f})=>{const{campaign_id:d}=H(),[x]=T(),y=(...p)=>{const[j,m]=p;s(i=>({...i,page:j,limit:m}))},o=(...p)=>{const[j,m]=p;f(i=>({...i,page:j,limit:m}))},{data:l}=D({queryKey:[$.schedule,d,u],queryFn:()=>ue({campaign_id:d,...u}),refetchOnMount:!0,refetchOnWindowFocus:!0});return e.jsxs("div",{className:"flex w-full h-full",children:[t==="profile"&&e.jsxs("div",{className:"flex justify-end items-center w-full pr-[20px]",children:[e.jsx(F,{label:`${a>1?x("Total profiles"):x("Total profile")}: ${a}`}),a>0&&e.jsx(U,{size:"default",showTitle:!1,showQuickJumper:!0,pageSize:r.limit,current:r.page,pageSizeOptions:[10,20,50,100],total:a,onChange:y,showSizeChanger:!0,locale:{items_per_page:x("page"),jump_to:x("Go to"),page:x("Page")}})]}),t==="schedule"&&e.jsxs("div",{className:"flex justify-end items-center w-full pr-[20px]",children:[e.jsx(F,{label:`${(l==null?void 0:l.total)>1?x("Total schedules"):x("Total schedule")}: ${l==null?void 0:l.total}`}),(l==null?void 0:l.total)>0&&e.jsx(U,{size:"default",showTitle:!1,showQuickJumper:!0,pageSize:u.limit,current:u.page,pageSizeOptions:[10,20,50,100],total:l==null?void 0:l.total,onChange:o,showSizeChanger:!0,locale:{items_per_page:x("page"),jump_to:x("Go to"),page:x("Page")}})]})]})},Bt=({tabActive:t,onSaveData:a,setOpenCreate:r,arrayField:s})=>{const u=_e(),[f]=T();return e.jsx("div",{className:t!=="profile"?"mb-[15px]":"",children:e.jsxs("div",{className:"flex items-center gap-x-[10px]",children:[e.jsx(N,{className:`${t!=="profile"?"block":"hidden"}`,onClick:()=>u(de.campaign),label:f("Back"),buttonMenu:!0,type:"warning"}),t==="input"&&s&&s.length>0&&e.jsx(N,{onClick:a,label:f("Save"),buttonMenu:!0,type:"primary"}),t==="settings"&&e.jsx(N,{onClick:a,label:f("Save"),buttonMenu:!0,type:"primary"}),t==="schedule"&&e.jsx(N,{label:f("Create schedule"),type:"primary",buttonMenu:!0,onClick:()=>r(!0)})]})})};var Ie=(t=>(t[t.common=1]="common",t[t.schedule=2]="schedule",t))(Ie||{}),M=(t=>(t[t.Once=1]="Once",t[t.Interval=2]="Interval",t[t.Daily=3]="Daily",t[t.Weekly=4]="Weekly",t[t.Monthly=5]="Monthly",t))(M||{});const Te=[{label:"Sunday",value:0},{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6}],Me=()=>{const t=[];for(let a=1;a<=31;a++)t.push({label:a,value:a});return t},be=t=>({name:`Run ${t.name}`,data:"",script:"",task_type:2,execution_frequency:1,time_interval:60,starting_time:Z(),execution_time:Z(),execution_day:Te[0].value,execution_date:Me()[0].value,start_end_time:[Z(),Z().add(24,"hours")]});function $t({open:t,setOpen:a,campaign:r}){const[s]=T(),[u]=w.useForm(),{message:f}=O.useApp(),d=H(),x=w.useWatch("execution_frequency",u),y=z(),o=G(),l=async(m=!1)=>{var h,S,C,g;const i=await u.validateFields().catch(()=>null);if(!i)a(!0);else{const n={name:i.name,campaign_id:Number(d.campaign_id),end_time:i.start_end_time&&((h=i.start_end_time[1])==null?void 0:h.format("YYYY-MM-DD HH:mm:ss")),execute_day:i.execution_frequency===M.Weekly?i.execution_day:i.execution_date,execution_frequency:i.execution_frequency,execute_time:(S=i.execution_time)==null?void 0:S.format("HH:mm"),start_time:i.start_end_time&&((C=i.start_end_time[0])==null?void 0:C.format("YYYY-MM-DD HH:mm:ss"))||((g=i.starting_time)==null?void 0:g.format("YYYY-MM-DD HH:mm:ss")),task_type:Ie.schedule,interval_time:i.time_interval,isRunning:!!m};await Ve(n).then(()=>{a(!1),f.success("Schedule created"),y.invalidateQueries($.schedule,{refetchInactive:!0})}).catch(()=>{f.error("Create schedule failed")})}};c.useEffect(()=>{t&&u.setFieldsValue(be(r))},[t]);const{isLoading:p,mutate:j}=ie({mutationFn:m=>l(m)});return e.jsx(te,{open:t,onCancel:()=>a(!1),maskClosable:!1,title:e.jsx(F,{className:"!text-[22px] font-semibold",style:{color:o.titlePrimary},label:s("Schedule")}),confirmLoading:p,footer:e.jsxs(rt,{children:[e.jsx(N,{type:"error",label:s("Cancel"),onClick:()=>a(!1)}),e.jsx(N,{label:s("Create And Run"),type:"primary",onClick:()=>j(!0)}),e.jsx(N,{label:s("Create"),type:"primary",onClick:()=>j(!1)})]}),children:e.jsx("div",{style:{maxHeight:"60vh",overflowY:"scroll"},children:e.jsxs(w,{form:u,layout:"vertical",initialValues:()=>be(r),children:[e.jsx(B,{label:"Name",required:!0}),e.jsx(w.Item,{label:"",name:"name",rules:[{required:!0,message:"This field is required"}],children:e.jsx(X,{})}),e.jsx(B,{label:"Execution frequency"}),e.jsx(w.Item,{label:"",name:"execution_frequency",children:e.jsxs(V.Group,{children:[e.jsx(V,{value:M.Once,children:s("Once")}),e.jsx(V,{value:M.Interval,children:s("Interval")}),e.jsx(V,{value:M.Daily,children:s("Daily")}),e.jsx(V,{value:M.Weekly,children:s("Weekly")}),e.jsx(V,{value:M.Monthly,children:s("Monthly")})]})}),x===M.Interval?e.jsxs("div",{children:[e.jsx(B,{label:"Each time delay (minutes)"}),e.jsx(w.Item,{label:"",name:"time_interval",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:0,className:"w-full"})})]}):x===M.Once?e.jsxs("div",{children:[e.jsx(B,{label:"Starting time",required:!0}),e.jsx(w.Item,{label:"",name:"starting_time",rules:[()=>({validator(m,i){return i===null?Promise.reject(new Error("This field is required")):Promise.resolve()}})],children:e.jsx(ce,{className:"w-full",format:"DD/MM/YYYY HH:mm",showTime:!0})})]}):x===M.Daily?e.jsxs("div",{children:[e.jsx(B,{label:"Execution time"}),e.jsx(w.Item,{label:"",name:"execution_time",children:e.jsx(re,{format:"HH:mm",className:"w-full"})})]}):x===M.Weekly?e.jsxs("div",{children:[e.jsx(B,{label:"Execution time"}),e.jsxs("div",{className:"flex",children:[e.jsx(w.Item,{label:"",name:"execution_day",className:"w-[200px]",children:e.jsx(ne,{options:Te})}),e.jsx(w.Item,{label:"",name:"execution_time",className:"w-full",children:e.jsx(re,{format:"HH:mm",className:"w-full"})})]})]}):x===M.Monthly?e.jsxs("div",{children:[e.jsx(B,{label:"Execution time"}),e.jsxs("div",{className:"flex w-full",children:[e.jsx(w.Item,{label:"",name:"execution_date",className:"w-[150px]",children:e.jsx(ne,{options:Me(),className:"w-full"})}),e.jsx(w.Item,{name:"execution_time",className:"w-full",children:e.jsx(re,{format:"HH:mm",className:"w-full"})})]})]}):null,x!==M.Once&&e.jsxs("div",{children:[e.jsx(B,{label:"Start - End time",required:!0}),e.jsx(w.Item,{label:"",name:"start_end_time",rules:[()=>({validator(m,i){return i===null?Promise.reject(new Error(s("This field is required"))):i&&i[1]>=i[0]?Promise.resolve():Promise.reject(new Error(s("The end date must be greater than the start date!")))}})],children:e.jsx(ce.RangePicker,{format:"DD/MM/YYYY HH:mm",showTime:!0,className:"w-full"})})]})]})})})}const B=({label:t,required:a})=>{const[r]=T();return e.jsxs("div",{className:"flex items-center flex-row gap-x-[3px]",children:[e.jsx(F,{className:"!textx-[14px] font-semibold",label:r(t)}),a&&e.jsx("span",{className:"text-red-700",children:"*"})]})},E=[{title:"Input",key:"input"},{title:"Profiles",key:"profile",total:0},{title:"Settings",key:"settings"},{title:"Schedule",key:"schedule",total:0}];function Ya(){const[t,a]=c.useState(E[0].key),[r,s]=c.useState(!1),[u]=w.useForm(),f=H(),{message:d}=O.useApp(),[x,y]=c.useState([]),[o,l]=c.useState({limit:10,page:1}),[p,j]=c.useState({page:1,limit:10}),m=z(),i=Ae(),{state:h}=i,[S]=c.useState(h&&h.isActiveTabSchedule?h.isActiveTabSchedule:!1),{data:C}=D({queryFn:()=>Ge(f.campaign_id||""),queryKey:[$.campaign,f.campaign_id]});c.useEffect(()=>{S&&a(E[3].key)},[h]),c.useEffect(()=>{m.invalidateQueries($.campaign,{refetchInactive:!0}),m.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0})},[]);const{data:g}=D({queryFn:()=>Qe({campaignId:f.campaign_id}),queryKey:["Total_Profile_Campaign",f.campaign_id]}),{data:n}=D({queryKey:[$.schedule,f.campaign_id,p],queryFn:()=>ue({campaign_id:f.campaign_id,...p}),refetchOnMount:!0,refetchOnWindowFocus:!0}),v=c.useMemo(()=>(E.forEach(b=>{b.key==="profile"&&(b.total=(g==null?void 0:g.data.total)||0),b.key==="schedule"&&(b.total=(n==null?void 0:n.total)||0)}),[...E]),[g==null?void 0:g.data.total,n==null?void 0:n.total]),k=async()=>{const b=f.campaign_id,{uuid:_}=De("AUTH")||{},A=u.getFieldsValue(),{arrangementLayoutCol:L,arrangementLayoutRow:ae,automationProcess:R,delayOpen:P,screenScalePercent:Le}=A;L&&ae&&R&&P>=0&&Le?(Be(`settings-${_}`,A),await Ye({campaignId:b,input:x,settings:A}).then(W=>{W.data.type==="success"?d.success(W.data.title):W.data.type==="error"&&d.error(W.data.title)}).catch(W=>{d.error(W)})):d.error("Settings fields cannot be left blank.")};return e.jsxs(e.Fragment,{children:[e.jsx($e,{tabs:v,defaultActiveKey:t,handleChangeTab:a}),e.jsxs("section",{className:"main",children:[e.jsx(Bt,{tabActive:t,campaign:C,arrayField:x,onSaveData:k,setOpenCreate:s}),e.jsxs("div",{className:`${t!=="profile"?"h-[calc(100vh-255px)]":"h-[calc(100vh-205px)]"} pb-[20px] overflow-auto`,children:[e.jsx("div",{style:{display:`${t==="input"?"block":"none"}`},children:e.jsx(ht,{campaign:C,arrayField:x,setArrayField:y})}),e.jsx("div",{style:{display:`${t==="profile"?"block":"none"}`},children:e.jsx(Lt,{campaign:C,filterProfile:o,setFilterProfile:l})}),e.jsx("div",{style:{display:`${t==="settings"?"block":"none"}`},children:e.jsx(At,{campaign:C,form:u})}),e.jsx("div",{style:{display:`${t==="schedule"?"block":"none"}`},children:e.jsx(ft,{filterSchedule:p,setFilterSchedule:j})})]}),e.jsx("div",{className:"h-[64px]",children:e.jsx(Dt,{tabActive:t,totalProfile:g==null?void 0:g.data.total,filterProfile:o,setFilterProfile:l,filterSchedule:p,setFilterSchedule:j})})]}),e.jsx($t,{open:r,setOpen:s,campaign:C})]})}export{Ya as default};
