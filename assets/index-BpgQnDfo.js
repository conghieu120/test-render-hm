import{w as g,q as P,j as w,r as h,k as e,ab as q,ad as D,a1 as M}from"./index-rD5D3wIe.js";import{a as Q}from"./index.esm-aP3EXNwz.js";import{c as R}from"./index.esm-CuvWRocu.js";import{B as b}from"./index-Cnfr_LhE.js";import{g as L,F as T,T as B}from"./FormAddProxy-8KnQ1Sdo.js";import{c as H,u as K,g as O,d as U}from"./proxyService-BvUDuHG4.js";import{u as Y}from"./useMutation-7pHNuXnK.js";import{u as _}from"./useQuery-DGelT77v.js";import{Q as f}from"./queryKey.const-4yptRpGc.js";import{F as A}from"./index-D0qsI2Ko.js";import{u as F}from"./useTranslation-CdVDZguR.js";import{M as $}from"./index-DduQbOjH.js";import{R as E,C as S}from"./row-D9yJnvb0.js";import{D as z}from"./DeleteConfirmModal-DSBDXsxU.js";import{u as I}from"./theme-CwYL3eQV.js";import{g as V}from"./auth-D6OQT4bj.js";import{f as X}from"./index-B3nBNj8d.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./index-DvOzr4aL.js";import"./styled-components.browser.esm-Cc1hOk3M.js";import"./index-C97G-hLo.js";import"./index-c2ufQ9kY.js";import"./index-WqkPP-4X.js";import"./index-VaFpLiuL.js";import"./index-BUNugdcr.js";import"./TextArea-D8GM8mUo.js";import"./CheckOutlined-CxcD5R4P.js";import"./compareVersion-JynyrHBx.js";import"./index-R7zUTNyO.js";import"./EyeOutlined-D2K23cwb.js";import"./SearchOutlined-DPpNmpde.js";import"./index-Rll6gE4e.js";import"./index-Cw8dqNCZ.js";import"./Overflow-wzPxOxK8.js";import"./PurePanel-CzAY4fQy.js";import"./DownOutlined-U_yyBD4s.js";import"./utils-Dji2qSVF.js";import"./collapse-C1MjllT7.js";import"./responsiveObserver-CoLEQsUO.js";import"./index-bFDahTXa.js";import"./index-DQqevswW.js";const G={name:"",type:B.api,proxyType:"HTTP",url:"",ip:"",port:"",user:"",pass:""};function J({isModalOpen:s,setIsModalOpen:m}){const[t]=A.useForm(),{token:c}=g.useToken(),{t:d}=F(),{data:x}=_({queryFn:L,queryKey:f.listProxyService}),u=async()=>{const r=await t.validateFields().catch(()=>null);if(!r)return;const n=r.proxyConfig?x[r.proxyConfig]:null;i({name:r.name,proxy_type:r.type,proxy_config:{type:r.proxyType||"",type_service:r.proxyConfig&&typeof r.proxyConfig=="string"?r.proxyConfig:"",ip:r.ip||"",port:r.port||"",user:n?n.user_format:r.user||"",pass:n?n.pass_format:r.pass||"",url:r.url||"",user_format:r.user_format||"",pass_format:r.pass_format||""}})},{message:o}=P.useApp(),l=w(),{isLoading:N,mutate:i}=Y({mutationFn:H,onSuccess:()=>{o.success("Create proxy config success"),l.invalidateQueries(f.proxyConfig),m(!1)},onError:r=>{var n,j;q.isArray((n=r.response)==null?void 0:n.data.content)?(j=r.response)==null||j.data.content.forEach(C=>{o.error(C)}):o.error("Create proxy config error!")}});return h.useEffect(()=>{s&&(t.resetFields(),t.setFieldsValue(G))},[s]),e.jsx($,{title:e.jsx("span",{style:{color:c.textPrimary,fontSize:"20px"},children:d("Create config")}),footer:e.jsx(E,{className:"justify-end mt-2",children:e.jsx(b,{disabled:N,type:"primary",onClick:u,label:d("Submit")})}),open:s,width:950,styles:{body:{maxHeight:"560px",overflowY:"scroll",paddingRight:"10px"}},onCancel:()=>m(!1),children:e.jsx(T,{form:t,isShowInModal:!0})})}function W({config:s}){const{t:m}=F(),[t]=A.useForm(),{message:c}=P.useApp(),{token:d}=g.useToken(),x=w();h.useEffect(()=>{s&&t.setFieldsValue({name:s.name,type:s.type,proxyType:s.config.type||"",url:s.config.url||"",ip:s.config.ip||"",port:s.config.port||"",user:s.config.user||"",pass:s.config.pass||"",user_format:s.config.user_format||"",pass_format:s.config.pass_format||""})},[s]);const u=async()=>{const o=await t.validateFields().catch(()=>null);if(o)try{await K(s==null?void 0:s.id,{id:s==null?void 0:s.id,name:s.name,proxy_type:s.type,proxy_config:{type:o.proxyType||"",ip:o.ip||"",port:o.port||"",type_service:s.config.type_service||"",user:o.user||s.config.user||"",pass:o.pass||s.config.pass||"",url:o.url||s.config.url||"",user_format:o.user_format||"",pass_format:o.pass_format||""}}),c.success("Config updated"),x.invalidateQueries(f.proxyConfig)}catch{c.error("Config update error")}};return e.jsxs(S,{span:24,className:"px-8",children:[e.jsx("div",{className:"font-bold text-[25px] mb-4",style:{color:d.textPrimary},children:s==null?void 0:s.name}),e.jsxs(S,{className:"w-full",children:[e.jsx(T,{form:t,config:s}),e.jsx(E,{className:"justify-end mt-7",children:e.jsx(b,{className:"px-[25px]",type:"normal",label:m("Save"),onClick:u})})]})]})}function He(){var C,k;const{token:s}=g.useToken(),m=I(),[t,c]=h.useState(null),[d,x]=h.useState(!1),{t:u}=F(),{data:o}=_({queryKey:[f.userDetail],queryFn:V}),l=((k=(C=o==null?void 0:o.data)==null?void 0:C.content)==null?void 0:k.uuid)||"",N=()=>{x(!0)},{data:i}=_({queryFn:O,queryKey:[f.proxyConfig]});h.useEffect(()=>{i&&!(i!=null&&i.some(a=>a.id===(t==null?void 0:t.id)))&&c(i[0]||null)},[i]);const{message:r}=P.useApp(),n=w(),j=async(a,p)=>{a.stopPropagation();const{isConfirmed:v}=await z();if(v)try{await U(p==null?void 0:p.id),r.success("Proxy config deleted"),n.invalidateQueries(f.proxyConfig);const y=M(`DEFAULT_PROXY_${l==null?void 0:l.replaceAll("-","")}`);Number(y==null?void 0:y.proxy_config_id)===Number(p==null?void 0:p.id)&&localStorage.removeItem(`DEFAULT_PROXY_${l==null?void 0:l.replaceAll("-","")}`)}catch{r.success("Delete proxy config failed")}};return e.jsxs("div",{className:"flex flex-col max-h-full",children:[e.jsx("div",{className:"w-fit mt-3 mb-2",children:e.jsx(b,{type:"primary",label:u("Create config"),onClick:N,buttonMenu:!0,icon:e.jsx(D,{})})}),e.jsx("div",{className:"flex-1 pb-12 overflow-y-auto pt-2",style:{backgroundColor:m.backgroundNormal},children:e.jsxs("div",{className:"max-h-full flex-1 grid grid-cols-12 pb-4 min-w-[750px]",children:[e.jsx("div",{className:"col-span-5 xl:col-span-7",children:e.jsx("div",{className:"overflow-y-auto grid grid-cols-1 xl:grid-cols-2 -ml-2 overflow-x-scroll",children:i==null?void 0:i.map(a=>{var p,v;return e.jsx("div",{className:"p-2 col-span-1",children:e.jsxs("div",{onClick:()=>c(a),className:"p-4 rounded-xl cursor-pointer border border-solid",style:{backgroundColor:m.backgroundLight,borderColor:m.borderNormal},children:[e.jsxs("div",{className:"flex justify-between items-center",style:{borderBottom:"1px solid "+s.bgPage},children:[e.jsxs("div",{className:"overflow-auto",children:[e.jsx("p",{className:"font-bold text-xl mb-0 truncate",children:a.name}),e.jsx("p",{className:"mt-0 mb-1",children:(p=a.config)!=null&&p.type_service?`${a.type} (${(v=a.config)==null?void 0:v.type_service})`:a.type})]}),e.jsx("div",{children:(t==null?void 0:t.id)===a.id?e.jsx(Q,{size:18,className:"!text-[#2A84F4]"}):e.jsx(R,{size:20})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold mb-0",children:u("Created at")}),e.jsx("p",{className:"mt-0 truncate",children:X(new Date(a.created_at),"PPpp")})]}),e.jsx(b,{label:u("Delete"),type:"error",solid:!0,classStyle:"h-fit",onClick:y=>j(y,a)})]})]})},a.id)})})}),e.jsx("div",{className:"relative col-span-7 xl:col-span-5",children:t&&e.jsx("div",{className:"sticky top-0",children:e.jsx(W,{config:t})})}),d&&e.jsx(J,{isModalOpen:d,setIsModalOpen:x})]})})]})}export{He as default};
