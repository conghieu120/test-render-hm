import{n as g,k as e,i as d,q as j,j as y,S as b}from"./index-CJvg638n.js";import{B as h}from"./index-BAIjI0rE.js";import{D as p}from"./DeleteConfirmModal-CCC5Ho8A.js";import{u as D}from"./theme-D5S-1fEx.js";import{u as f}from"./useTranslation-DN-CYzVf.js";import{S}from"./index-Bsl0EBBv.js";import{u as x}from"./useMutation-DtMNI5dJ.js";import{u as L}from"./useQuery-DJ-tefVM.js";import{Q as r}from"./queryKey.const-4yptRpGc.js";import{S as w}from"./index-CWlqhW57.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./index-TvTBJWU5.js";import"./utils-Dji2qSVF.js";import"./gapSize-U1swVQyS.js";function A({...t}){const a=D(),{t:s}=f(),{theme:o}=g(i=>i.display),l=async()=>{const{isConfirmed:i}=await p({text:"Are you sure logout on this device?"});i&&await t.onSubmitLogoutDevice(t.id)},u=async i=>{const{isConfirmed:m}=await p({text:"Are you sure update local active on this device?",customClass:{title:o=="light"?"text-black":"text-white",htmlContainer:o=="light"?"":"!text-white",icon:"!border-transparent"}});m&&await t.onSubmitLocalActiveDevice({isActive:i,id:t.id})};return e.jsxs("div",{style:{backgroundColor:a.backgroundDark},className:"w-80 rounded p-4",children:[e.jsxs("p",{className:"m-0 mb-1 truncate ...",children:[e.jsx("span",{className:"font-bold",children:s("Machine name: ")}),e.jsx("span",{children:t.machine_name})]}),e.jsxs("p",{className:"m-0 mb-1 truncate ...",children:[e.jsx("span",{className:"font-bold",children:s("Os type: ")}),e.jsx("span",{children:t.os_type})]}),e.jsxs("p",{className:"m-0 mb-1 truncate ...",children:[e.jsx("span",{className:"font-bold",children:s("Platform: ")}),e.jsx("span",{children:t.platform})]}),e.jsxs("p",{className:"m-0 mb-1 truncate ...",children:[e.jsx("span",{className:"font-bold",children:s("Login at: ")}),e.jsx("span",{children:t.last_login_at})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:s("Active local: ")}),e.jsx(S,{className:"ml-2",title:"Active local",checked:t.is_active_local,onChange:i=>u(i)})]}),t.is_current_device?e.jsx(h,{label:s("Current device"),classStyle:"w-fit m-auto mt-4"}):e.jsx(h,{typebutton:"error",label:s("Logout"),classStyle:"w-fit m-auto mt-4",onClick:l})]})}const N=async()=>{const{data:t}=await d.get("/v4/device-user/list");return t.data.content},C=async t=>{const{data:a}=await d.delete(`/v4/device-user/logout/${t}`);return a.content},_=async(t,a)=>{const{data:s}=await d.put(`/v4/device-user/active-local/${t}`,{is_active:a});return s.content};function O(){const{t}=f(),{message:a}=j.useApp(),s=y(),{data:o}=L({queryFn:()=>N(),queryKey:r.getUserDevices}),{isLoading:l,mutate:u}=x({mutationFn:c=>C(c),onSuccess:()=>{a.success(t("Logout successfully")),s.invalidateQueries(r.getUserDevices)},onError:()=>{a.error(t("Logout error"))}}),{isLoading:i,mutate:m}=x({mutationFn:({id:c,isActive:n})=>_(c,n),onSuccess:()=>{a.success(t("Update local device successfully")),s.invalidateQueries(r.getUserDevices),s.invalidateQueries(r.userDetail)},onError:c=>{var n,v;a.error(((v=(n=c==null?void 0:c.response)==null?void 0:n.data)==null?void 0:v.title)||t("Update local device error"))}});return e.jsxs(b,{spinning:l||i,children:[e.jsx("h2",{children:t("Logged devices")}),e.jsx("div",{className:"mt-4",children:e.jsx(w,{wrap:!0,size:[16,16],children:(o||[]).map((c,n)=>e.jsx(A,{...c,onSubmitLogoutDevice:u,onSubmitLocalActiveDevice:m},n))})})]})}export{O as default};
