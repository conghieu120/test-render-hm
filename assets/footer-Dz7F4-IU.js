import{q as Se,n as ee,j as Pe,v as ve,r as E,k as c,N as O,S as Ne,dt as Ie,a1 as Fe,ap as h,at as je,fS as Ve,aq as B,fT as De,fU as U,fV as qe,ab as $,fW as oe,fX as te,fY as Re,ah as re,ce as Le,fZ as q,f_ as ie,f$ as Qe,g0 as se,fC as ne,g1 as ae}from"./index-CJvg638n.js";import{d as Ae,a as Ee}from"./index.esm-BiGZCgFT.js";import{u as Oe}from"./useMutation-DtMNI5dJ.js";import{u as T}from"./useQuery-DJ-tefVM.js";import{g as Be}from"./userSettingService-DL6083Yl.js";import{Q as b}from"./queryKey.const-4yptRpGc.js";import{g as Ue}from"./fontService-BKi657AH.js";import{P as R,a as M}from"./defaultConfig.const-CZoADfh5.js";import{g as $e}from"./auth-8cqRmsX-.js";import{u as Te}from"./theme-D5S-1fEx.js";import{u as Me}from"./useTranslation-DN-CYzVf.js";import{F as L}from"./index-YCIRg4HO.js";import{I as We}from"./index-4M1x7pR3.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./collapse-C1MjllT7.js";import"./row-C7cWNtLw.js";import"./responsiveObserver-BQm3ddGk.js";import"./index-BtoCM6cC.js";import"./index-DC1DAWbZ.js";import"./TextArea-DBRPcsh0.js";import"./EyeOutlined-B-Yk7nA6.js";import"./SearchOutlined-Bmw6m_pM.js";function xo(le){var X,Y;const{items:f,isNewbie:w,onClose:m,modalName:x,uuid:W,active:k,setActive:G}=le,{t:u}=Me(),{notification:Ge,message:p}=Se.useApp(),_=()=>U.getState().newProfile,{btnCreateProfile:S,oldFingerPrint:K,isLoading:P}=ee(e=>e.newProfile),C=Pe(),i=ve(),v=x==null?void 0:x.includes("Create"),{data:Q}=T({queryKey:[b.userDetail],queryFn:$e});(Y=(X=Q==null?void 0:Q.data)==null?void 0:X.content)!=null&&Y.uuid;const[N]=L.useForm();ee(e=>e.display);const ce=Te(),{data:I}=T({queryFn:()=>Be(),queryKey:[b.userSetting]}),{data:F}=T({queryFn:()=>Ue(),queryKey:[b.getAllFonts]}),j=I==null?void 0:I.os,fe=()=>{const e=U.getState().cookieSlice;return i(Le({cookie_id:0,cookies:[]})),e},ue=()=>U.getState().autofillSlice,de=()=>{const e=f.findIndex(o=>o.key===k);f.length>e+1&&G(f[e+1].key)},pe=()=>{const e=f.findIndex(o=>o.key===k);e>0&&G(f[e-1].key)},z=(e,o=!1)=>{const t=qe(e),r=fe(),s=ue(),g=Object.values(j&&j[e.os].browsers[e.browser]).map(a=>a[0]).find(a=>a.version===t.fingerprint.navigator.browserVersion),V=g&&g.source_version,D=g&&g.version_name,Ce=g&&g.browser_type;t.fingerprint.navigator.sourceVersion=V??"",t.fingerprint.navigator.browserVersionName=D??"";let l={config:t};l.config.browser_type=Ce??"";const d=$.cloneDeep(e.proxy);if(d.type!=="Without proxy"&&d.type){const a={ip:"",user:"",port:"",pass:"",type:"",country:"",note:"",created_at:"",details:"",info:"",status:"",proxy_config_id:""};d.uuid&&(a.uuid=""),d.status||(d.status=""),d.details=oe((d==null?void 0:d.details)||{}),l.proxy=te(a,d)}if(e.extension.length&&(l.extensions=e.extension.map(a=>a.id)),e.folderId&&(l.folder_id=e.folderId===-1?"none":e.folderId),e.statusId&&(l.status_id=e.statusId),e.enableBookmark&&v){const a=e.bookmark.split(/\r?\n|\r|\n/g);l.bookmark=a.filter(A=>A.length>0)}const Z=$.sortBy([...F[e.os].random,...F[e.os].required],["name"]),ke=Z.filter(a=>e.fonts.value.includes(a.name)).map(a=>({...a,isChecked:1})),_e=e.fonts.value.filter(a=>!Z.some(A=>A.name===a)).map(a=>({isChecked:1,isDisabled:!1,name:a,required:0}));return l.config.fingerprint.fonts={...l.config.fingerprint.fonts,value:[..._e,...ke]},r.cookie_id!==0&&v&&(l.cookie_id=r.cookie_id),o&&(l.config.fingerprint.webgl2.audioContext.noiseValue=null,l.config.fingerprint.webgl2.ClientRectsNoice=null,l.config.fingerprint.webgl2.WebglNoiseValue=null),s.data&&v&&(l.autofill=Re(s)),console.log({params:l}),l},ge=(e,o)=>{const t={};t.config_id=e.typeConfig,t.browser_name=e.nameForNewbie,t.browser_note=e.notes??"",t.local=o;const r=$.cloneDeep(e.proxy);if(r.type!=="Without proxy"&&(r!=null&&r.type)){t.check_before_start=r.checkBeforeStart;const s={ip:"",user:"",port:"",pass:"",type:"",country:"",note:"",created_at:"",details:"",info:"",status:"",proxy_config_id:""};r.uuid&&(s.uuid=""),r.status||(r.status=""),r.details=oe((r==null?void 0:r.details)||{}),t.proxy=JSON.stringify(te(s,r))}return t},me=async({config:e,quantity:o,is_local:t})=>{i(q(!0)),i(ie(o));for(let s=1;s<=o;s++){try{var r=await Qe(e);if(i(se(s)),t&&r){const n={...r.data.content};e.proxy&&(n.proxy=JSON.parse(e.proxy),n.config.fingerprint.proxy={checkBeforeStart:e.check_before_start}),r=await ne(n,t)}}catch(n){throw i(q(!1)),n}if(s==o)return i(ae()),r}},be=async({config:e,quantity:o,is_local:t})=>{i(q(!0)),i(ie(o));for(let s=1;s<=o;s++){try{const n={...e,random_value:{profile_name:e.config.name+(s>1?` (${s-1})`:"")}};var r=await ne(n,t);i(se(s))}catch(n){throw i(q(!1)),n}if(s==o)return i(ae()),r}},{mutate:xe}=Oe({mutationFn:async e=>{const o=_(),t=N.getFieldValue("quantityProfiles");if(!(t>=R&&t<=M))return Promise.reject({response:{data:{title:`${u("Quick create process must be between")} ${R} ${u("and")} ${M}`}}});if(w){const r=ge(o,e.is_local);return m&&m(),await me({config:r,quantity:t,is_local:e.is_local})}else{const r=z(o,!0);return m&&m(),await be({config:r,quantity:t,is_local:e.is_local})}},onSuccess:(e,...o)=>{const[{run:t,is_local:r}]=o;if(i(h(!1)),p.success(u("Create profile success")),C.invalidateQueries(b.listProfile,{refetchInactive:!0}),C.invalidateQueries(b.PROFILE_CLOUD,{refetchInactive:!0}),C.invalidateQueries(b.PROFILE_LOCAL,{refetchInactive:!0}),C.invalidateQueries(b.userDetail,{refetchInactive:!0}),t&&e){const s=e.data;window.api.openProfiles([s.content.uuid])}m&&m(),i(r?re(!0):re(!1))},onError:e=>{var t;i(h(!1));const{response:o}=e;(t=o==null?void 0:o.data)!=null&&t.title?p.error(o.data.title):o!=null&&o.title?p.error(o==null?void 0:o.title):w?p.error(u("Create profile newbie error")):p.error(u("Create profile error"))}}),H=async(e=!1)=>{const o=Fe("is_Local"),t=_();if(w&&!t.typeConfig){p.warning("Please choose type!");return}i(h(!0)),xe({run:e,is_local:o})},ye=()=>{const o={os:_().os};i(je({argsFingerPrint:o,fonts:F,osbVersion:j}))},he=async()=>{const e=_(),o=z(e),t=Ve(o.config.fingerprint,K);o.config.fingerprint=t,i(h(!0)),i(B(!0)),!(!W||!await De(o,W).catch(s=>{var g,V,D;i(h(!1)),i(B(!1));const{response:n}=s;(V=(g=n==null?void 0:n.data)==null?void 0:g.content)!=null&&V.length?p.error(n.data.content[0]):p.error((D=n==null?void 0:n.data)==null?void 0:D.title)}))&&(i(h(!1)),i(B(!1)),p.success("Update profile!"),C.invalidateQueries(b.listProfile),m&&m())},y=L.useWatch("quantityProfiles",N);E.useEffect(()=>{y&&N.setFieldValue("quantityProfiles",Number.parseInt(y))},[y]);const J=E.useMemo(()=>!(!y||y==R),[y]),we=E.useMemo(()=>[{name:u("Get new fingerprint"),action:ye,color:"rgba(177, 151, 252, 1)",bolderColor:"rgba(103, 65, 217, 1)",isShow:!w,isDisabled:!1,isLoading:!1},{name:u("Create profile"),action:H,color:"rgba(116, 192, 252, 1)",bolderColor:"rgba(20, 110, 190, 1)",isShow:x==="Create Profile",isDisabled:S,isLoading:P},{name:u("Create and run profile"),action:()=>H(!0),color:"rgba(99, 230, 190, 1)",bolderColor:"rgba(12, 166, 120, 1)",isShow:x==="Create Profile",isDisabled:S||J,isLoading:P},{name:u("Update profile"),action:he,color:"rgba(255, 135, 135, 1)",bolderColor:"rgba(224, 49, 49, 1)",isShow:x==="Edit Profile",isDisabled:S,isLoading:P}],[w,j,S,F,I,K,J,P]);return c.jsx(L,{form:N,initialValues:{quantityProfiles:1},children:c.jsx("div",{style:{position:"absolute",width:"75%",bottom:0,right:0},children:c.jsxs("div",{style:{padding:"0 20px 24px",display:"flex",justifyContent:"space-between",gap:"5px",background:ce.backgroundNormal},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[v&&c.jsx(L.Item,{name:"quantityProfiles",noStyle:!0,children:c.jsx(We,{className:"h-[50px] w-[70px]",type:"number",size:"large",min:R,max:M})}),we.map(e=>e.isShow&&c.jsxs(O,{className:"flex items-center h-[45px] rounded-[3.5px] font-semibold",style:{backgroundColor:e.isDisabled?"rgb(140, 140, 140)":e.color,color:"#183153",boxShadow:`0px 0.275rem 0px ${e.bolderColor}`,border:`1px solid ${e.bolderColor}`,borderRadius:"10px"},onClick:()=>e.action(),disabled:e.isDisabled,children:[e.isLoading&&c.jsx(Ne,{className:"pe-1",indicator:c.jsx(Ie,{spin:!0})}),e.name]},e.name))]}),c.jsxs("div",{style:{display:"flex",gap:"5px",fontSize:21},children:[(f==null?void 0:f.findIndex(e=>e.key===k))>0&&c.jsx(O,{className:"flex items-center h-[45px] rounded-[3.5px] font-semibold",style:{backgroundColor:"rgba(166, 130, 132, 1)",color:"#fff",boxShadow:"0px 0.275rem 0px rgba(118, 60, 64, 1)",border:"1px solid rgba(118, 60, 64, 1)",borderRadius:"10px"},onClick:pe,icon:c.jsx(Ae,{className:"align-middle"}),children:u("Back")}),(f==null?void 0:f.length)>f.findIndex(e=>e.key===k)+1&&c.jsxs(O,{className:"flex items-center h-[45px] rounded-[10px] font-semibold",style:{backgroundColor:"rgba(4, 127, 246, 1)",color:"#fff",boxShadow:"0px 0.275rem 0px rgba(9, 90, 169, 1)",border:"1px solid rgba(9, 90, 169, 1)",borderRadius:"10px"},onClick:de,children:[c.jsx("span",{className:"me-2",children:u("Next")}),c.jsx(Ee,{})]})]})]})})})}export{xo as default};
