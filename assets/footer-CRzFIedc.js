import{q as Pe,n as ee,j as ve,v as Se,r as L,k as f,a1 as Ne,ap as w,at as Ie,fS as Fe,aq as O,fT as je,fU as R,fV as Ve,ab as U,fW as te,fX as oe,fY as qe,ah as re,ce as De,fZ as D,f_ as ie,f$ as Qe,g0 as se,fC as ne,g1 as ae}from"./index-rD5D3wIe.js";import{d as Ae,a as Be}from"./index.esm-oalvffsi.js";import{u as Ee}from"./useMutation-7pHNuXnK.js";import{u as T}from"./useQuery-DGelT77v.js";import{g as Le}from"./userSettingService-Bg9YvoAZ.js";import{Q as y}from"./queryKey.const-4yptRpGc.js";import{g as Oe}from"./fontService-BFHGJrPs.js";import{P as Q,a as M}from"./defaultConfig.const-CZoADfh5.js";import{g as Re}from"./auth-D6OQT4bj.js";import{u as Ue}from"./theme-CwYL3eQV.js";import{B as $}from"./index-Cnfr_LhE.js";import{u as Te}from"./useTranslation-CdVDZguR.js";import{F as A}from"./index-D0qsI2Ko.js";import{I as Me}from"./index-R7zUTNyO.js";import"./commonjsHelpers__-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./collapse-C1MjllT7.js";import"./row-D9yJnvb0.js";import"./responsiveObserver-CoLEQsUO.js";import"./index-BUNugdcr.js";import"./index-VaFpLiuL.js";import"./TextArea-D8GM8mUo.js";import"./EyeOutlined-D2K23cwb.js";import"./SearchOutlined-DPpNmpde.js";function gt(le){var X,Y;const{items:c,isNewbie:h,onClose:g,modalName:x,uuid:W,active:k,setActive:G}=le,{t:u}=Te(),{notification:$e,message:d}=Pe.useApp(),_=()=>R.getState().newProfile,{btnCreateProfile:P,oldFingerPrint:K,isLoading:v}=ee(e=>e.newProfile),C=ve(),i=Se(),S=x==null?void 0:x.includes("Create"),{data:B}=T({queryKey:[y.userDetail],queryFn:Re});(Y=(X=B==null?void 0:B.data)==null?void 0:X.content)!=null&&Y.uuid;const[N]=A.useForm();ee(e=>e.display);const ce=Ue(),{data:I}=T({queryFn:()=>Le(),queryKey:[y.userSetting]}),{data:F}=T({queryFn:()=>Oe(),queryKey:[y.getAllFonts]}),j=I==null?void 0:I.os,fe=()=>{const e=R.getState().cookieSlice;return i(De({cookie_id:0,cookies:[]})),e},ue=()=>R.getState().autofillSlice,pe=()=>{const e=c.findIndex(t=>t.key===k);c.length>e+1&&G(c[e+1].key)},de=()=>{const e=c.findIndex(t=>t.key===k);e>0&&G(c[e-1].key)},z=(e,t=!1)=>{const o=Ve(e),r=fe(),s=ue(),m=Object.values(j&&j[e.os].browsers[e.browser]).map(a=>a[0]).find(a=>a.version===o.fingerprint.navigator.browserVersion),V=m&&m.source_version,q=m&&m.version_name,Ce=m&&m.browser_type;o.fingerprint.navigator.sourceVersion=V??"",o.fingerprint.navigator.browserVersionName=q??"";let l={config:o};l.config.browser_type=Ce??"";const p=U.cloneDeep(e.proxy);if(p.type!=="Without proxy"&&p.type){const a={ip:"",user:"",port:"",pass:"",type:"",country:"",note:"",created_at:"",details:"",info:"",status:"",proxy_config_id:""};p.uuid&&(a.uuid=""),p.status||(p.status=""),p.details=te((p==null?void 0:p.details)||{}),l.proxy=oe(a,p)}if(e.extension.length&&(l.extensions=e.extension.map(a=>a.id)),e.folderId&&(l.folder_id=e.folderId===-1?"none":e.folderId),e.statusId&&(l.status_id=e.statusId),e.enableBookmark&&S){const a=e.bookmark.split(/\r?\n|\r|\n/g);l.bookmark=a.filter(E=>E.length>0)}const Z=U.sortBy([...F[e.os].random,...F[e.os].required],["name"]),ke=Z.filter(a=>e.fonts.value.includes(a.name)).map(a=>({...a,isChecked:1})),_e=e.fonts.value.filter(a=>!Z.some(E=>E.name===a)).map(a=>({isChecked:1,isDisabled:!1,name:a,required:0}));return l.config.fingerprint.fonts={...l.config.fingerprint.fonts,value:[..._e,...ke]},r.cookie_id!==0&&S&&(l.cookie_id=r.cookie_id),t&&(l.config.fingerprint.webgl2.audioContext.noiseValue=null,l.config.fingerprint.webgl2.ClientRectsNoice=null,l.config.fingerprint.webgl2.WebglNoiseValue=null),s.data&&S&&(l.autofill=qe(s)),console.log({params:l}),l},me=(e,t)=>{const o={};o.config_id=e.typeConfig,o.browser_name=e.nameForNewbie,o.browser_note=e.notes??"",o.local=t;const r=U.cloneDeep(e.proxy);if(r.type!=="Without proxy"&&(r!=null&&r.type)){o.check_before_start=r.checkBeforeStart;const s={ip:"",user:"",port:"",pass:"",type:"",country:"",note:"",created_at:"",details:"",info:"",status:"",proxy_config_id:""};r.uuid&&(s.uuid=""),r.status||(r.status=""),r.details=te((r==null?void 0:r.details)||{}),o.proxy=JSON.stringify(oe(s,r))}return o},ge=async({config:e,quantity:t,is_local:o})=>{i(D(!0)),i(ie(t));for(let s=1;s<=t;s++){try{var r=await Qe(e);if(i(se(s)),o&&r){const n={...r.data.content};e.proxy&&(n.proxy=JSON.parse(e.proxy),n.config.fingerprint.proxy={checkBeforeStart:e.check_before_start}),r=await ne(n,o)}}catch(n){throw i(D(!1)),n}if(s==t)return i(ae()),r}},ye=async({config:e,quantity:t,is_local:o})=>{i(D(!0)),i(ie(t));for(let s=1;s<=t;s++){try{const n={...e,random_value:{profile_name:e.config.name+(s>1?` (${s-1})`:"")}};var r=await ne(n,o);i(se(s))}catch(n){throw i(D(!1)),n}if(s==t)return i(ae()),r}},{mutate:xe}=Ee({mutationFn:async e=>{const t=_(),o=N.getFieldValue("quantityProfiles");if(!(o>=Q&&o<=M))return Promise.reject({response:{data:{title:`${u("Quick create process must be between")} ${Q} ${u("and")} ${M}`}}});if(h){const r=me(t,e.is_local);return g&&g(),await ge({config:r,quantity:o,is_local:e.is_local})}else{const r=z(t,!0);return g&&g(),await ye({config:r,quantity:o,is_local:e.is_local})}},onSuccess:(e,...t)=>{const[{run:o,is_local:r}]=t;if(i(w(!1)),d.success(u("Create profile success")),C.invalidateQueries(y.listProfile,{refetchInactive:!0}),C.invalidateQueries(y.PROFILE_CLOUD,{refetchInactive:!0}),C.invalidateQueries(y.PROFILE_LOCAL,{refetchInactive:!0}),C.invalidateQueries(y.userDetail,{refetchInactive:!0}),o&&e){const s=e.data;window.api.openProfiles([s.content.uuid])}g&&g(),i(r?re(!0):re(!1))},onError:e=>{var o;i(w(!1));const{response:t}=e;(o=t==null?void 0:t.data)!=null&&o.title?d.error(t.data.title):t!=null&&t.title?d.error(t==null?void 0:t.title):h?d.error(u("Create profile newbie error")):d.error(u("Create profile error"))}}),H=async(e=!1)=>{const t=Ne("is_Local"),o=_();if(h&&!o.typeConfig){d.warning("Please choose type!");return}i(w(!0)),xe({run:e,is_local:t})},be=()=>{const t={os:_().os};i(Ie({argsFingerPrint:t,fonts:F,osbVersion:j}))},we=async()=>{const e=_(),t=z(e),o=Fe(t.config.fingerprint,K);t.config.fingerprint=o,i(w(!0)),i(O(!0)),!(!W||!await je(t,W).catch(s=>{var m,V,q;i(w(!1)),i(O(!1));const{response:n}=s;(V=(m=n==null?void 0:n.data)==null?void 0:m.content)!=null&&V.length?d.error(n.data.content[0]):d.error((q=n==null?void 0:n.data)==null?void 0:q.title)}))&&(i(w(!1)),i(O(!1)),d.success("Update profile!"),C.invalidateQueries(y.listProfile),g&&g())},b=A.useWatch("quantityProfiles",N);L.useEffect(()=>{b&&N.setFieldValue("quantityProfiles",Number.parseInt(b))},[b]);const J=L.useMemo(()=>!(!b||b==Q),[b]),he=L.useMemo(()=>[{name:u("Get new fingerprint"),action:be,type:"warning",isShow:!h,isDisabled:!1,isLoading:!1},{name:u("Create profile"),action:H,type:"normal",isShow:x==="Create Profile",isDisabled:P,isLoading:v},{name:u("Create and run profile"),action:()=>H(!0),type:"success",isShow:x==="Create Profile",isDisabled:P||J,isLoading:v},{name:u("Update profile"),action:we,type:"error",isShow:x==="Edit Profile",isDisabled:P,isLoading:v}],[h,j,P,F,I,K,J,v]);return f.jsx(A,{form:N,initialValues:{quantityProfiles:1},children:f.jsx("div",{style:{position:"absolute",width:"75%",bottom:0,right:0},children:f.jsxs("div",{style:{padding:"0 20px 24px",display:"flex",justifyContent:"space-between",gap:"5px",background:ce.backgroundNormal},children:[f.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[S&&f.jsx(A.Item,{name:"quantityProfiles",noStyle:!0,children:f.jsx(Me,{className:"h-[50px] w-[70px]",type:"number",size:"large",min:Q,max:M})}),he.map(e=>e.isShow&&f.jsx($,{type:e.type,label:e.name,className:"flex items-center h-[45px] rounded-[3.5px] font-semibold",onClick:()=>e.action(),disabled:e.isDisabled},e.name))]}),f.jsxs("div",{style:{display:"flex",gap:"5px",fontSize:21},children:[(c==null?void 0:c.findIndex(e=>e.key===k))>0&&f.jsx($,{type:"warning",className:"flex items-center h-[45px] rounded-[3.5px] font-semibold",onClick:de,icon:f.jsx(Ae,{className:"align-middle"}),label:u("Back")}),(c==null?void 0:c.length)>c.findIndex(e=>e.key===k)+1&&f.jsx($,{type:"normal",className:"flex items-center h-[45px] rounded-[10px] font-semibold",onClick:pe,icon:f.jsx(Be,{}),label:u("Next")})]})]})})})}export{gt as default};
