import{r as P,ab as D,k as e,i as O,fx as U,q as Y,U as L}from"./index-rD5D3wIe.js";import{C as X}from"./index-DvOzr4aL.js";import{u as W}from"./useMutation-7pHNuXnK.js";import{u as M}from"./useQuery-DGelT77v.js";import{u as R}from"./useTranslation-CdVDZguR.js";import{T as A}from"./index-WqkPP-4X.js";import{Q as G}from"./queryKey.const-4yptRpGc.js";import{c as $}from"./compareVersion-JynyrHBx.js";import{B as Q}from"./index-Cnfr_LhE.js";import{F as m}from"./index-D0qsI2Ko.js";import{R as k,C as S}from"./row-D9yJnvb0.js";import{I as y}from"./index-R7zUTNyO.js";import{R as f}from"./index-Rll6gE4e.js";import{S as z}from"./index-Cw8dqNCZ.js";const c={"ant-form-item":"_ant-form-item_9g1g6_1","ant-form-item-label":"_ant-form-item-label_9g1g6_1","ant-form-item-required":"_ant-form-item-required_9g1g6_1","ant-form-item-required-mark-optional":"_ant-form-item-required-mark-optional_9g1g6_1","required-label":"_required-label_9g1g6_21"},b={Without_proxy:"Without proxy",HTTP:"HTTP",SOCKS4:"SOCKS4",SOCKS5:"SOCKS5",SSH:"SSH"},fe=[b.HTTP,b.SOCKS4,b.SOCKS5,b.SSH],be=[{label:"HTTP",value:b.HTTP},{label:"SOCKS4",value:b.SOCKS4},{label:"SOCKS5",value:b.SOCKS5},{label:"SSH (Proxy Over SSH)",value:b.SSH}],J=[{value:"multibrowser.io",label:"ipscore.io"},{value:"ipinfo.io",label:"ipinfo.io"},{value:"ipgeolocation.io",label:"ipgeolocation.io"},{value:"api.ip.sb",label:"api.ip.sb"},{value:"api.ipapi.is",label:"api.ipapi.is"}],Z=/^((6553[0-5])|(655[0-2][0-9])|(65[0-4][0-9]{2})|(6[0-4][0-9]{3})|([1-5][0-9]{4})|([0-5]{0,5})|([0-9]{1,4}))$/,C={pattern:Z,message:"Invalid port"},je=i=>{const s={},o=["http","socks4","socks5","ssh"],a=/(http|socks4|socks5|ssh|HTTP|SOCKS4|SOCKS5|SSH):\/\/((.*):(.*)@)?(.*):(\d+)/gm;let u;if(o.some(r=>i.includes(r)))for(;(u=a.exec(i))!==null;)u.index===a.lastIndex&&a.lastIndex++,u.forEach((r,p)=>{switch(p){case 1:s.type=r.trim().toUpperCase();break;case 3:s.username=r!==void 0?r.trim():"";break;case 4:s.pass=r!==void 0?r.trim():"";break;case 5:s.ipAddress=r.trim();break;case 6:s.port=r.trim();break}});else s.username="",s.pass="",i.split(/[:|]+/).forEach((r,p)=>{switch(p){case 0:s.ipAddress=r.trim();break;case 1:s.port=r.trim();break;case 2:s.username=r.trim();break;case 3:s.pass=r.trim();break}});return s},Se={ip:"",asn:{asn:"",name:"",type:"",route:"",domain:""},loc:"",org:"",city:"",postal:"",region:"",country:"",hostname:"",timezone:""},I=(i,s,o="")=>{let a=i.replaceAll("{country}",s.country||"");if(a=a.replaceAll("{state}",s.state||""),a=a.replaceAll("{city}",s.city||""),a=a.replaceAll("{uuid}",o.replaceAll("-","")),a.includes("{random}")){const u=Math.random().toString().split(".").pop()||"";a=a.replaceAll("{random}",u)}return a},ee=i=>{let s={ip:"",port:"",user:"",pass:"",type:""};if(i&&typeof i=="string"){const o=i.includes(":")?i.trim().split(":"):i.trim().split("|");let a="",u="",r="",p="",x="";switch(o.length){case 2:[u,r]=o;break;case 3:[a,u,r]=o;break;case 4:[u,r,p,x]=o;break;case 5:[a,u,r,p,x]=o;break}s={type:a,ip:u,port:r,user:p,pass:x}}else if(i&&typeof i=="object"){const{type:o,ip:a,host:u,port:r,user:p,username:x,pass:q,password:T}=i;s.type=o,s.ip=a||u,s.port=r,s.user=p||x,s.pass=q||T}for(const o in s)s[o]||delete s[o];return s};function re({data:i}){const{t:s}=R(),o=P.useMemo(()=>{const a=[],u={...i,...i.asn};return Object.keys(u).forEach(r=>{const p=u[r];(typeof p=="string"||typeof p=="number")&&(p||r==="risk_score")&&a.push({key:r,value:p})}),D.uniqBy(a,"key")},[i]);return e.jsx("div",{className:"mt-5",children:o.map(({key:a,value:u})=>e.jsxs(A,{className:"text-green-500",children:[e.jsxs("span",{className:"text-[#6D6D6D]",children:[s(a),": "]}),e.jsx("span",{children:u})]},a))})}const qe=async i=>{const{data:s}=await O.get(`/v2/proxy-config/${i}`);return{...s==null?void 0:s.content,config:s==null?void 0:s.content.proxy_config,type:s==null?void 0:s.content.proxy_type}},se=async()=>{const{data:i}=await O.get(U);return i==null?void 0:i.content},d={api:"api",rotation:"rotation",hidemium_proxy:"hidemium_proxy"};function Pe({form:i,isShowInModal:s,config:o}){var E,w;const a=(o==null?void 0:o.type)||m.useWatch("type",i),{Text:u}=A,{t:r}=R(),{message:p}=Y.useApp(),[x,q]=P.useState(null),T=P.useRef(null),H=m.useWatch("proxyConfig",i),K=m.useWatch("proxyType",i),l=((E=o==null?void 0:o.config)==null?void 0:E.type_service)||H,{data:h}=M({queryFn:se,queryKey:G.listProxyService}),F=P.useMemo(()=>h?Object.keys(h).map(n=>({label:n,value:n})):[],[h]);P.useEffect(()=>{if(q(null),!l||!(l!=null&&l.length)||!h)return;const t=h[l];i.setFieldsValue({proxyType:t.type[0],ip:t.ip,port:t.port,user_format:"",pass_format:""}),T.current={user_format:(t==null?void 0:t.user_format)||"",pass_format:(t==null?void 0:t.pass_format)||""}},[l,h,o]),P.useEffect(()=>{q(null)},[K,s]);const{isLoading:B,mutate:V}=W({mutationFn:async()=>{var _,N;const t=i.getFieldsValue(),n={};if(n.urlcheck=t.checker,a===d.rotation&&(!l||!(l!=null&&l.length)))n.host=t.ip,n.port=t.port,n.typeProxy=t.proxyType,n.username=I(t.user,t),n.password=I(t.pass,t);else if(a===d.api)try{const{data:g}=await L.get(t.url),j=ee(g);n.host=j.ip||t.ip,n.port=j.port||t.port,n.typeProxy=j.type||t.proxyType,n.username=j.user||t.username,n.password=j.pass||t.pass}catch{return p.error(`Request to ${o.config.url} error`)}else{const g=v((_=T.current)==null?void 0:_.user_format,t.user_format),j=v((N=T.current)==null?void 0:N.pass_format,t.pass_format);n.host=t.ip,n.port=t.port,n.typeProxy=t.proxyType,n.username=I(g,t),n.password=I(j,t)}return!n.host||!n.port?Promise.reject("Invalid proxy"):(console.log("running proxy",{bodyCheck:n}),O.post("check-proxy",n))},onSuccess:({data:t})=>{q(t)},onError:()=>{p.error(r("Invalid Proxy")),q(null)}}),v=(t,n)=>{let _=t.replace("{username}",n||"");return t.includes("{password}")&&(_=t.replace("{password}",n||"")),_};return e.jsxs(m,{form:i,layout:"vertical",initialValues:{checker:"multibrowser.io"},children:[s?e.jsxs(k,{gutter:20,children:[e.jsx(S,{span:12,children:e.jsx(m.Item,{label:e.jsx("span",{children:r("Name")}),name:"name",className:`${c["required-label"]} ${c["ant-form-item-required"]}`,rules:[{required:!0,message:r("This field is required.")},{max:50,message:r("Name must not exceed 50 characters")}],children:e.jsx(y,{placeholder:r("Enter proxy name")})})}),e.jsx(S,{span:12,children:e.jsx(m.Item,{name:"type",className:`${c["required-label"]} ${c["ant-form-item-required"]}`,label:e.jsx("span",{children:r("Type")}),rules:[{required:!0,message:r("This field is required.")}],children:e.jsxs(f.Group,{className:"font-normal",children:[e.jsx(f.Button,{value:d.api,children:r("API")}),e.jsx(f.Button,{value:d.rotation,children:r("Rotation")})]})})})]}):null,a===d.rotation&&!o&&$(window.api.APP_VERSION,"4.0.13")>0?e.jsx(m.Item,{name:"proxyConfig",children:e.jsx(X,{options:F,styleProps:{fontSize:"12px",minWidth:"50px"}})}):null,a===d.api?e.jsx(k,{gutter:20,children:e.jsx(S,{span:12,children:e.jsx(m.Item,{name:"url",label:e.jsx("span",{children:r("Url")}),className:`${c["required-label"]} ${c["ant-form-item-required"]}`,rules:[{required:!0,message:r("This field is required")},{type:"url",message:r("Url invalid")}],children:e.jsx(y,{})})})}):null,e.jsxs(k,{gutter:20,children:[e.jsxs(S,{span:o?24:12,children:[e.jsx(m.Item,{name:"proxyType",className:`${c["required-label"]} ${c["ant-form-item-required"]}`,label:e.jsx("span",{children:r("Type")}),rules:[{required:!0,message:r("This field is required.")}],children:e.jsx(f.Group,{className:"font-normal",buttonStyle:"solid",children:a===d.rotation&&l&&(l!=null&&l.length)?e.jsx(e.Fragment,{children:h&&((w=h[l])==null?void 0:w.type).map(t=>e.jsx(f.Button,{value:t,children:t},t))}):e.jsxs(e.Fragment,{children:[e.jsx(f.Button,{value:"HTTP",children:"HTTP"}),e.jsx(f.Button,{value:"SOCKS4",children:"SOCKS4"}),e.jsx(f.Button,{value:"SOCKS5",children:"SOCKS5"})]})})}),e.jsxs(k,{children:[e.jsx(S,{span:16,children:e.jsx(m.Item,{name:"ip",label:e.jsx("span",{children:r("Host")}),className:`${c["required-label"]} ${c["ant-form-item-required"]} mr-5`,rules:a===d.rotation?[{required:!0,message:r("This field is required")}]:[],children:e.jsx(y,{placeholder:r("Enter your host")})})}),e.jsx(S,{span:8,children:e.jsx(m.Item,{name:"port",className:`${c["required-label"]} ${c["ant-form-item-required"]}`,label:e.jsx("span",{children:r("Port")}),rules:a===d.rotation?[C,{required:!0,message:r("This field is required")}]:[C],children:e.jsx(y,{placeholder:"EX: 8080"})})})]}),l&&(l!=null&&l.length)?e.jsx(e.Fragment,{children:e.jsx(m.Item,{name:"user_format",label:e.jsx("span",{className:"font-bold",children:r("Username")}),className:`${c["required-label"]} ${c["ant-form-item-required"]} mb-0`,rules:a===d.rotation?[{required:!0,message:r("This field is required")}]:[],children:e.jsx(y,{placeholder:"Enter your username"})})}):e.jsxs(e.Fragment,{children:[e.jsx(m.Item,{name:"user",className:`${c["required-label"]} ${c["ant-form-item-required"]} mb-0`,label:l&&(l!=null&&l.length)?e.jsx("span",{children:r("Username")}):e.jsx("span",{children:r("Proxy username format")}),rules:a===d.rotation?[{required:!0,message:r("This field is required")}]:[],children:e.jsx(y,{placeholder:"Enter your username"})}),l&&(l!=null&&l.length)?null:e.jsx(u,{italic:!0,children:r("{country}, {state}, {city}, {uuid}, {random}")})]}),l&&(l!=null&&l.length)?e.jsx(e.Fragment,{children:e.jsx(m.Item,{name:"pass_format",label:e.jsx("span",{className:"font-bold",children:r("Password")}),className:`${c["required-label"]} ${c["ant-form-item-required"]} mt-4 mb-0`,rules:a===d.rotation?[{required:!0,message:r("This field is required")}]:[],children:e.jsx(y,{placeholder:"Enter your password"})})}):e.jsxs(e.Fragment,{children:[e.jsx(m.Item,{name:"pass",label:e.jsx("span",{children:r("Proxy password format")}),className:`${c["required-label"]} ${c["ant-form-item-required"]} mt-4 mb-0`,rules:a===d.rotation?[{required:!0,message:r("This field is required")}]:[],children:e.jsx(y,{placeholder:r("Enter your password")})}),l&&(l!=null&&l.length)?null:e.jsx(u,{italic:!0,children:r("{country}, {state}, {city}, {uuid}, {random}")})]}),e.jsx(m.Item,{name:"checker",className:`${c["required-label"]} ${c["ant-form-item-required"]} mt-4 mb-0`,rules:[{required:!0,message:"This field is required!"}],label:e.jsx("span",{className:"font-bold",children:r("Check Proxy Host")}),children:e.jsx(z,{showSearch:!0,options:J})})]}),e.jsxs(S,{span:o?24:12,children:[$(window.api.APP_VERSION,"4.0.13")>0&&e.jsx(Q,{className:"mt-[30px]",type:"normal",onClick:()=>V(),loading:B,label:r("Check proxy")}),x&&e.jsxs("div",{className:"border border-solid mt-3 border-[#E6E6E6] rounded pl-3",children:[e.jsx("div",{className:"text-xl font-bold",children:r("Detail Proxy")}),e.jsx(re,{data:x})]})]})]})]})}export{fe as B,re as D,Pe as F,J as H,b as P,d as T,je as a,qe as b,be as c,C as d,Se as e,se as g,ee as h,I as r};
