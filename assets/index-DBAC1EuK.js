import{v as x,r as s,n as m,a$ as k,b0 as A,i as E,I,k as p}from"./index-CJvg638n.js";import{L as O}from"./LogDetails-B69BUudc.js";import{u as T}from"./useQuery-DJ-tefVM.js";import{g as U}from"./userSettingService-DL6083Yl.js";import{Q as W}from"./queryKey.const-4yptRpGc.js";import{D as P}from"./DeleteConfirmModal-CCC5Ho8A.js";import{u as D}from"./useTranslation-DN-CYzVf.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./theme-D5S-1fEx.js";import"./index-4M1x7pR3.js";import"./TextArea-DBRPcsh0.js";import"./index-DC1DAWbZ.js";import"./EyeOutlined-B-Yk7nA6.js";import"./SearchOutlined-Bmw6m_pM.js";import"./utils-Dji2qSVF.js";import"./index-TvTBJWU5.js";function Z(){const y=x(),o=s.useRef(null),[L,l]=s.useState(!1),{token:v}=m(e=>e.user),{currentCharge:r}=m(e=>e.chargeSlice),[f]=k(),u=s.useRef(!1),[c]=D(),n=A(({currentLocation:e,nextLocation:t})=>u.current&&e.pathname!==t.pathname),{theme:a}=m(e=>e.display),S={base_url:`${E.defaults.baseURL}/v2`||"",token:v,updateId:f.get("updateId")||"",is_clone_script:f.get("is_clone_script")||"false",autoVersion:"4",v:window.api.APP_VERSION},b=new URLSearchParams(S),M=window.api.AUTOMATION_URL,{data:d}=T({queryFn:()=>U(),queryKey:[W.userSetting]});s.useEffect(()=>{var e,t;(t=(e=o.current)==null?void 0:e.contentWindow)==null||t.postMessage({type:"user-agent-config",data:d},"*")},[d]),s.useEffect(()=>{var e,t;(t=(e=o.current)==null?void 0:e.contentWindow)==null||t.postMessage({type:"user-charge",data:r==null?void 0:r.charge},"*")},[r]),s.useEffect(()=>{var e,t;(t=(e=o.current)==null?void 0:e.contentWindow)==null||t.postMessage({type:"dark-mode",data:a},"*")},[a]);const R=()=>{var e,t,i,w,h,_;(t=(e=o.current)==null?void 0:e.contentWindow)==null||t.postMessage({type:"user-agent-config",data:d},"*"),(w=(i=o.current)==null?void 0:i.contentWindow)==null||w.postMessage({type:"user-charge",data:r==null?void 0:r.charge},"*"),(_=(h=o.current)==null?void 0:h.contentWindow)==null||_.postMessage({type:"dark-mode",data:a},"*")},g=s.useCallback(e=>{var t;switch((t=e.data)==null?void 0:t.type){case"script_change":u.current=!0;break;case"script_saved":u.current=!1;break}},[]);return s.useEffect(()=>(y(I(!0)),window.electron.ipcRenderer.on("showLog",()=>l(!0)),window.addEventListener("message",g),window.electron.ipcRenderer.send("automation_flow",{action:"start_show_screen"}),()=>{window.electron.ipcRenderer.removeAllListeners("showLog"),window.electron.ipcRenderer.send("automation_flow",{action:"stop_auto_test"}),window.removeEventListener("message",g)}),[]),s.useEffect(()=>(n.state==="blocked"&&P({title:c("Script has not been saved"),html:c("Are you sure exit without saving"),confirmButtonText:c("Save"),cancelButtonText:c("Don't save"),customClass:{title:a=="light"?"":"text-[#fff]",htmlContainer:a=="light"?"":"!text-[#fff]"}}).then(e=>{var t,i;e.isConfirmed?(n.reset(),(i=(t=o.current)==null?void 0:t.contentWindow)==null||i.postMessage({type:"action",content:"save_script"},"*")):e.dismiss&&e.dismiss!=="cancel"?n.reset():n.proceed()}),()=>{n.reset&&n.reset()}),[n.state]),p.jsxs(p.Fragment,{children:[p.jsx("iframe",{ref:o,src:`${M}?${b.toString()}`,allow:"clipboard-read; clipboard-write",onLoad:R,className:"w-full h-full m-0 border-0"}),p.jsx(O,{open:L,setOpen:l,id:"run_test"})]})}export{Z as default};
