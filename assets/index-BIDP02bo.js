import{k as e,w as _,q as v,p as w,j as N,am as E,ag as F,b1 as q,ab as A,r as x,b2 as H,P as I}from"./index-CJvg638n.js";import{u as P}from"./useQuery-DJ-tefVM.js";import{Q as C}from"./queryKey.const-4yptRpGc.js";import{a as O,u as R,d as Q,b as W}from"./automationService-CEnPLggJ.js";import{T as z}from"./index-w6IqrXlL.js";import{u as j}from"./useTranslation-DN-CYzVf.js";import{P as B}from"./Pagination-BX02S7D7.js";import{V as K}from"./index.esm-KhYhJwt_.js";import{B as U}from"./index-BAIjI0rE.js";import{D as V}from"./DeleteConfirmModal-CCC5Ho8A.js";import{u as M}from"./theme-D5S-1fEx.js";import{I as G}from"./index-4M1x7pR3.js";import{S as L}from"./index-CWlqhW57.js";import{T as Y}from"./Table-Bf5fO8hA.js";import{F as J}from"./index-jmQoDNPY.js";import{T as $}from"./index-D8gngLx0.js";import{H as X}from"./index-C_VhfCxN.js";import{T as d}from"./index-BXlHKc3j.js";import{f as D}from"./index-BlXw00gF.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./LeftOutlined-_e4uGCQm.js";import"./responsiveObserver-BQm3ddGk.js";import"./index-Wc0f9ZXJ.js";import"./index-BtoCM6cC.js";import"./index-DC1DAWbZ.js";import"./Overflow-eyj8oHJy.js";import"./PurePanel-BiIzqeBG.js";import"./TextArea-DBRPcsh0.js";import"./CheckOutlined-CxiWyKpb.js";import"./DownOutlined-BgG6dx4I.js";import"./SearchOutlined-Bmw6m_pM.js";import"./index-TvTBJWU5.js";import"./EyeOutlined-B-Yk7nA6.js";import"./gapSize-U1swVQyS.js";import"./addEventListener-0hYE1V1V.js";import"./index-DwCW4jpE.js";import"./index-Db4idn_r.js";import"./Dropdown-DXC0sGt_.js";import"./extendsObject-EOfQw3bh.js";import"./EllipsisOutlined-DODEOrOr.js";import"./collapse-C1MjllT7.js";import"./index-DRCSt6Z6.js";import"./index.esm-BKVPp4gk.js";import"./index-C2OfIzMU.js";const Z={page:1,limit:10};function ee({dataFilter:t,setDataFilter:o}){const{t:r}=j(),n=(a,c)=>{o(i=>({...i,dataFilter:{...i.dataFilter,page:a,limit:c}}))},{data:s}=P({queryFn:()=>O(t==null?void 0:t.dataFilter),queryKey:[C.schedule,t]});return e.jsxs("div",{className:"w-full p-4 gap-x-2 flex items-center justify-end",children:[e.jsx(z,{className:"!text-[16px]",label:s!=null&&s.total&&(s==null?void 0:s.total)>1?`${r("Schedules")}: ${s==null?void 0:s.total}`:`${r("Schedule")}: ${s==null?void 0:s.total}`}),e.jsx(B,{pageSize:t==null?void 0:t.dataFilter.limit,current:t==null?void 0:t.dataFilter.page,pageSizeOptions:[10,20,50,100],total:(s==null?void 0:s.total)||0,showSizeChanger:!0,onChange:n,locale:{items_per_page:r("page")}})]})}const te="_input_dluou_1",se={input:te};function oe({columns:t,setColumns:o,dataFilter:r,setDataFilter:n,selectedRowKeys:s,setSelectedRowKeys:a}){_.useToken();const c=M(),{message:i}=v.useApp(),{t:m}=j();w();const g=l=>n(u=>({...u,dataFilter:{...u.dataFilter,search:l}})),h=N(),y=async l=>{if(!s.length)return;await Promise.all(s.map(async function(f){const b=await R(f,l).catch(T=>{var k;(k=T.response.data)!=null&&k.message?i.error(T.response.data.message):i.error("Update error!!!")});b&&(i.success(b.data.message),h.invalidateQueries(C.schedule))}))},p=async l=>{if(A.isEmpty(s))return l.stopPropagation();V().then(async u=>{u.isConfirmed&&Q(s).then(f=>{i.success(f.data.message),a([]),h.invalidateQueries(C.schedule)}).catch(f=>{var b;(b=f.response.data)!=null&&b.message?i.error(f.response.data.message):i.error("Delete error!!!")})})},S=[{icon:e.jsx(E,{}),label:m("Run schedule"),type:"primary",disable:!!s.length,action:()=>y("RUNNING")},{icon:e.jsx(F,{}),label:m("Delete"),type:"error",disable:!!s.length,action:p},{icon:e.jsx(q,{}),label:m("Stop schedule"),type:"error",disable:!!s.length,action:()=>y("STOP")}];return e.jsxs("div",{className:"relative",style:{backgroundColor:c.backgroundNormal},children:[e.jsx("div",{className:se.input+" w-[300px]",children:e.jsx(G.Search,{prefix:e.jsx(K,{className:"text-[#C0C0C0] me-1"}),placeholder:"Search...",onChange:l=>g(l.currentTarget.value)})}),e.jsx(L,{className:"mt-5",children:S.map((l,u)=>e.jsx(U,{icon:l.icon,label:l.label,onClick:l.action,isDisabled:!l.disable,typebutton:l.type},u))})]})}const ne=x.createContext({confirmDelete:async t=>{}});function le({children:t}){N();const{modal:o,message:r}=v.useApp(),n=async c=>{},a={confirmDelete:async c=>{await o.confirm({title:"Are you sure delete this script?",icon:e.jsx(H,{}),content:"Some descriptions",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>n()})}};return e.jsx(ne.Provider,{value:a,children:t})}const ae=({columns:t,selectedRowKeys:o,setSelectedRowKeys:r,dataFilter:n})=>{const s=M(),a=x.useRef(null);_.useToken();const{data:c,isLoading:i}=P({queryFn:()=>W({...n.dataFilter}),queryKey:[C.schedule,n],refetchOnMount:!0,refetchOnWindowFocus:!0}),g={selectedRowKeys:o,onChange:p=>{r(p)}},h=w(),y=p=>({onClick:()=>h(`${I.work_log}?schedule=${p.id}`)});return e.jsx("div",{className:"overflow-auto w-full pr-4 mt-5",children:e.jsx(Y,{rowSelection:g,columns:t,dataSource:(c==null?void 0:c.schedules)||[],rowKey:"id",className:"overflow-auto border-[.5px] border-solid shadow-sm rounded-lg",style:{borderColor:s.borderNormal,height:"-webkit-fill-available"},loading:i,pagination:!1,ref:a,onRow:y})})},re=x.memo(ae);function ie({item:t}){const{t:o}=j();x.useState(!1);const n={1:{backgroundColor:"#6D6D6D",label:o("Pending")},2:{backgroundColor:"#E0822D",label:o("Running")},3:{backgroundColor:"#2CDE35",label:o("Complete")},4:{backgroundColor:"#EF1517",label:o("Stop")}}[t.status],s=(n==null?void 0:n.backgroundColor)||"",a=(n==null?void 0:n.label)||"";return e.jsx(e.Fragment,{children:e.jsx(J,{gap:"10px",justify:"center",children:e.jsx("div",{style:{backgroundColor:s},className:"flex items-center text-white py-1 px-2 rounded-[4px]",children:a})})})}const ce={1:{label:"Once"},2:{label:"Interval"},3:{label:"Daily"},4:{label:"Weekly"},5:{label:"Monthly"}},ue={1:{label:"Common"},2:{label:"Schedule"}},me={0:{label:"Sun"},1:{label:"Mon"},2:{label:"Tue"},3:{label:"Wed"},4:{label:"Thu"},5:{label:"Fri"},6:{label:"Sat"}};function de({task_type:t,execution_frequency:o,execute_time:r,execute_day:n}){const{Text:s}=$,a=ue[t],c=ce[o],i=(a==null?void 0:a.label)||"",m=(c==null?void 0:c.label)||"",g=r?` - ${r}`:"",{t:h}=j(),p=(S=>{var u;let l="";return m==="Weekly"?l=` - ${(u=me[S])==null?void 0:u.label}`:m==="Monthly"&&(l=` - ${S}`),l})(n)??"";return e.jsx(e.Fragment,{children:e.jsx(s,{children:h(i==="Common"?i:m+p+g)})})}const{Text:pe}=$,xe=t=>{const{t:o}=j();return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(X,{hint:o(t.hint),children:e.jsx(pe,{className:"!text-inherit",children:o(t.title)})})})},he=[{title:e.jsx(d,{title:"Name"}),align:"center",render:(t,o)=>o.name},{title:e.jsx(xe,{hint:"With schedule ( Execution frequency - execute day or monthly - execute time)",title:"Task type"}),align:"center",width:240,render:(t,o)=>o.task_type?e.jsx(de,{task_type:o.task_type,execution_frequency:o.execution_frequency,execute_time:o.execute_time,execute_day:o.execute_day}):null},{title:e.jsx(d,{title:"Profiles pending"}),align:"center",dataIndex:"total_profile_pending"},{title:e.jsx(d,{title:"Profiles running"}),align:"center",dataIndex:"total_profile_running"},{title:e.jsx(d,{title:"Profiles success"}),align:"center",dataIndex:"total_profile_success"},{title:e.jsx(d,{title:"Profiles error"}),align:"center",dataIndex:"total_profile_error"},{title:e.jsx(d,{title:"Start time"}),align:"center",dataIndex:"start_time",render:t=>t?D(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(d,{title:"End time"}),align:"center",dataIndex:"end_time",render:t=>t?D(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(d,{title:"Status"}),align:"center",render:t=>e.jsx(ie,{item:t})}];function rt(){const[t,o]=x.useState({dataFilter:Z}),[r,n]=x.useState(he),[s,a]=x.useState([]);return e.jsx(e.Fragment,{children:e.jsx(le,{children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"h-full overflow-y-hidden flex flex-col relative mt-5",children:[e.jsx(oe,{columns:r,setColumns:n,dataFilter:t,setDataFilter:o,selectedRowKeys:s,setSelectedRowKeys:a}),e.jsx(re,{columns:r,selectedRowKeys:s,setSelectedRowKeys:a,dataFilter:t})]}),e.jsx(ee,{dataFilter:t,setDataFilter:o})]})})})}export{rt as default};
