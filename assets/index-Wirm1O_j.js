import{i as F,b7 as P,b8 as D,b9 as K,ba as L,r as u,q as H,j as q,k as e,N as C,w as M}from"./index-CJvg638n.js";import{B as A}from"./index-BAIjI0rE.js";import{Q as o}from"./queryKey.const-4yptRpGc.js";import{D as E}from"./DeleteConfirmModal-CCC5Ho8A.js";import{a as z}from"./commonHelpers-BOkgPZYN.js";import{u as j}from"./useTranslation-DN-CYzVf.js";import{F as U}from"./index-jmQoDNPY.js";import{T as v}from"./index-BXlHKc3j.js";import{H as W}from"./HeaderContext-CcFwS_UE.js";import{u as _}from"./theme-D5S-1fEx.js";import{u as k}from"./useQuery-DJ-tefVM.js";import{P as B}from"./Pagination-BX02S7D7.js";import{T as $}from"./Table-Bf5fO8hA.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./index-TvTBJWU5.js";import"./gapSize-U1swVQyS.js";import"./index-D8gngLx0.js";import"./index-DC1DAWbZ.js";import"./index-BtoCM6cC.js";import"./TextArea-DBRPcsh0.js";import"./CheckOutlined-CxiWyKpb.js";import"./index-w6IqrXlL.js";import"./index-Cn7Yo5Hv.js";import"./PurePanel-BiIzqeBG.js";import"./index-4M1x7pR3.js";import"./EyeOutlined-B-Yk7nA6.js";import"./SearchOutlined-Bmw6m_pM.js";import"./row-C7cWNtLw.js";import"./responsiveObserver-BQm3ddGk.js";import"./index-DGGwne6Z.js";import"./EllipsisOutlined-DODEOrOr.js";import"./Overflow-eyj8oHJy.js";import"./PlusOutlined-B9MlVXp_.js";import"./Dropdown-DXC0sGt_.js";import"./utils-Dji2qSVF.js";import"./LeftOutlined-_e4uGCQm.js";import"./index-Wc0f9ZXJ.js";import"./DownOutlined-BgG6dx4I.js";import"./addEventListener-0hYE1V1V.js";import"./index-DwCW4jpE.js";import"./index-Db4idn_r.js";import"./extendsObject-EOfQw3bh.js";import"./collapse-C1MjllT7.js";import"./index-CWlqhW57.js";import"./index-DRCSt6Z6.js";const I=async t=>await F.get(P,{params:t}),J=async t=>await F.delete(D,{data:{transfer_uuid:t}}),V=async t=>await F.post(K,{transfer_uuid:t}),G=async t=>await F.delete(L,{data:{transfer_uuid:t}}),g=u.createContext({confirmAccept:async t=>{},confirmCancel:async t=>{},confirmReject:async t=>{},selectedRowKeys:[],setSelectedRowKeys:t=>{},filterState:{},setFilterState:t=>{},activeType:"receive",setActiveType:t=>{}}),X={page:1,limit:10,search:"",option:"receive"},Y={isOpenFilter:!1,dataFilter:X};function Z({children:t}){const{modal:r,message:s}=H.useApp(),a=q(),[l,c]=u.useState([]),[p,d]=u.useState(Y),[m,h]=u.useState("receive"),x=async i=>{E().then(async n=>{n.isConfirmed&&await R(i)})},R=async i=>{await V(i).then(n=>{s.success("Accept success"),c([""]),a.invalidateQueries(o.transfer),a.invalidateQueries(o.listProfile,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_CLOUD,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_SHARE_WITH_ME,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_OWNER,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_SHARE,{refetchInactive:!0}),a.invalidateQueries(o.userDetail,{refetchInactive:!0})}).catch(n=>{console.log(n),s.error(n.response.data.title)})},y=async i=>{E().then(async n=>{n.isConfirmed&&await S(i).then(b=>{a.invalidateQueries(o.transfer),a.invalidateQueries(o.listProfile,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_CLOUD,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_SHARE_WITH_ME,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_OWNER,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_SHARE,{refetchInactive:!0}),a.invalidateQueries(o.userDetail,{refetchInactive:!0})})})},S=async i=>{await J(i).then(n=>{s.success("Cancel success"),c([""]),a.invalidateQueries(o.transfer)}).catch(n=>{console.log(n),s.error(n.response.data.title)})},w=async i=>{E().then(async n=>{n.isConfirmed&&await T(i)})},T=async i=>{await G(i).then(n=>{s.success("Reject success"),c([""]),a.invalidateQueries(o.transfer)}).catch(n=>{console.log(n),s.error(n.response.data.title)})},f={confirmAccept:x,confirmCancel:y,confirmReject:w,selectedRowKeys:l,setSelectedRowKeys:c,filterState:p,setFilterState:d,activeType:m,setActiveType:h};return e.jsx(g.Provider,{value:f,children:t})}function ee({item:t}){const{activeType:r,confirmAccept:s,confirmCancel:a,confirmReject:l}=u.useContext(g),{t:c}=j();return e.jsx(e.Fragment,{children:e.jsxs(U,{gap:"10px",justify:"center",children:[r=="receive"&&e.jsxs(e.Fragment,{children:[e.jsx(C,{type:"primary",className:"flex items-center",onClick:()=>s([t.uuid]),disabled:(t==null?void 0:t.status)!="waiting",children:c("Accept")}),e.jsx(C,{type:"primary",danger:!0,className:"flex items-center",onClick:()=>l([t.uuid]),disabled:(t==null?void 0:t.status)!="waiting",children:c("Reject")})]}),r=="send"&&e.jsx(e.Fragment,{children:e.jsx(C,{type:"primary",danger:!0,className:"flex items-center",onClick:()=>a([t.uuid]),disabled:(t==null?void 0:t.status)!="waiting",children:c("Cancel")})})]})})}const te=[{color:"417AFF",id:"waiting",name:"Waiting"},{color:"2CDE35",id:"accept",name:"Accept"},{color:"F5841F",id:"cancel",name:"Cancel"},{color:"ef4444",id:"reject",name:"Reject"}];function re({data:t}){const r=u.useMemo(()=>te.find(({id:a})=>a===t.status),[t]),{t:s}=j();return e.jsx(e.Fragment,{children:e.jsx(C,{className:"cursor-none, disabled:hover",style:{color:`#${(r==null?void 0:r.color)||""}`,borderColor:`#${(r==null?void 0:r.color)||""}`},size:"small",children:s((r==null?void 0:r.name)||"No status")})})}const O=[{title:e.jsx(v,{title:"Profiles"}),align:"center",dataIndex:"browsers"},{title:e.jsx(v,{title:"From"}),align:"center",dataIndex:"from_user"},{title:e.jsx(v,{title:"To"}),align:"center",dataIndex:"to_user"},{title:e.jsx(v,{title:"Status"}),align:"center",render:(t,r)=>e.jsx(re,{data:r})},{title:e.jsx(v,{title:"Created at"}),align:"center",render:(t,r)=>z(r.created_at)},{title:e.jsx(v,{title:"Action"}),fixed:"right",align:"center",render:t=>e.jsx(ee,{item:t})}],ae=["No","Profiles","To","Status","Created at","Action"],se=["No","Profiles","From","Status","Created at","Action"];function ie({columns:t,setColumns:r}){const s=_(),[a,l]=u.useState("");M.useToken();const{selectedRowKeys:c,setFilterState:p,activeType:d,setActiveType:m,confirmAccept:h,confirmCancel:x,confirmReject:R}=u.useContext(g),{t:y}=j(),S=f=>p(i=>({...i,dataFilter:{...i.dataFilter,search:f}})),w=f=>{m(f),p(i=>({dataFilter:{...i.dataFilter,option:f}}))},T=[{key:"receive",title:y("Receive"),type:"receive",id:[]},{key:"send",title:y("Send"),type:"send",id:[]}];return u.useEffect(()=>{const f=O.filter(i=>{var n,b,N,Q;if(console.log({col:i}),d=="receive")return se.includes((b=(n=i.title)==null?void 0:n.props)==null?void 0:b.title);if(d=="send")return ae.includes((Q=(N=i.title)==null?void 0:N.props)==null?void 0:Q.title)});r(f)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(W,{tabs:T,handleChangeTab:w,search:a,onSearch:S,defaultActiveKey:d,namePage:"Transfer"}),c.length?e.jsxs("div",{style:{backgroundColor:s.backgroundNormal},className:"flex gap-x-3 !min-h-[55px] items-center py-2 rounded-md w-[calc(100%-4px)] overflow-x-scroll no-scorllbar overflow-y-hidden",children:[d=="receive"&&e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:"",label:y("Accept"),onClick:()=>h(c),typebutton:"primary"},1),e.jsx(A,{icon:"",label:y("Reject"),onClick:()=>R(c),typebutton:"error"},2)]}),d=="send"&&e.jsx(e.Fragment,{children:e.jsx(A,{icon:"",label:"Cancel",onClick:()=>x(c),typebutton:"error"},2)})]}):""]})}function ne(){const{t}=j(),{filterState:r,setFilterState:s}=u.useContext(g),a=(...c)=>{const[p,d]=c;s(m=>({...m,dataFilter:{...m.dataFilter,page:p,limit:d}}))},{data:l}=k({queryFn:()=>I(r.dataFilter),queryKey:[o.transfer,r.dataFilter]});return e.jsx("div",{className:"w-full p-4 text-end z-10",children:e.jsx(B,{pageSize:r.dataFilter.limit,current:r.dataFilter.page,pageSizeOptions:[10,20,50,100],total:(l==null?void 0:l.data.meta.total)||0,showQuickJumper:!0,onChange:a,showSizeChanger:!0,showTitle:!1,locale:{items_per_page:t("page")}})})}const oe={"header-fixed":"_header-fixed_8q965_1"};function ce({columns:t}){_();const{filterState:r,selectedRowKeys:s,setSelectedRowKeys:a}=u.useContext(g),{data:l,isFetching:c}=k({queryFn:()=>I(r.dataFilter),queryKey:[o.transfer,r.dataFilter],onSuccess:m=>{const h=m.data.data.content.filter(x=>s.includes(x.uuid)).map(x=>x.uuid);a(h)}}),d={selectedRowKeys:s,onChange:m=>{a(m)}};return e.jsx("div",{className:"w-full overflow-auto",children:e.jsx($,{rowSelection:d,className:`${oe["header-fixed"]}`,columns:t,rowKey:"uuid",loading:{spinning:c},rowClassName:(m,h)=>h===3?"scroll-row":"",dataSource:(l==null?void 0:l.data.data.content)||[],pagination:!1})})}function et(){const[t,r]=u.useState(O),s=_();return e.jsx(e.Fragment,{children:e.jsx(Z,{children:e.jsxs("div",{className:"flex flex-col h-full pr-5",children:[e.jsxs("div",{className:"rounded-tl-md overflow-y-hidden flex flex-col relative w-full h-full",style:{backgroundColor:s.backgroundNormal},children:[e.jsx(ie,{columns:t,setColumns:r}),e.jsx("div",{id:"table-hidemium",className:"h-[calc(100vh-195px)] mr-5 rounded-lg border border-solid shadow-sm overflow-auto",style:{backgroundColor:s.backgroundLight,borderColor:s.borderNormal},children:e.jsx(ce,{columns:t})})]}),e.jsx(ne,{})]})})})}export{et as default};
