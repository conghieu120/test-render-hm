import{k as e,q as D,p as v,j as w,am as $,ag as E,b1 as F,ab as q,r as x,b2 as A,w as H,P as I}from"./index-rD5D3wIe.js";import{u as N}from"./useQuery-DGelT77v.js";import{Q as C}from"./queryKey.const-4yptRpGc.js";import{a as O,u as Q,d as R,b as W}from"./automationService-ItdDN5Ql.js";import{T as z}from"./index-CwHt7GoT.js";import{u as j}from"./useTranslation-CdVDZguR.js";import{P as B}from"./Pagination-Du9klKsI.js";import{V as K}from"./index.esm-V36bXi1-.js";import{B as U}from"./index-Cnfr_LhE.js";import{D as V}from"./DeleteConfirmModal-DSBDXsxU.js";import{u as P}from"./theme-CwYL3eQV.js";import{I as G}from"./index-R7zUTNyO.js";import{S as L}from"./index-DEeuvegC.js";import{T as Y}from"./Table-CkCjhjFV.js";import{F as J}from"./index-C7QdTRRe.js";import{T as M}from"./index-WqkPP-4X.js";import{H as X}from"./index-DxAHe7sQ.js";import{T as d}from"./index-e-kTAu8U.js";import{f as k}from"./index-B3nBNj8d.js";import"./commonjsHelpers__-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./LeftOutlined-hwnj7f46.js";import"./responsiveObserver-CoLEQsUO.js";import"./index-Cw8dqNCZ.js";import"./index-BUNugdcr.js";import"./index-VaFpLiuL.js";import"./Overflow-wzPxOxK8.js";import"./PurePanel-CzAY4fQy.js";import"./TextArea-D8GM8mUo.js";import"./CheckOutlined-CxcD5R4P.js";import"./DownOutlined-U_yyBD4s.js";import"./SearchOutlined-DPpNmpde.js";import"./index-bFDahTXa.js";import"./EyeOutlined-D2K23cwb.js";import"./gapSize-U1swVQyS.js";import"./addEventListener-Dnrwfmdl.js";import"./index-C97G-hLo.js";import"./index-c2ufQ9kY.js";import"./Dropdown-BA274VvY.js";import"./extendsObject-BTpHJDoQ.js";import"./EllipsisOutlined-Cvv2ECO7.js";import"./collapse-C1MjllT7.js";import"./index-Rll6gE4e.js";import"./index.esm-pljYh1ir.js";import"./index-DQqevswW.js";const Z={page:1,limit:10};function ee({dataFilter:t,setDataFilter:o}){const{t:r}=j(),n=(a,c)=>{o(i=>({...i,dataFilter:{...i.dataFilter,page:a,limit:c}}))},{data:s}=N({queryFn:()=>O(t==null?void 0:t.dataFilter),queryKey:[C.schedule,t]});return e.jsxs("div",{className:"w-full p-4 gap-x-2 flex items-center justify-end",children:[e.jsx(z,{className:"!text-[16px]",label:s!=null&&s.total&&(s==null?void 0:s.total)>1?`${r("Schedules")}: ${s==null?void 0:s.total}`:`${r("Schedule")}: ${s==null?void 0:s.total}`}),e.jsx(B,{pageSize:t==null?void 0:t.dataFilter.limit,current:t==null?void 0:t.dataFilter.page,pageSizeOptions:[10,20,50,100],total:(s==null?void 0:s.total)||0,showSizeChanger:!0,onChange:n,locale:{items_per_page:r("page")}})]})}const te="_input_dluou_1",se={input:te};function oe({columns:t,setColumns:o,dataFilter:r,setDataFilter:n,selectedRowKeys:s,setSelectedRowKeys:a}){const c=P(),{message:i}=D.useApp(),{t:m}=j();v();const g=l=>n(u=>({...u,dataFilter:{...u.dataFilter,search:l}})),h=w(),y=async l=>{if(!s.length)return;await Promise.all(s.map(async function(f){const b=await Q(f,l).catch(T=>{var _;(_=T.response.data)!=null&&_.message?i.error(T.response.data.message):i.error("Update error!!!")});b&&(i.success(b.data.message),h.invalidateQueries(C.schedule))}))},p=async l=>{if(q.isEmpty(s))return l.stopPropagation();V().then(async u=>{u.isConfirmed&&R(s).then(f=>{i.success(f.data.message),a([]),h.invalidateQueries(C.schedule)}).catch(f=>{var b;(b=f.response.data)!=null&&b.message?i.error(f.response.data.message):i.error("Delete error!!!")})})},S=[{icon:e.jsx($,{}),label:m("Run schedule"),type:"primary",disable:!!s.length,action:()=>y("RUNNING")},{icon:e.jsx(E,{}),label:m("Delete"),type:"error",disable:!!s.length,action:p},{icon:e.jsx(F,{}),label:m("Stop schedule"),type:"error",disable:!!s.length,action:()=>y("STOP")}];return e.jsxs("div",{className:"relative",style:{backgroundColor:c.backgroundNormal},children:[e.jsx("div",{className:se.input+" w-[300px]",children:e.jsx(G.Search,{prefix:e.jsx(K,{className:"text-[#C0C0C0] me-1"}),placeholder:"Search...",onChange:l=>g(l.currentTarget.value)})}),s.length>0&&e.jsx(L,{className:"mt-5",children:S.map((l,u)=>e.jsx(U,{icon:l.icon,label:l.label,onClick:l.action,buttonMenu:!0,disabled:!l.disable,type:l.type},u))})]})}const ne=x.createContext({confirmDelete:async t=>{}});function le({children:t}){w();const{modal:o,message:r}=D.useApp(),n=async c=>{},a={confirmDelete:async c=>{await o.confirm({title:"Are you sure delete this script?",icon:e.jsx(A,{}),content:"Some descriptions",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>n()})}};return e.jsx(ne.Provider,{value:a,children:t})}const ae=({columns:t,selectedRowKeys:o,setSelectedRowKeys:r,dataFilter:n})=>{const s=P(),a=x.useRef(null);H.useToken();const{data:c,isLoading:i}=N({queryFn:()=>W({...n.dataFilter}),queryKey:[C.schedule,n],refetchOnMount:!0,refetchOnWindowFocus:!0}),g={selectedRowKeys:o,onChange:p=>{r(p)}},h=v(),y=p=>({onClick:()=>h(`${I.work_log}?schedule=${p.id}`)});return e.jsx("div",{className:"overflow-auto w-full pr-4 mt-5",children:e.jsx(Y,{rowSelection:g,columns:t,dataSource:(c==null?void 0:c.schedules)||[],rowKey:"id",className:"overflow-auto border-[.5px] border-solid shadow-sm rounded-lg",style:{borderColor:s.borderNormal,height:"-webkit-fill-available"},loading:i,pagination:!1,ref:a,onRow:y})})},re=x.memo(ae);function ie({item:t}){const{t:o}=j();x.useState(!1);const n={1:{backgroundColor:"#6D6D6D",label:o("Pending")},2:{backgroundColor:"#E0822D",label:o("Running")},3:{backgroundColor:"#2CDE35",label:o("Complete")},4:{backgroundColor:"#EF1517",label:o("Stop")}}[t.status],s=(n==null?void 0:n.backgroundColor)||"",a=(n==null?void 0:n.label)||"";return e.jsx(e.Fragment,{children:e.jsx(J,{gap:"10px",justify:"center",children:e.jsx("div",{style:{backgroundColor:s},className:"flex items-center text-white py-1 px-2 rounded-[4px]",children:a})})})}const ce={1:{label:"Once"},2:{label:"Interval"},3:{label:"Daily"},4:{label:"Weekly"},5:{label:"Monthly"}},ue={1:{label:"Common"},2:{label:"Schedule"}},me={0:{label:"Sun"},1:{label:"Mon"},2:{label:"Tue"},3:{label:"Wed"},4:{label:"Thu"},5:{label:"Fri"},6:{label:"Sat"}};function de({task_type:t,execution_frequency:o,execute_time:r,execute_day:n}){const{Text:s}=M,a=ue[t],c=ce[o],i=(a==null?void 0:a.label)||"",m=(c==null?void 0:c.label)||"",g=r?` - ${r}`:"",{t:h}=j(),p=(S=>{var u;let l="";return m==="Weekly"?l=` - ${(u=me[S])==null?void 0:u.label}`:m==="Monthly"&&(l=` - ${S}`),l})(n)??"";return e.jsx(e.Fragment,{children:e.jsx(s,{children:h(i==="Common"?i:m+p+g)})})}const{Text:pe}=M,xe=t=>{const{t:o}=j();return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(X,{hint:o(t.hint),children:e.jsx(pe,{className:"!text-inherit",children:o(t.title)})})})},he=[{title:e.jsx(d,{title:"Name"}),align:"center",render:(t,o)=>o.name},{title:e.jsx(xe,{hint:"With schedule ( Execution frequency - execute day or monthly - execute time)",title:"Task type"}),align:"center",width:240,render:(t,o)=>o.task_type?e.jsx(de,{task_type:o.task_type,execution_frequency:o.execution_frequency,execute_time:o.execute_time,execute_day:o.execute_day}):null},{title:e.jsx(d,{title:"Profiles pending"}),align:"center",dataIndex:"total_profile_pending"},{title:e.jsx(d,{title:"Profiles running"}),align:"center",dataIndex:"total_profile_running"},{title:e.jsx(d,{title:"Profiles success"}),align:"center",dataIndex:"total_profile_success"},{title:e.jsx(d,{title:"Profiles error"}),align:"center",dataIndex:"total_profile_error"},{title:e.jsx(d,{title:"Start time"}),align:"center",dataIndex:"start_time",render:t=>t?k(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(d,{title:"End time"}),align:"center",dataIndex:"end_time",render:t=>t?k(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(d,{title:"Status"}),align:"center",render:t=>e.jsx(ie,{item:t})}];function rt(){const[t,o]=x.useState({dataFilter:Z}),[r,n]=x.useState(he),[s,a]=x.useState([]);return e.jsx(e.Fragment,{children:e.jsx(le,{children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"h-full overflow-y-hidden flex flex-col relative mt-5",children:[e.jsx(oe,{columns:r,setColumns:n,dataFilter:t,setDataFilter:o,selectedRowKeys:s,setSelectedRowKeys:a}),e.jsx(re,{columns:r,selectedRowKeys:s,setSelectedRowKeys:a,dataFilter:t})]}),e.jsx(ee,{dataFilter:t,setDataFilter:o})]})})})}export{rt as default};
