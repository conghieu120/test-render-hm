import{$ as N,q as L,v as O,p as b,r as n,k as e,N as S,a5 as B,P as v,z as V,G as D,n as I}from"./index-CJvg638n.js";import{s as p,S as $}from"./index-CuxsWerf.js";import{A as H}from"./index.modern-DabBZbjo.js";import{v as q,a as y}from"./auth-8cqRmsX-.js";import{M as G}from"./ModalQuitApp-DU1DXQCK.js";import{u as F}from"./theme-D5S-1fEx.js";import{F as f}from"./index-YCIRg4HO.js";import{u as C}from"./useTranslation-DN-CYzVf.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./index.esm-mlJjdzQr.js";import"./index.esm-DoK_4CPo.js";import"./index.esm-LNwInclH.js";import"./useMutation-DtMNI5dJ.js";import"./utils-Dji2qSVF.js";import"./index-BAIjI0rE.js";import"./index-Cn7Yo5Hv.js";import"./PurePanel-BiIzqeBG.js";import"./index-D8gngLx0.js";import"./index-DC1DAWbZ.js";import"./index-BtoCM6cC.js";import"./TextArea-DBRPcsh0.js";import"./CheckOutlined-CxiWyKpb.js";import"./collapse-C1MjllT7.js";import"./row-C7cWNtLw.js";import"./responsiveObserver-BQm3ddGk.js";const z=N.memo(({modeDisplay:c,receivedData:r,user:s})=>{const[l]=f.useForm(),{t}=C(),{message:i}=L.useApp(),u=O(),h=b();let w=120;const[x,j]=n.useState(r.state&&r.resendOtpNow?0:w),m=n.useRef(!1),E=n.useRef(null),[_,A]=n.useState(""),g=F(),T=o=>{A(o)},M=async()=>{const o=await l.validateFields();let a="";s.action==="register"?a="register":a="login",await q({uuid:s.uuid,action:a,...o}).then(d=>{d.data.type==="success"?(i.success("Login successfully!"),u(B(d.data.content)),m.current=!1,h(v.profiles)):i.error(d.data.title)}).catch(d=>{i.error(d.response.data.title)})};n.useEffect(()=>{m.current=!0,m&&(async()=>(r.hasOwnProperty("twofa")&&await y({uuid:s.uuid,action:"login",twofa:!0}).then(a=>{i.success(a.data.title)}),m.current=!1))()},[]),n.useEffect(()=>{let o=setInterval(()=>{j(a=>a>0?a-1:a)},1e3);return()=>clearInterval(o)},[]);const P=async()=>{s.uuid===null&&i.error("Please go back to log in");let o={uuid:s.uuid,action:"register",twofa:!0};r.twofa&&(o={uuid:s.uuid,action:"login",twofa:!0}),await y(o).then(a=>(i.success(a.data.title),a)).catch(a=>{i.error(a.message)}).then(()=>{j(w)})},R=o=>{m.current=!1,o.preventDefault(),u(V()),h(v.login,{state:"/sign-in"})},k=()=>{m.current=!1,h(v.verify_twofa,{state:{uuid:s.uuid,action:s.action,twofa:3}})};return e.jsxs("div",{className:"mb-[10px]",children:[e.jsx("h3",{className:"text-[20px] leading-[30px] text-center font-semibold text-[#2263B3]",children:t("Verify OTP code")}),e.jsx("p",{style:{color:g.textNormal},className:"text-center text-[14px] font-semibold mb-[20px]",children:t("Enter the 6 - Digit code below from your Code Generator")}),x==0?e.jsxs("h4",{style:{color:g.textNormal},className:"text-center text-[14px]",children:[" ",t("Didnâ€™t receive the OTP? "),e.jsx("a",{className:"text-[14px] text-[#2263B3] hover:text-[#2263B3] hover:underline",onClick:P,children:t("Resend OTP")})]}):e.jsxs("h4",{style:{color:g.textNormal},className:"text-center text-[14px]",children:[t("Resend OTP in "),e.jsxs("span",{className:"text-[14px] text-[#2CDE35]",children:[Math.floor(x/60),":",x%60==0?"00":x%60,"s"]})]}),e.jsxs(f,{style:{width:332.36,margin:"0 auto"},onFinish:M,layout:"vertical",autoComplete:"off",form:l,initialValues:{prefix:"84"},children:[e.jsx(f.Item,{className:"font-semibold "+p["required-label"]+" "+p["custom-label"]+" "+p["custom-input-ant"],name:"otp",children:e.jsx(H,{autoFocus:!1,onChange:T,allowedCharacters:"numeric",ref:E,inputClassName:"rounded-[5px] border border-solid border-gray-300 w-[13%] h-[45px] p-0 text-center m-[5px] text-[24px]"})}),e.jsx(f.Item,{className:"mt-[25px]",children:e.jsx(S,{className:`${p["btn-custom-primary"]}`,type:"primary",htmlType:"submit",style:{width:"100%"},children:t("Verify")})})]}),e.jsx("div",{className:"flex flex-col justify-center items-center",children:e.jsxs("span",{className:"font-medium text-[14px] leading-[13.62px] "+(c==="light"?"text-[#000000]":"text-[#ffffff]"),children:[t("Don't have an account ?")," ",e.jsx("a",{className:"text-[#2263B3] hover:text-[#2263B3] hover:underline",onClick:R,children:t("Login")})]})}),r.twofa===3?e.jsx("div",{className:"mt-[5px] flex flex-col justify-center items-center mb-[15px]",children:e.jsxs("span",{className:"font-medium text-[14px] leading-[13.62px] "+(c==="light"?"text-[#000000]":"text-[#ffffff]"),children:[t("or")," ",e.jsx("a",{className:"text-[#2263B3] hover:text-[#2263B3] hover:underline",onClick:k,children:t("Authenticate with App")})]})}):e.jsx(e.Fragment,{}),e.jsx(G,{})]})});function ve(){const[c,r]=n.useState(""),s=F();n.useEffect(()=>{const t=window.location.pathname;return r(t||"/sign-in"),window.addEventListener("popstate",l),()=>{window.removeEventListener("popstate",l)}},[]);const l=()=>{const t=window.location.pathname;r(t||"/sign-in")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{backgroundColor:s.backgroundNormal},className:"w-[100vw] h-[100vh] m-[0]-auto grid grid-cols-[1fr] bg-no-repeat overflow-hidden",children:e.jsx("div",{className:"relative flex flex-col justify-center items-center",children:e.jsx("div",{style:{backgroundColor:s.backgroundLight,boxShadow:"0px 2.1060240268707275px 9.82811164855957px 0px #00000008,0px 5.616064071655273px 22.464256286621094px 0px #00000012,0px 21.060239791870117px 58.96867370605469px 0px #00000001,0px 4px 4px 0px #00000040"},className:"relative overflow-hidden flex flex-col justify-center items-center bg-[#FFFFFF] rounded-[20px] w-[538px] min-h-[342px]",children:e.jsx("div",{className:`h-full w-full ${p["form-login"]} ${p["form-login-active"]}`,children:e.jsx(Q,{onPopstate:l})})})})}),e.jsx($,{})]})}const Q=N.memo(({onPopstate:c})=>{C();const r=D();b();const s=r.state,l=n.useRef(!0),t=s.modal2fa,{theme:i}=I(u=>u.display);return n.useEffect(()=>(window.addEventListener("popstate",c),()=>{window.removeEventListener("popstate",c)}),[c]),n.useEffect(()=>{l.current=!0},[]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"relative flex flex-col justify-center items-center",children:e.jsx(z,{modeDisplay:i,user:t,receivedData:s})})})});export{ve as default};
