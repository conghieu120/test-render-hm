import{i as A,b3 as ae,b4 as re,b5 as ie,b6 as oe,r as d,q as U,j as W,k as e,l as ne,n as ce}from"./index-rD5D3wIe.js";import{Q as C}from"./queryKey.const-4yptRpGc.js";import{D as me}from"./DeleteConfirmModal-DSBDXsxU.js";import{u as de}from"./useMutation-7pHNuXnK.js";import{g as ue}from"./folderService-DJTjQCA7.js";import{g as pe}from"./tagService-DBP5wH-n.js";import{g as xe}from"./statusService-EwMmqDzr.js";import{T as g}from"./index-CwHt7GoT.js";import{B}from"./index-Cnfr_LhE.js";import{t as R}from"./truncateString-BKM5_Dcw.js";import{u as G}from"./theme-CwYL3eQV.js";import{b as k}from"./index.esm-oalvffsi.js";import{F as j}from"./index-D0qsI2Ko.js";import{u as F}from"./useTranslation-CdVDZguR.js";import{M as fe}from"./index-DduQbOjH.js";import{I as z}from"./index-R7zUTNyO.js";import{S as D}from"./index-Cw8dqNCZ.js";import{T as q}from"./index-KwqCHwvs.js";import{R as he,C as H}from"./row-D9yJnvb0.js";import{S as I}from"./index-DeZc1mMx.js";import{I as ge}from"./Icon-BO7gCnsj.js";import{u as K}from"./useQuery-DGelT77v.js";import{P as be}from"./Pagination-Du9klKsI.js";import{D as O}from"./index-CLJiH4Bi.js";import"./commonjsHelpers-BosuxZz1.js";import"./index-bFDahTXa.js";import"./utils-Dji2qSVF.js";import"./index-WqkPP-4X.js";import"./index-VaFpLiuL.js";import"./index-BUNugdcr.js";import"./TextArea-D8GM8mUo.js";import"./CheckOutlined-CxcD5R4P.js";import"./collapse-C1MjllT7.js";import"./PurePanel-CzAY4fQy.js";import"./EyeOutlined-D2K23cwb.js";import"./SearchOutlined-DPpNmpde.js";import"./Overflow-wzPxOxK8.js";import"./DownOutlined-U_yyBD4s.js";import"./responsiveObserver-CoLEQsUO.js";import"./LeftOutlined-hwnj7f46.js";const L=async a=>await A.get(ae,{params:a}),je=async a=>await A.post(re,a),ye=async({uuid:a,body:c})=>A.put(`${ie}/${a}`,c),ve=async a=>await A.delete(`${oe}/${a}`),M=d.createContext({confirmDelete:async a=>{},selectedRowKeys:[],setSelectedRowKeys:a=>{},filterState:{},setFilterState:a=>{},selectAllChecked:!1,setSelectAllChecked:a=>{}}),Se={page:1,limit:12,search:""},_e={isOpenFilter:!1,dataFilter:Se};function Ce({children:a}){const{message:c}=U.useApp(),s=W(),[n,i]=d.useState([]),[S,x]=d.useState(_e),[y,f]=d.useState(!1),_=async h=>{Promise.all(h.map(async m=>{try{return await ve(m),!0}catch(b){const v=b.response.data;return v.title&&v.content.length>0?v.content.forEach(w=>{c.error(w)}):c.error(v.title),!1}})).then(m=>{m.every(b=>b===!0)&&(c.success("Delete Success."),i([]),f(!1),s.invalidateQueries(C.listTeamMember),s.invalidateQueries(C.userDetail))})},p={confirmDelete:async h=>{await me({html:"<div> Are you sure delete this.</div>"}).then(async v=>{v.isConfirmed&&_(h)})},selectedRowKeys:n,setSelectedRowKeys:i,filterState:S,setFilterState:x,selectAllChecked:y,setSelectAllChecked:f};return e.jsx(M.Provider,{value:p,children:a})}const Ne=[{id:"",color:"",name:"All"},{id:0,color:"#ffffff",name:"No status"},{id:-1,color:"",name:"Ban"},{id:-2,color:"",name:"Ready"},{id:-3,color:"",name:"New"}];function V({openModal:a,setOpenModal:c,data:s}){const n=G(),[i]=j.useForm(),S=W(),{message:x}=U.useApp(),{t:y}=F(),[f,_]=d.useState(!1),[N,p]=d.useState([]),[h,m]=d.useState([]),[b,v]=d.useState([]),[w,J]=d.useState([]),[X,$]=d.useState([]),[E,Y]=d.useState([]);d.useEffect(()=>{if(a&&(i.resetFields(),Z(),ee(),te(),s)){const t=s.email,o=s.permission_team.includes("create"),r=s.permission_team.includes("edit"),l=s.permission_team.includes("remove"),u=s.permission_team.includes("share");i.setFieldValue("email",t),i.setFieldValue("create",o),i.setFieldValue("edit",r),i.setFieldValue("remove",l),i.setFieldValue("share",u)}},[a]);const Z=async()=>{const t=await ue(!1);let o=[];if(s&&s.folder_team_id.length>0){o=t.filter(l=>!s.folder_team_id.some(u=>u==l.id)).map(l=>({value:l.id,label:l.name,title:""}));const r=t.filter(l=>s.folder_team_id.some(u=>u==l.id)).map(l=>({value:l.id,label:l.name,title:""}));i.setFieldValue("folder_team",r)}else o=t.map(r=>({value:r.id,label:r.name,title:""}));v(o),J(t)},ee=async()=>{const t=await pe();let o=[];if(s&&s.tag_profile_id.length>0){o=t.filter(l=>!s.tag_profile_id.some(u=>u==l.value)).map(l=>({value:l.value,label:l.label,title:""}));const r=t.filter(l=>s.tag_profile_id.some(u=>u==l.value)).map(l=>({value:l.value,label:l.label,title:""}));i.setFieldValue("tag_profile",r)}else o=t.map(r=>({value:r.value,label:r.label,title:""}));$(o),Y(t)},te=async()=>{const t=await xe(!1),o=[...Ne,...t];let r=[];if(s&&s.status_profile_id.length>0){r=o.filter(u=>!s.status_profile_id.some(P=>P==u.id)).map(u=>({value:u.id,label:u.name,title:""}));const l=o.filter(u=>s.status_profile_id.some(P=>P==u.id)).map(u=>({value:u.id,label:u.name,title:""}));i.setFieldValue("status_profile",l)}else r=o.map(l=>({value:l.id,label:l.name,title:""}));p(r),m(o)},le=t=>{const o=[];for(const l in t)t[l]===!0&&o.push(l);const r={email:t.email,folder_team_id:t.folder_team?t.folder_team.map(l=>l.value):[],password:t.password,permission_team:o,status_profile_id:t.status_profile?t.status_profile.map(l=>l.value):[],tag_profile_id:t.tag_profile?t.tag_profile.map(l=>l.value):[]};se(r)},{isLoading:Q,mutate:se}=de({mutationFn:t=>{if(s){const{uuid:o}=s;return ye({uuid:o,body:t})}else return je(t)},onSuccess:()=>{S.invalidateQueries(C.listTeamMember),S.invalidateQueries(C.userDetail),x.success(s?"Updated successfully!":"Add successfully!"),c(!1)},onError:({response:t})=>{t.data.title&&t.data.content.length>0?t.data.content.forEach(o=>{x.error(o)}):x.error(t.data.title)}});return e.jsx(ne,{theme:{token:{colorPrimary:"#2263B3"}},children:e.jsx(fe,{forceRender:!0,open:a,confirmLoading:Q,onOk:i.submit,onCancel:()=>c(!1),title:e.jsx(g,{color:n.textActiveNormal,className:"!text-[20px]",label:(s?"Edit":"Add")+" member"}),footer:e.jsx("div",{className:"w-full flex justify-end gap-x-[5px]",children:e.jsx(B,{label:y("Submit"),type:"primary",solid:!0,isDisabled:Q,onClick:i.submit},"submit")}),children:e.jsxs(j,{layout:"vertical",form:i,onFinish:le,children:[e.jsx(T,{label:"Email",required:!0}),e.jsx(j.Item,{name:"email",label:"",rules:[{required:!0,message:"This field is required."}],children:e.jsx(z,{placeholder:"Enter email",disabled:!!s})}),e.jsx(T,{label:"Password",required:!s}),e.jsx(j.Item,{name:"password",rules:[{required:!s,message:"This field is required."},{min:6,message:`${y("Password must be minimum 6 characters")}`}],children:e.jsx(z.Password,{placeholder:"Enter password"})}),e.jsx(T,{label:"Folder",required:f??!1}),e.jsx(j.Item,{name:"folder_team",label:"",rules:[{required:f??!1,message:"This field is required."}],children:e.jsx(D,{mode:"multiple",tagRender:t=>e.jsx(q,{closeIcon:e.jsx(k,{style:{color:n.iconClose},className:"inline-flex align-[-0.125em]"}),closable:t.closable,onClose:t.onClose,style:{cursor:"default",padding:"0px 3px",fontWeight:"500",fontSize:14,margin:"2px",background:n.tagBgPrimary,color:n.tagTextPrimary},children:R(t.label,50)}),allowClear:!0,labelInValue:!0,style:{width:"100%"},placeholder:"Select...",options:b,optionFilterProp:"label",onChange:t=>{const o=w==null?void 0:w.filter(r=>!t.some(l=>l.value==r.id)).map(r=>({value:r.id,label:r.name,title:""}));v(o)}})}),e.jsx(T,{label:"Tag"}),e.jsx(j.Item,{name:"tag_profile",label:"",children:e.jsx(D,{mode:"multiple",tagRender:t=>e.jsx(q,{closeIcon:e.jsx(k,{style:{color:n.iconClose},className:"inline-flex align-[-0.125em]"}),closable:t.closable,onClose:t.onClose,style:{cursor:"default",padding:"0px 3px",fontWeight:"500",fontSize:14,margin:"2px",background:n.tagBgPrimary,color:n.tagTextPrimary},children:R(t.label,50)}),allowClear:!0,labelInValue:!0,style:{width:"100%"},placeholder:"Select...",options:X,optionFilterProp:"label",onChange:t=>{const o=E==null?void 0:E.filter(r=>!t.some(l=>l.value===r.value)).map(r=>({value:r.value,label:r.label,title:""}));$(o)}})}),e.jsx(T,{label:"Status"}),e.jsx(j.Item,{name:"status_profile",label:"",children:e.jsx(D,{mode:"multiple",tagRender:t=>e.jsx(q,{closeIcon:e.jsx(k,{style:{color:n.iconClose},className:"inline-flex align-[-0.125em]"}),closable:t.closable,onClose:t.onClose,style:{cursor:"default",padding:"0px 3px",fontWeight:"500",fontSize:14,margin:"2px",background:n.tagBgPrimary,color:n.tagTextPrimary},children:R(t.label,50)}),allowClear:!0,labelInValue:!0,style:{width:"100%"},placeholder:"Select...",options:N,optionFilterProp:"label",onChange:t=>{const o=h==null?void 0:h.filter(r=>!t.some(l=>l.value===r.id)).map(r=>({value:r.id,label:r.name,title:""}));p(o)}})}),e.jsxs(he,{children:[e.jsxs(H,{span:12,children:[e.jsxs("div",{className:"flex gap-x-[5px]",children:[e.jsx(j.Item,{name:"create",valuePropName:"checked",children:e.jsx(I,{onChange:t=>_(t)})}),e.jsx(g,{className:"mt-[4px]",label:"Create"})]}),e.jsxs("div",{className:"flex gap-x-[5px]",children:[e.jsx(j.Item,{name:"edit",label:"",valuePropName:"checked",children:e.jsx(I,{})}),e.jsx(g,{className:"mt-[4px]",label:"Edit"})]})]}),e.jsx(H,{span:12,children:e.jsxs("div",{className:"flex gap-x-[5px]",children:[e.jsx(j.Item,{name:"remove",label:"",valuePropName:"checked",children:e.jsx(I,{})}),e.jsx(g,{className:"mt-[4px]",label:"Remove"})]})})]})]})})})}const T=({label:a,required:c})=>{const[s]=F();return e.jsxs("div",{className:"flex items-center flex-row gap-x-[3px]",children:[e.jsx(g,{className:"!textx-[14px] font-semibold",label:s(a)}),c&&e.jsx("span",{className:"text-red-700",children:"*"})]})};function we(){const[a,c]=d.useState(!1),{selectedRowKeys:s,filterState:n,setSelectedRowKeys:i,selectAllChecked:S,setSelectAllChecked:x,confirmDelete:y}=d.useContext(M),{t:f}=F(),[_,N]=d.useState(!0),{currentCharge:p}=ce(m=>m.chargeSlice);console.log({currentCharge:p}),d.useEffect(()=>{var m;p&&((m=p==null?void 0:p.charge)==null?void 0:m.team_member)>0&&N(!1)},[p]);const{data:h}=K({queryFn:()=>L(n.dataFilter),queryKey:[C.listTeamMember,n.dataFilter]});return s.length>0&&s.length<((h==null?void 0:h.data.data.content.length)||0),e.jsxs("div",{className:"flex flex-col gap-y-[10px] mb-[10px]",children:[e.jsx("div",{className:"w-full flex flex-row gap-x-[10px] mt-[10px]",children:e.jsx(B,{type:"primary",disabled:_,icon:e.jsx(ge.IconCirclePlusFigma,{}),label:f("Add member"),buttonMenu:!0,onClick:()=>c(!0)})}),e.jsx(V,{openModal:a,setOpenModal:c})]})}function Te(){const{filterState:a,setFilterState:c}=d.useContext(M),s=(...S)=>{const[x,y]=S;c(f=>({...f,dataFilter:{...f.dataFilter,page:x,limit:y}}))},{t:n}=F(),{data:i}=K({queryFn:()=>L(a.dataFilter),queryKey:[C.listTeamMember,a.dataFilter]});return e.jsxs("div",{className:"w-full h-[64px] flex gap-x-[10px] items-center justify-end px-4",children:[e.jsx("div",{className:"",children:e.jsx("span",{className:"!text-[16px]",children:`${((i==null?void 0:i.data.meta.total)||0)>1?n("Team members"):n("Team member")} : ${(i==null?void 0:i.data.meta.total)||0}`})}),e.jsx(be,{pageSize:a.dataFilter.limit,current:a.dataFilter.page,pageSizeOptions:[12,24,48,100],total:(i==null?void 0:i.data.meta.total)||0,showQuickJumper:!0,onChange:s,showSizeChanger:!0,locale:{page:n("Page"),items_per_page:n("page"),jump_to:n("Go to")}})]})}function Fe({data:a}){const c=a.permission_team.map((s,n)=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ");return e.jsx("div",{className:`${c===""?"py-[10px]":"py-0"}`,children:c})}function Ae(){const a=G(),{filterState:c,confirmDelete:s,selectedRowKeys:n,setSelectedRowKeys:i,setSelectAllChecked:S}=d.useContext(M),{t:x}=F(),[y,f]=d.useState(!1),[_,N]=d.useState(),{data:p}=K({queryFn:()=>L(c.dataFilter),queryKey:[C.listTeamMember,c.dataFilter]}),h=(m,b)=>{f(m),N(b)};return e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 pr-[10px] pl-[3px]",children:(p==null?void 0:p.data.data.content)&&p.data.data.content.map((m,b)=>e.jsxs("div",{style:{backgroundColor:a.backgroundDark},className:"rounded-[5px] p-[10px] shadow",children:[e.jsx("div",{className:"pt-[5px] flex flex-row items-center",children:e.jsx("div",{className:"flex justify-start w-full",children:e.jsx(g,{color:a.textActiveNormal,className:"!text-[18px] font-semibold",label:m.name})})}),e.jsx(O,{className:"my-[10px]"}),e.jsxs("div",{className:"flex flex-col gap-y-[5px]",children:[e.jsx(g,{color:a.textActiveNormal,className:"!text-[16px] font-semibold leading-[16.94px]",label:`${x("Email")} :`}),e.jsx(g,{className:"!text-[14px]",label:m.email})]}),e.jsxs("div",{className:"flex flex-col gap-y-[5px] mt-[10px]",children:[e.jsx(g,{color:a.textActiveNormal,className:"!text-[16px] font-semibold leading-[16.94px]",label:`${x("Permission")} :`}),e.jsx(Fe,{data:m})]}),e.jsx(O,{className:"my-[10px]"}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start",children:[e.jsx(g,{className:"!text-[16px] font-semibold leading-[16.94px]",label:`${x("Created at")} :`}),e.jsx(g,{className:"!text-[14px]",label:m.created_at?new Date(m.created_at).toLocaleString():""})]}),e.jsx("div",{className:"flex justify-end gap-x-[5px]",children:e.jsx(B,{onClick:()=>h(!0,m),type:"primary",label:x("Edit")})})]})]},b))}),e.jsx(V,{openModal:y,setOpenModal:f,data:_})]})}function ht(){return e.jsx(e.Fragment,{children:e.jsx(Ce,{children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-65px)]",children:[e.jsx(we,{}),e.jsx("div",{className:"overflow-auto py-[10px] h-[calc(100vh-192px)]",children:e.jsx(Ae,{})}),e.jsx(Te,{})]})})})}export{ht as default};
