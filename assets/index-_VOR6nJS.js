import{r as c,j as z,q as O,k as e,fL as H,a7 as Ae,P as de,b$ as re,ab as ve,n as we,l as Se,p as _e,G as De,a1 as Be,s as $e}from"./index-CJvg638n.js";import{F as Ne,H as ze}from"./HeaderContext-CcFwS_UE.js";import{u as D}from"./useQuery-DJ-tefVM.js";import{u as Oe,d as He,b as ue,i as Ke,j as Re,s as me,g as We,k as Ve,m as Ge,n as Qe,o as Ye,p as Je}from"./automationService-CEnPLggJ.js";import{Q as $}from"./queryKey.const-4yptRpGc.js";import{u as ie}from"./useMutation-DtMNI5dJ.js";import{B as N}from"./index-BAIjI0rE.js";import{D as fe}from"./DeleteConfirmModal-CCC5Ho8A.js";import{u as T}from"./useTranslation-DN-CYzVf.js";import{T as F}from"./index-w6IqrXlL.js";import{T as I}from"./index-BXlHKc3j.js";import{f as he}from"./index-BlXw00gF.js";import{T as ee}from"./Table-Bf5fO8hA.js";import{F as w}from"./index-YCIRg4HO.js";import{I as X}from"./index-4M1x7pR3.js";import{E as ge,S as ne}from"./index-Wc0f9ZXJ.js";import{d as se}from"./index.esm-BKVPp4gk.js";import{u as G}from"./theme-D5S-1fEx.js";import{f as Ze,g as ye,h as Ee,i as Xe}from"./index.esm-mlJjdzQr.js";import{C as Ue}from"./index.esm-B_Vby5oa.js";import{B as et}from"./BrowserIcon-Dgxd1A6f.js";import{T as oe}from"./index-BtoCM6cC.js";import{f as tt}from"./index-D-UHeDW2.js";import{T as Ce}from"./index-DGGwne6Z.js";import{P as U}from"./Pagination-BX02S7D7.js";import{M as te}from"./index-Cn7Yo5Hv.js";import{D as xe}from"./index-j3wcEPKq.js";import{I as at}from"./Icon-BaWGP5av.js";import{f as st}from"./folderService-DM9UnFow.js";import{c as lt}from"./compareVersion-JynyrHBx.js";import{I as K}from"./index-d2P14GTx.js";import{S as J}from"./index-Bsl0EBBv.js";import{S as Fe}from"./index-CWlqhW57.js";import{D as ce,d as Z}from"./index-BFNDRBPM.js";import{R as V}from"./index-DRCSt6Z6.js";import{g as rt}from"./PurePanel-BiIzqeBG.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./row-C7cWNtLw.js";import"./responsiveObserver-BQm3ddGk.js";import"./utils-Dji2qSVF.js";import"./index-TvTBJWU5.js";import"./index-D8gngLx0.js";import"./index-DC1DAWbZ.js";import"./TextArea-DBRPcsh0.js";import"./CheckOutlined-CxiWyKpb.js";import"./index-C2OfIzMU.js";import"./addEventListener-0hYE1V1V.js";import"./DownOutlined-BgG6dx4I.js";import"./index-DwCW4jpE.js";import"./index-Db4idn_r.js";import"./LeftOutlined-_e4uGCQm.js";import"./Dropdown-DXC0sGt_.js";import"./extendsObject-EOfQw3bh.js";import"./EllipsisOutlined-DODEOrOr.js";import"./Overflow-eyj8oHJy.js";import"./collapse-C1MjllT7.js";import"./SearchOutlined-Bmw6m_pM.js";import"./EyeOutlined-B-Yk7nA6.js";import"./index-DYrGpNsa.js";import"./PlusOutlined-B9MlVXp_.js";import"./gapSize-U1swVQyS.js";var it=function(t,a){var l={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&a.indexOf(s)<0&&(l[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,s=Object.getOwnPropertySymbols(t);u<s.length;u++)a.indexOf(s[u])<0&&Object.prototype.propertyIsEnumerable.call(t,s[u])&&(l[s[u]]=t[s[u]]);return l};const{TimePicker:nt,RangePicker:ot}=ce,ct=c.forwardRef((t,a)=>c.createElement(ot,Object.assign({},t,{picker:"time",mode:void 0,ref:a}))),Q=c.forwardRef((t,a)=>{var{addon:l,renderExtraFooter:s}=t,u=it(t,["addon","renderExtraFooter"]);const f=c.useMemo(()=>{if(s)return s;if(l)return l},[l,s]);return c.createElement(nt,Object.assign({},u,{mode:void 0,ref:a,renderExtraFooter:f}))}),Pe=rt(Q,"picker");Q._InternalPanelDoNotUseOrYouWillBeFired=Pe;Q.RangePicker=ct;Q._InternalPanelDoNotUseOrYouWillBeFired=Pe;const le=Q;var ke=(t=>(t[t.ONCE=1]="ONCE",t[t.INTERVAL=2]="INTERVAL",t[t.DAILY=3]="DAILY",t[t.WEEKLY=4]="WEEKLY",t[t.MONTHLY=5]="MONTHLY",t))(ke||{}),q=(t=>(t[t.PENDING=1]="PENDING",t[t.RUNNING=2]="RUNNING",t[t.COMPLETE=3]="COMPLETE",t[t.STOP=4]="STOP",t))(q||{}),Ie=(t=>(t[t.COMMON=1]="COMMON",t[t.SCHEDULE=2]="SCHEDULE",t))(Ie||{});function dt({record:t}){const a=z(),{message:l,modal:s}=O.useApp(),{t:u}=T(),{mutate:f}=ie({mutationFn:o=>Oe(t.id,o),onSuccess:()=>{a.invalidateQueries($.schedule),t.status===q.PENDING?l.success("Schedule start success!"):t.status===q.RUNNING&&l.success("Schedule stop success!")},onError:()=>{t.status===q.PENDING?l.error("Schedule start error!"):t.status===q.RUNNING&&l.error("Schedule stop error!")}}),{mutate:d}=ie({mutationFn:()=>He([t.id]),onSuccess:()=>{a.invalidateQueries($.schedule),l.success("Schedule deleted success!")},onError:()=>{l.error("Schedule delete error!")}}),x=()=>{fe({html:'<div>You want to <b style="color:red">delete</b> this schedule</div>'}).then(async p=>{p.isConfirmed&&d()})},j=()=>{fe({html:"<div>You want to <b>stop</b> this schedule</div>"}).then(async p=>{p.isConfirmed&&f("STOP")})};return e.jsx(e.Fragment,{children:t.status===q.COMPLETE||t.status===q.STOP?e.jsx(N,{label:u("Delete"),classStyle:"w-fit m-auto",typebutton:"error",solid:1,onClick:o=>{o.stopPropagation(),x()}}):t.status===q.PENDING?e.jsx(N,{label:u("Start"),classStyle:"w-fit m-auto",onClick:o=>{o.stopPropagation(),f("RUNNING")}}):t.status===q.RUNNING?e.jsx(N,{label:u("Stop"),classStyle:"w-fit m-auto",typebutton:"warning",solid:1,onClick:o=>{o.stopPropagation(),j()}}):null})}const ut=({record:t})=>{const a=H();return e.jsx(Ae,{to:`${de.work_log}?campaign=${a.campaign_id}&schedule=${t.id}`,children:e.jsx(F,{className:"!text-[14px]",label:t.name})})},mt=({idx:t})=>{const a=c.useContext(pe),l=(a==null?void 0:a.filterSchedule.page)-1;return e.jsx(e.Fragment,{children:l*(a==null?void 0:a.filterSchedule.limit)+t+1})},je=({text:t})=>{const{t:a}=T();return e.jsx("span",{children:a(t)})},xt=[{title:e.jsx(I,{title:"No.STT"}),width:"5%",render:(t,a,l)=>e.jsx(mt,{idx:l})},{title:e.jsx(I,{title:"Name"}),dataIndex:"name",render:(t,a)=>e.jsx(ut,{record:a})},{title:e.jsx(I,{title:"Execution frequency"}),dataIndex:"execution_frequency",render:(t,a)=>e.jsx(je,{text:ke[t]||Ie[a.task_type]})},{title:e.jsx(I,{title:"Execution time"}),align:"center",dataIndex:"execute_time"},{title:e.jsx(I,{title:"Start time"}),dataIndex:"start_time",render:t=>t?he(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(I,{title:"End time"}),dataIndex:"end_time",render:t=>t?he(new Date(t),"dd/MM/yyyy HH:mm:ss"):""},{title:e.jsx(I,{title:"Total profile pending"}),align:"center",dataIndex:"total_profile_pending"},{title:e.jsx(I,{title:"Total profile running"}),align:"center",dataIndex:"total_profile_running"},{title:e.jsx(I,{title:"Total profile success"}),align:"center",dataIndex:"total_profile_success"},{title:e.jsx(I,{title:"Total profile error"}),align:"center",dataIndex:"total_profile_error"},{title:e.jsx(I,{title:"Status"}),dataIndex:"status",render:t=>e.jsx(je,{text:q[t]})},{title:e.jsx(I,{title:"Action"}),align:"center",render:(t,a)=>e.jsx(dt,{record:a})}];function pt(){const t=c.useContext(pe),{campaign_id:a}=H(),{data:l}=D({queryKey:[$.schedule,a,t==null?void 0:t.filterSchedule],queryFn:()=>ue({campaign_id:a,...t==null?void 0:t.filterSchedule}),refetchOnMount:!0,refetchOnWindowFocus:!0});return e.jsx(ee,{dataSource:(l==null?void 0:l.schedules)||[],columns:xt,rowKey:"id",pagination:!1})}const pe=c.createContext(void 0);function ft({filterSchedule:t,setFilterSchedule:a}){const l={filterSchedule:t,setFilterSchedule:a};return e.jsx(pe.Provider,{value:l,children:e.jsx("div",{className:"my-4",children:e.jsx(pt,{})})})}const ht=({campaign:t,arrayField:a,setArrayField:l})=>{c.useEffect(()=>{if(t){const u=JSON.parse(t.variable);l(u)}},[t]);const s=(u,f)=>{const d=[...a];d[f].data=u,l(d)};return e.jsx("div",{className:"w-full h-full",children:e.jsx(w,{children:e.jsx("div",{className:"w-[100%] md:w-[50%] h-full flex flex-col gap-y-[20px]",children:a&&a.length>0?a.map((u,f)=>e.jsx("div",{className:"flex flex-row gap-x-[20px]",children:e.jsxs("div",{className:"flex flex-row gap-x-[20px] items-center",children:[e.jsx(X,{disabled:!0,value:u.label,placeholder:"Please Input"}),"=",e.jsx(X,{placeholder:"Name",value:u.data,onChange:d=>s(d.target.value,f)})]})},f)):e.jsx("div",{className:"",children:e.jsx(ge,{image:ge.PRESENTED_IMAGE_SIMPLE})})})})})},gt=({data:t})=>{const a=H(),{message:l}=O.useApp(),s=z(),{t:u}=T(),f=async()=>{const d={campaign_id:a.campaign_id,profile_uuid:t.uuid},x=await Ke(d);x.data.type==="success"?(s.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),s.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0}),l.success(x.data.title)):x.data.type==="error"&&l.error(x.data.title)};return e.jsx("div",{className:"w-full h-full flex flex-row gap-x-[5px] justify-center items-center cursor-pointer",children:e.jsx(N,{label:u("Remove"),typebutton:"error",solid:!0,onClick:f})})},yt=()=>{const t=G();return e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:t.textActiveNormal},children:"Uuid || "}),"  ",e.jsx(I,{title:"Name"})]})},jt=[{title:e.jsx(yt,{}),dataIndex:"name",className:"text-[16px]",sorter:!0,showSorterTooltip:!1,width:250,render:(t,a)=>a.name||a.uuid},{title:e.jsx(I,{title:"Action"}),className:"text-[14px]",width:120,align:"center",render:(t,a)=>e.jsx(gt,{data:a})}],bt=()=>{const t=c.useContext(Y),a=H(),[l,s]=c.useState({orderByNo:0,orderByName:0,orderByCreatedAt:0}),u=o=>{t==null||t.setSelectedRowKeysIndex(o)},f={selectedRowKeys:t==null?void 0:t.selectedRowKeysIndex,onChange:u},{data:d}=D({queryFn:()=>Re({campaign_id:a.campaign_id||""}),queryKey:["List_Profile_By_Campaign_Id",a.campaign_id],onSuccess:({data:o})=>{t==null||t.setDataSelectedKey(o.data),typeof(o==null?void 0:o.data[0])=="object"&&(t==null||t.setRows(o.data))}}),{data:x}=D({queryFn:()=>{var p,y,m,i,h;const o=((p=d==null?void 0:d.data)==null?void 0:p.data[0])||{},r=((m=(y=d==null?void 0:d.data)==null?void 0:y.data)==null?void 0:m.length)||0;if(typeof o!="object")return o!=null&&o.includes("local-")?re({browser_uuid:(i=d==null?void 0:d.data)==null?void 0:i.data,limit:r},"local"):re({browser_uuid:(h=d==null?void 0:d.data)==null?void 0:h.data,limit:r},"cloud")},queryKey:["List_Profile_Campaign",d],onSuccess:o=>{const{data:r}=o||{};r!=null&&r.data.content&&(t==null||t.setRows(r==null?void 0:r.data.content))}});c.useEffect(()=>{var C,g;const o=typeof((C=d==null?void 0:d.data)==null?void 0:C.data[0])=="object"?(g=d==null?void 0:d.data)==null?void 0:g.data:x==null?void 0:x.data.data.content,{page:r=1,limit:p=10}=t==null?void 0:t.filterProfile,{orderByName:y}=l;let m=o||[];(y===1||y===2)&&(m=ve.orderBy(o,["name"],[y===1?"asc":"desc"]));const i=(r-1)*p,h=i+p,S=m.slice(i,h);t==null||t.setRows(S)},[d,x,t==null?void 0:t.filterProfile,l]);const j=(o,r,p,y)=>{const{field:m,order:i}=p;switch(m){case"name":s(i==="ascend"?h=>({...h,orderByCreatedAt:0,orderByName:1}):i==="descend"?h=>({...h,orderByCreatedAt:0,orderByName:2}):h=>({...h,orderByCreatedAt:0,orderByName:0}));break;case"created_at_diff":s(i==="ascend"?h=>({...h,orderByName:0,orderByCreatedAt:1}):i==="descend"?h=>({...h,orderByName:0,orderByCreatedAt:2}):h=>({...h,orderByName:0,orderByCreatedAt:0}));break}};return e.jsx("div",{className:"",children:e.jsx(ee,{dataSource:t==null?void 0:t.rows,rowSelection:f,columns:jt,rowKey:"uuid",size:"small",onChange:j,pagination:!1})})};function vt({data:t}){const{theme:a}=we(s=>s.display),l=c.useRef(null);return e.jsx(Se,{theme:{token:{colorBgSpotlight:`${a==="light"?"#FFFFFF":"#39383F"}`,colorTextLightSolid:`${a==="light"?"#000000":"#FFFFFF"}`}},children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx("div",{className:"w-fit",children:e.jsx("div",{className:"text-[14px] flex items-center cursor-texts",children:e.jsx(oe,{placement:"right",title:t.name,children:e.jsx("span",{ref:l,className:"w-[145px] ml-[2px] text-ellipsis-1-line text-start border rounded-[3px] border-solid border-transparent transtion duration-150",children:t.name})})})}),e.jsx("div",{className:"flex flex row items-center",children:e.jsxs("div",{className:"flex flex-col flex-nowrap justify-center items-center",children:[(t==null?void 0:t.os)&&((t==null?void 0:t.os)==="win"?e.jsx(Ze,{className:"text-[#0078D4]"}):t.os==="mac"?e.jsx(ye,{className:"text-[#A6B1B7]"}):t.os==="lin"?e.jsx(Ee,{}):t.os==="android"?e.jsx(Xe,{className:"text-[#AAC148]"}):t.os==="ios"?e.jsx(ye,{className:"text-[#A6B1B7]"}):e.jsx(Ue,{className:"text-[#A6B1B7]"})),e.jsx(oe,{placement:"bottom",title:t.source_version,children:e.jsxs("div",{className:"flex gap-x-[5px] flex-nowrap items-center justify-center",children:[e.jsx("span",{className:"mb-[5px]",children:e.jsx(et,{browserType:t.browser,width:16,height:16})}),e.jsxs("span",{className:"text-[14px]",children:["/ ",t.version]})]})})]})})]})})}const wt=[{title:e.jsx(I,{title:"Name"}),dataIndex:"name",className:"text-[14px]",sorter:!0,showSorterTooltip:!1,render:(t,a)=>e.jsx(vt,{data:a})},{title:e.jsx(I,{title:"Created at"}),align:"center",sorter:!0,showSorterTooltip:!1,dataIndex:"created_at_diff",className:"text-[14px]",width:200,render:(t,a)=>e.jsx("span",{children:a.created_at_diff?a.created_at_diff:tt(new Date(a.created_at),new Date,{addSuffix:!0}).replace("about","")})}],St=[{title:"Profile",key:"profile"},{title:"Profile local",key:"profile_local"}],_t=({setListProfileSelected:t,selectedRowKeys:a,setSelectedRowKeys:l,tabActive:s,setActive:u})=>{const[f,d]=c.useState([]),[x,j]=c.useState("cloud"),[o,r]=c.useState({dataFilter:{page:1,limit:10,search:"",name:[],browser_uuid:[],orderName:0,orderLastOpen:0}}),[p,y]=c.useState(""),{t:m}=T(),i=()=>{const b=St.map(_=>({key:_.key,label:m(_.title)}));d(b)};c.useEffect(()=>{i(),y("")},[s]);const h=b=>{l([]),u(b)},C={selectedRowKeys:a,onChange:b=>{l(b)}},g=(...b)=>{const[_,A]=b;r(M=>({...M,dataFilter:{...M.dataFilter,page:_,limit:A}}))};c.useEffect(()=>{switch(s){case"profile":j("cloud");break;case"profile_local":j("local");break;default:j("cloud");break}},[s]);const{data:n}=D({queryFn:()=>re(o.dataFilter,x),queryKey:["List_Profile_Campaign",o.dataFilter,x]});c.useEffect(()=>{const b=n==null?void 0:n.data.data.content.filter(_=>a.includes(_.uuid)).map(_=>({uuid:_.uuid,name:_.name}));t(b||[])},[a]);const v=(b,_,A,M)=>{const{field:ae,order:R}=A;switch(ae){case"name":r(R==="ascend"?P=>({...P,dataFilter:{...P.dataFilter,orderName:1}}):R==="descend"?P=>({...P,dataFilter:{...P.dataFilter,orderName:2}}):P=>({...P,dataFilter:{...P.dataFilter,orderName:0}}));break;case"created_at_diff":r(R==="ascend"?P=>({...P,dataFilter:{...P.dataFilter,orderLastOpen:1}}):R==="descend"?P=>({...P,dataFilter:{...P.dataFilter,orderLastOpen:2}}):P=>({...P,dataFilter:{...P.dataFilter,orderLastOpen:0}}));break}},k=b=>{b===""||b===null?r(_=>({..._,dataFilter:{..._.dataFilter,name:[],browser_uuid:[]}})):b.includes("-")?r(_=>({..._,dataFilter:{..._.dataFilter,name:[],browser_uuid:[b]}})):r(_=>({..._,dataFilter:{..._.dataFilter,name:[b],browser_uuid:[]}}))};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{defaultActiveKey:s,activeKey:s,items:f,onChange:h}),e.jsxs("div",{className:"pb-[24px] flex gap-x-[10px]",children:[e.jsx(Ne,{placeholder:"search by uuid/name",onClickSearch:b=>k(b),onChange:b=>y(b.target.value),value:p,onPressEnter:b=>{k(b.target.value)}}),e.jsx(N,{onClick:()=>k(p),typebutton:"primary",label:m("search"),solid:!0})]}),e.jsx("div",{className:"max-h-[400px] overflow-auto",children:e.jsx(ee,{rowSelection:C,columns:wt,dataSource:n==null?void 0:n.data.data.content,size:"small",pagination:!1,rowKey:"uuid",onChange:v})}),e.jsxs("div",{className:"w-full flex justify-end mt-[20px] items-center gap-x-[5px]",children:[e.jsx("div",{children:e.jsx("span",{children:`${n!=null&&n.data.meta.total?`${m("Profiles")}: ${(n==null?void 0:n.data.meta.total)||0}`:`${m("Profile")}: ${(n==null?void 0:n.data.meta.total)||0}`}`})}),e.jsx(U,{size:"small",showTitle:!1,showQuickJumper:!0,pageSize:o.dataFilter.limit,current:o.dataFilter.page,pageSizeOptions:[10,20,50,100,200],total:n==null?void 0:n.data.meta.total,onChange:g,showSizeChanger:!0,locale:{page:m("Page"),items_per_page:m("page"),jump_to:m("Go to")}})]})]})},Nt=({isOpen:t,setOpen:a})=>{const l=G(),[s,u]=c.useState([]),[f,d]=c.useState([]),[x,j]=c.useState("profile"),o=c.useContext(Y),{message:r}=O.useApp(),p=z(),{t:y}=T(),m=async()=>{s.length>0?i(f):r.error("Please select profile!")},i=async h=>{const S=o==null?void 0:o.campaign,C={campaign_id:S.id,listProfile:h,user_uuid:S.user_uuid,profile_uuid:h.map(g=>g.uuid)};await me(C).then(g=>{g.data.type==="success"?r.success(g.data.title):g.data.type==="error"&&r.error(g.data.title)}).catch(g=>{r.error(g)}),a(!1),p.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),p.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0})};return c.useEffect(()=>{t&&(p.invalidateQueries("List_Profile_Campaign",{refetchInactive:!0}),p.invalidateQueries("List_Profile_Campaign_Local",{refetchInactive:!0}),p.invalidateQueries("List_Folder_Campaign",{refetchInactive:!0}),u([]))},[t]),e.jsx(e.Fragment,{children:e.jsx(te,{centered:!0,style:{height:"674px",minHeight:"674px"},width:756,title:e.jsx(F,{size:"2xl",color:l.textActiveNormal,label:y("Quickly add profile")}),open:t,onCancel:()=>a(!t),maskClosable:!1,footer:e.jsxs("div",{children:[e.jsx(xe,{}),e.jsxs("div",{className:"w-full flex justify-end gap-x-[5px]",children:[e.jsx(N,{typebutton:"mono",solid:!0,onClick:()=>a(!t),label:y("Cancel")}),e.jsx(N,{typebutton:"primary",onClick:m,solid:!0,label:y("Add")})]})]},1),children:e.jsx(_t,{setListProfileSelected:d,selectedRowKeys:s,setSelectedRowKeys:u,tabActive:x,setActive:j})})})};function Ct({data:t}){const{theme:a}=we(s=>s.display),l=c.useRef(null);return e.jsx(Se,{theme:{token:{colorBgSpotlight:`${a==="light"?"#FFFFFF":"#39383F"}`,colorTextLightSolid:`${a==="light"?"#000000":"#FFFFFF"}`}},children:e.jsx("div",{className:"w-full flex items-center justify-between",children:e.jsx("div",{className:"w-fit",children:e.jsx("div",{className:"text-[14px] flex items-center cursor-texts",children:e.jsx(oe,{placement:"right",title:t.name,children:e.jsx("span",{ref:l,className:"w-[145px] ml-[2px] text-ellipsis-1-line text-start border rounded-[3px] border-solid border-transparent transtion duration-150",children:t.name})})})})})})}const Ft=[{title:e.jsx(I,{title:"Folder name"}),dataIndex:"name",className:"text-[14px]",render:(t,a)=>e.jsx(Ct,{data:a})}],Pt=[{title:"Folder",key:"folder"},{title:"Folder local",key:"folder_local"}],kt=({selectedRowKeys:t,setSelectedRowKeys:a,tabActive:l,setActive:s})=>{const[u,f]=c.useState([]),[d,x]=c.useState("cloud"),[j,o]=c.useState({dataFilter:{page:1,limit:10,search:""}}),{t:r}=T(),[p,y]=c.useState(""),m=()=>{const v=Pt.map(k=>({key:k.key,label:r(k.title)}));f(v)};c.useEffect(()=>{m(),y("")},[l]);const i=v=>{a([]),s(v)},S={selectedRowKeys:t,onChange:v=>{a(v)}},C=(...v)=>{const[k,b]=v;o(_=>({..._,dataFilter:{..._.dataFilter,page:k,limit:b}}))};c.useEffect(()=>{switch(l){case"folder":x("cloud");break;case"folder_local":x("local");break;default:x("cloud");break}},[l]);const{data:g}=D({queryFn:()=>st(j.dataFilter,d),queryKey:["List_Folder_Campaign",j.dataFilter,d]}),n=v=>{o(k=>({...k,dataFilter:{...k.dataFilter,search:v}}))};return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{defaultActiveKey:l,activeKey:l,items:u,onChange:i}),e.jsxs("div",{className:"pb-[24px] flex gap-x-[10px]",children:[e.jsx(Ne,{placeholder:"search by folder name",onClickSearch:v=>n(v),onChange:v=>y(v.target.value),value:p,onPressEnter:v=>{n(v.target.value)}}),e.jsx(N,{onClick:()=>n(p),typebutton:"primary",label:r("search"),solid:!0})]}),e.jsx("div",{className:"max-h-[400px] overflow-auto",children:e.jsx(ee,{rowSelection:S,columns:Ft,dataSource:g==null?void 0:g.data.data.content,size:"small",pagination:!1,rowKey:"id"})}),e.jsxs("div",{className:"w-full flex justify-end mt-[20px] items-center gap-x-[5px]",children:[e.jsx("div",{children:e.jsx("span",{children:`${g!=null&&g.data.meta.total?`${r("Folders")}: ${g==null?void 0:g.data.meta.total}`:`${r("Folder")}: ${g==null?void 0:g.data.meta.total}`}`})}),e.jsx(U,{size:"small",showTitle:!1,showQuickJumper:!0,pageSize:j.dataFilter.limit,current:j.dataFilter.page,pageSizeOptions:[10,20,50,100,200],total:g==null?void 0:g.data.meta.total,onChange:C,showSizeChanger:!0,locale:{items_per_page:r("page"),jump_to:r("Go to"),page:r("Page")}})]})]})},It=({isOpen:t,setOpen:a})=>{const l=G(),[s,u]=c.useState([]),[f,d]=c.useState("folder"),x=c.useContext(Y),{message:j}=O.useApp(),o=z(),{t:r}=T(),p=async()=>{if(s.length>0){let m=!1;f==="folder_local"&&(m=!0),Promise.all(s.map(async i=>(await We(i,m)).data.content)).then(i=>{const h=i.flat();y(h)}).catch(i=>{console.error("Error:",i)})}else j.error("Please select profile!")},y=async m=>{const i=x==null?void 0:x.campaign,h={campaign_id:i.id,listProfile:m,profile_uuid:m.map(S=>typeof S=="string"?S:S.uuid),user_uuid:i.user_uuid};await me(h).then(S=>{S.data.type==="success"?j.success(S.data.title):S.data.type==="error"&&j.error(S.data.title)}).catch(S=>{j.error(S.message||"Insert profile failed!")}),a(!1),o.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),o.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0})};return c.useEffect(()=>{t&&(o.invalidateQueries("List_Profile_Campaign",{refetchInactive:!0}),o.invalidateQueries("List_Profile_Campaign_Local",{refetchInactive:!0}),o.invalidateQueries("List_Folder_Campaign",{refetchInactive:!0}),u([]))},[t]),e.jsx(e.Fragment,{children:e.jsx(te,{centered:!0,style:{height:"674px",minHeight:"674px"},width:756,title:e.jsx(F,{size:"2xl",color:l.textActiveNormal,label:r("Quickly add folder")}),open:t,onCancel:()=>a(!t),maskClosable:!1,footer:e.jsxs("div",{children:[e.jsx(xe,{}),e.jsxs("div",{className:"w-full flex justify-end gap-x-[5px]",children:[e.jsx(N,{typebutton:"mono",solid:!0,onClick:()=>a(!t),label:r("Cancel")}),e.jsx(N,{typebutton:"primary",onClick:p,solid:!0,label:r("Add")})]})]},1),children:e.jsx(kt,{selectedRowKeys:s,setSelectedRowKeys:u,tabActive:f,setActive:d})})})},Tt=({isOpen:t,setOpen:a})=>{const l=G(),[s]=T(),[u]=w.useForm(),f=c.useContext(Y),{message:d}=O.useApp(),x=z(),j=async()=>{const o=await u.validateFields().catch(()=>null);if(!o)return;const r=f==null?void 0:f.campaign,p=await(o==null?void 0:o.listUuid.split(`
`).filter(m=>m.includes("-")).map(m=>({uuid:m.trim()})));if(ve.isEmpty(p)){d.error("not correct format.");return}const y={campaign_id:r.id,listProfile:p,profile_uuid:p.map(m=>m.uuid),user_uuid:r.user_uuid};try{const m=await me(y);m.data.type==="success"?(d.success(m.data.title),x.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),x.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0}),a(!1)):m.data.type==="error"&&d.error(m.data.title)}catch(m){d.error(m.message)}};return c.useEffect(()=>{t&&u.resetFields()},[t]),e.jsx(te,{centered:!0,style:{height:"674px",minHeight:"674px"},width:756,title:e.jsx(F,{size:"2xl",color:l.textActiveNormal,label:s("Add by uuid")}),open:t,onCancel:()=>a(!t),maskClosable:!0,footer:e.jsxs("div",{children:[e.jsx(xe,{}),e.jsxs("div",{className:"w-full flex justify-end gap-x-[5px]",children:[e.jsx(N,{typebutton:"mono",solid:!0,onClick:()=>a(!t),label:s("Cancel")}),e.jsx(N,{typebutton:"primary",onClick:j,solid:!0,label:s("Add")})]})]},1),children:e.jsxs(w,{form:u,layout:"vertical",onFinish:j,children:[e.jsx(Lt,{label:"Uuid",required:!0}),e.jsx(w.Item,{name:"listUuid",label:"",rules:[{required:!0,message:s("This field is required.")}],children:e.jsx(X.TextArea,{rows:6,placeholder:`00e297bc-20a0-482c-a67e-7014dd9b38f0
62603ad9-ff17-432c-b4e5-8b9278ed87c1
...`})})]})})},Lt=({label:t,required:a})=>{const[l]=T();return e.jsxs("div",{className:"flex items-center flex-row gap-x-[3px]",children:[e.jsx(F,{className:"!textx-[14px] font-semibold",label:l(t)}),a&&e.jsx("span",{className:"text-red-700",children:"*"})]})},Y=c.createContext(void 0),Mt=({campaign:t,filterProfile:a,setFilterProfile:l})=>{const[s,u]=c.useState(!1),[f,d]=c.useState(!1),[x,j]=c.useState(!1),[o,r]=c.useState([]),[p,y]=c.useState([]),{message:m}=O.useApp(),[i]=T(),h=_e(),[S,C]=c.useState([]),[g,n]=c.useState(0),v=z(),k=H(),b={dataSelectedKey:o,setDataSelectedKey:r,selectedRowKeysIndex:p,setSelectedRowKeysIndex:y,rows:S,setRows:C,campaign:t,totalProfile:g,setTotalProfile:n,filterProfile:a,setFilterProfile:l},_=async()=>{const A={campaign_id:k.campaign_id,profile_uuid:typeof p=="string"?[p]:p},M=await Ve(A);M.data.type==="success"?(v.invalidateQueries("List_Profile_By_Campaign_Id",{refetchInactive:!0}),v.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0}),y([]),m.success(M.data.title)):M.data.type==="error"&&m.error(M.data.title)};return e.jsx(Y.Provider,{value:b,children:e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-full flex",children:e.jsxs("div",{className:"flex justify-start gap-x-[10px]",children:[e.jsx(N,{onClick:()=>h(de.campaign),label:i("Back"),classStyle:"w-fit block",typebutton:"warning"}),e.jsx(N,{typebutton:"primary",icon:e.jsx(se,{}),label:i("Add profile"),onClick:()=>u(!0)}),e.jsx(N,{typebutton:"primary",icon:e.jsx(se,{}),label:i("Add folder"),onClick:()=>d(!0)}),e.jsx(N,{typebutton:"primary",icon:e.jsx(se,{}),label:i("Add by uuid"),onClick:()=>j(!0)}),p.length>0&&e.jsx(N,{typebutton:"error",classStyle:"items-center",icon:e.jsx("span",{children:e.jsx(at.IconDeleteFigma,{width:12,height:12})}),label:`${i("Remove")} ${p.length} ${p.length>1?i("profiles"):i("profile")}`,onClick:_})]})}),e.jsx("div",{className:"py-[20px]",children:e.jsx(bt,{})}),e.jsx(Nt,{isOpen:s,setOpen:u}),e.jsx(It,{isOpen:f,setOpen:d}),e.jsx(Tt,{isOpen:x,setOpen:j})]})})},qt=["auto"],At=({campaign:t,form:a})=>{const l=G(),[s,u]=c.useState(!1),[f,d]=c.useState(!1),[x,j]=c.useState(qt),[o,r]=c.useState(!1),[p,y]=c.useState(""),[m,i]=c.useState(""),{t:h}=T();w.useWatch("profilePerWorker",a),c.useEffect(()=>{if(t){const n=JSON.parse(t.settings);a.setFieldValue("automationProcess",n.profileThread),a.setFieldValue("delayOpen",n.delayOpen),a.setFieldValue("isScreenArrangement",n.isScreenArrangement),a.setFieldValue("arrangementLayoutCol",n.arrangementLayoutCol),a.setFieldValue("arrangementLayoutRow",n.arrangementLayoutRow),a.setFieldValue("screenScalePercent",n.screenScalePercent),a.setFieldValue("autoScaleScreen",n.autoScreenScale),a.setFieldValue("screenSize",n.screenSize),a.setFieldValue("isSetWindowSize",n.isSetWindowSize),a.setFieldValue("profilePerWorker",n.profilePerWorker||10),a.setFieldValue("writeLogs",n.writeLogs!==!1),u(n.autoScreenScale),d(n.isScreenArrangement),j(v=>v.includes(n.screenSize)?[...v]:[...v,n.screenSize])}},[t]);const S=()=>{i("")},C=()=>{p.includes("x")?(j(v=>[...v,p]),a.setFieldValue("screenSize",p),r(!1),i("")):i(`${h("Please enter the following format")} [${h("width")}]x[${h("height")}]. ${h("Ex")}: 1280x800.`)},g=n=>{x.some(k=>k.includes(n.toLowerCase()))?r(!1):(r(!0),y(n))};return e.jsx("div",{style:{backgroundColor:l.backgroundNormal},className:"h-full w-full",children:e.jsx("div",{className:"h-full pb-[26px] pl-2 pr-[30px]",children:e.jsx("div",{className:"mt-4 font-semibold text-[15px]",children:e.jsxs(w,{layout:"vertical",form:a,style:{width:"720px"},children:[e.jsxs("div",{children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Automation processing"}),e.jsx(w.Item,{name:"automationProcess",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,placeholder:"Number of Automation Processing",className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Delay open (Seconds)"}),e.jsx(w.Item,{name:"delayOpen",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:0,placeholder:"Number of Delay open",className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx(F,{className:"!font-semibold !text-[15px] !whitespace-nowrap mt-[8px]",label:"Screen arrangement"}),e.jsx(w.Item,{name:"isScreenArrangement",className:"text-[14px]",valuePropName:"checked",children:e.jsx(J,{onChange:n=>{d(n)}})}),e.jsx(F,{className:"!text-[15px] mt-[8px] text-nowrap",label:"Col"}),e.jsx(w.Item,{name:"arrangementLayoutCol",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,disabled:!f,className:"text-[14px] w-full",type:"number"})}),e.jsx(F,{className:"!text-[15px] mt-[8px]  text-nowrap",label:"Row"}),e.jsx(w.Item,{name:"arrangementLayoutRow",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,disabled:!f,className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx(F,{className:"!text-[15px] mt-[8px]",label:"Auto scale screen"}),e.jsx(w.Item,{name:"autoScaleScreen",valuePropName:"checked",children:e.jsx(J,{disabled:!f,onChange:n=>{u(n)}})}),e.jsxs("div",{style:{opacity:s?"0":"1",visibility:s?"hidden":"visible",willChange:"opacity, visibility"},className:"flex gap-x-5 transition-all",children:[e.jsx(F,{className:"!text-[15px] mt-[8px]",label:"%Scale"}),e.jsx(w.Item,{name:"screenScalePercent",className:"",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:1,max:100,disabled:!f,className:"text-[14px] w-full",type:"number"})})]})]}),e.jsxs("div",{className:"flex gap-x-5",children:[e.jsx(F,{className:"!text-[15px] mt-[8px]",label:h("Auto set window size")}),e.jsx(w.Item,{name:"isSetWindowSize",valuePropName:"checked",children:e.jsx(J,{})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row gap-x-[10px]",children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Screen size"}),m!=""&&e.jsx("span",{children:e.jsx(F,{className:"!text-[13.5px]",color:"red",label:"(* "+m+" )"})})]}),e.jsx("div",{className:"flex flex-row flex-nowrap gap-x-[10px] items-center",children:e.jsx(w.Item,{style:{width:"100%",fontSize:"14px"},name:"screenSize",rules:[{validator(n,v){return v==="auto"||v.includes("x")?Promise.resolve():Promise.reject(new Error(`${h("Please enter the following format")} [${h("width")}]x[${h("height")}] ${h("ex")}: 1280x800.`))}}],children:e.jsx(ne,{showSearch:!0,onSearch:g,onChange:S,className:"text-[14px]",placeholder:"[width]x[height] ex: 1280x800",onDropdownVisibleChange:n=>{n||i("")},dropdownRender:n=>e.jsxs(e.Fragment,{children:[!o&&n,o&&e.jsxs("div",{className:"cursor-pointer p-[8px] rounded-[5px]",onClick:C,children:[h("Create"),' "',p,'"']})]}),options:x.map(n=>({label:h(n),value:n}))})})}),lt(window.api.APP_VERSION,"4.0.16")>=0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("p",{className:"mb-0",children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Profile number per thread"}),e.jsxs("span",{className:"italic",children:["(",h("The app will initiate a new thread if more profiles are opened than this number"),")"]})]}),e.jsx(w.Item,{name:"profilePerWorker",className:"mb-2",children:e.jsx(K,{min:1,placeholder:"Number of profiles per worker thread",className:"text-[14px] w-full",type:"number"})})]}),e.jsxs("div",{children:[e.jsx(F,{className:"!font-semibold !text-[15px]",label:"Write logs"}),e.jsx(w.Item,{name:"writeLogs",valuePropName:"checked",children:e.jsx(J,{})})]})]})]})]})})})})},Dt=({tabActive:t,totalProfile:a,filterProfile:l,setFilterProfile:s,filterSchedule:u,setFilterSchedule:f})=>{const{campaign_id:d}=H(),[x]=T(),j=(...p)=>{const[y,m]=p;s(i=>({...i,page:y,limit:m}))},o=(...p)=>{const[y,m]=p;f(i=>({...i,page:y,limit:m}))},{data:r}=D({queryKey:[$.schedule,d,u],queryFn:()=>ue({campaign_id:d,...u}),refetchOnMount:!0,refetchOnWindowFocus:!0});return e.jsxs("div",{className:"flex w-full h-full",children:[t==="profile"&&e.jsxs("div",{className:"flex justify-end items-center w-full pr-[20px]",children:[e.jsx(F,{label:`${a>1?x("Total profiles"):x("Total profile")}: ${a}`}),a>0&&e.jsx(U,{size:"default",showTitle:!1,showQuickJumper:!0,pageSize:l.limit,current:l.page,pageSizeOptions:[10,20,50,100],total:a,onChange:j,showSizeChanger:!0,locale:{items_per_page:x("page"),jump_to:x("Go to"),page:x("Page")}})]}),t==="schedule"&&e.jsxs("div",{className:"flex justify-end items-center w-full pr-[20px]",children:[e.jsx(F,{label:`${(r==null?void 0:r.total)>1?x("Total schedules"):x("Total schedule")}: ${r==null?void 0:r.total}`}),(r==null?void 0:r.total)>0&&e.jsx(U,{size:"default",showTitle:!1,showQuickJumper:!0,pageSize:u.limit,current:u.page,pageSizeOptions:[10,20,50,100],total:r==null?void 0:r.total,onChange:o,showSizeChanger:!0,locale:{items_per_page:x("page"),jump_to:x("Go to"),page:x("Page")}})]})]})},Bt=({tabActive:t,onSaveData:a,setOpenCreate:l,arrayField:s})=>{const u=_e(),[f]=T();return e.jsx("div",{className:t!=="profile"?"mb-[15px]":"",children:e.jsxs(Fe,{className:"flex items-center",children:[e.jsx(N,{style:{display:`${t!=="profile"?"block":"none"}`},onClick:()=>u(de.campaign),label:f("Back"),classStyle:"w-fit block",typebutton:"warning"}),t==="input"&&s&&s.length>0&&e.jsx(N,{onClick:a,label:f("Save"),typebutton:"primary",solid:!0,classStyle:"w-fit"}),e.jsx(N,{style:{display:`${t==="settings"?"block":"none"}`},onClick:a,label:f("Save"),typebutton:"primary",solid:!0,classStyle:"w-fit"}),e.jsx(N,{style:{display:`${t==="schedule"?"block":"none"}`},label:f("Create schedule"),classStyle:"w-fit",typebutton:"primary",solid:!0,onClick:()=>l(!0)})]})})};var Te=(t=>(t[t.common=1]="common",t[t.schedule=2]="schedule",t))(Te||{}),L=(t=>(t[t.Once=1]="Once",t[t.Interval=2]="Interval",t[t.Daily=3]="Daily",t[t.Weekly=4]="Weekly",t[t.Monthly=5]="Monthly",t))(L||{});const Le=[{label:"Sunday",value:0},{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6}],Me=()=>{const t=[];for(let a=1;a<=31;a++)t.push({label:a,value:a});return t},be=t=>({name:`Run ${t.name}`,data:"",script:"",task_type:2,execution_frequency:1,time_interval:60,starting_time:Z(),execution_time:Z(),execution_day:Le[0].value,execution_date:Me()[0].value,start_end_time:[Z(),Z().add(24,"hours")]});function $t({open:t,setOpen:a,campaign:l}){const[s]=T(),[u]=w.useForm(),{message:f}=O.useApp(),d=H(),x=w.useWatch("execution_frequency",u),j=z(),o=G(),r=async(m=!1)=>{var h,S,C,g;const i=await u.validateFields().catch(()=>null);if(!i)a(!0);else{const n={name:i.name,campaign_id:Number(d.campaign_id),end_time:i.start_end_time&&((h=i.start_end_time[1])==null?void 0:h.format("YYYY-MM-DD HH:mm:ss")),execute_day:i.execution_frequency===L.Weekly?i.execution_day:i.execution_date,execution_frequency:i.execution_frequency,execute_time:(S=i.execution_time)==null?void 0:S.format("HH:mm"),start_time:i.start_end_time&&((C=i.start_end_time[0])==null?void 0:C.format("YYYY-MM-DD HH:mm:ss"))||((g=i.starting_time)==null?void 0:g.format("YYYY-MM-DD HH:mm:ss")),task_type:Te.schedule,interval_time:i.time_interval,isRunning:!!m};await Ge(n).then(()=>{a(!1),f.success("Schedule created"),j.invalidateQueries($.schedule,{refetchInactive:!0})}).catch(()=>{f.error("Create schedule failed")})}};c.useEffect(()=>{t&&u.setFieldsValue(be(l))},[t]);const{isLoading:p,mutate:y}=ie({mutationFn:m=>r(m)});return e.jsx(te,{open:t,onCancel:()=>a(!1),maskClosable:!1,title:e.jsx(F,{className:"!text-[22px] font-semibold",style:{color:o.titlePrimary},label:s("Schedule")}),confirmLoading:p,footer:e.jsxs(Fe,{children:[e.jsx(N,{typebutton:"warning",solid:0,label:s("Cancel"),onClick:()=>a(!1)}),e.jsx(N,{label:s("Create And Run"),typebutton:"primary",solid:!0,onClick:()=>y(!0)}),e.jsx(N,{label:s("Create"),typebutton:"primary",solid:!0,onClick:()=>y(!1)})]}),children:e.jsx("div",{style:{maxHeight:"60vh",overflowY:"scroll"},children:e.jsxs(w,{form:u,layout:"vertical",initialValues:()=>be(l),children:[e.jsx(B,{label:"Name",required:!0}),e.jsx(w.Item,{label:"",name:"name",rules:[{required:!0,message:"This field is required"}],children:e.jsx(X,{})}),e.jsx(B,{label:"Execution frequency"}),e.jsx(w.Item,{label:"",name:"execution_frequency",children:e.jsxs(V.Group,{children:[e.jsx(V,{value:L.Once,children:s("Once")}),e.jsx(V,{value:L.Interval,children:s("Interval")}),e.jsx(V,{value:L.Daily,children:s("Daily")}),e.jsx(V,{value:L.Weekly,children:s("Weekly")}),e.jsx(V,{value:L.Monthly,children:s("Monthly")})]})}),x===L.Interval?e.jsxs("div",{children:[e.jsx(B,{label:"Each time delay (minutes)"}),e.jsx(w.Item,{label:"",name:"time_interval",rules:[{required:!0,message:"This field is required"}],children:e.jsx(K,{min:0,className:"w-full"})})]}):x===L.Once?e.jsxs("div",{children:[e.jsx(B,{label:"Starting time",required:!0}),e.jsx(w.Item,{label:"",name:"starting_time",rules:[()=>({validator(m,i){return i===null?Promise.reject(new Error("This field is required")):Promise.resolve()}})],children:e.jsx(ce,{className:"w-full",format:"DD/MM/YYYY HH:mm",showTime:!0})})]}):x===L.Daily?e.jsxs("div",{children:[e.jsx(B,{label:"Execution time"}),e.jsx(w.Item,{label:"",name:"execution_time",children:e.jsx(le,{format:"HH:mm",className:"w-full"})})]}):x===L.Weekly?e.jsxs("div",{children:[e.jsx(B,{label:"Execution time"}),e.jsxs("div",{className:"flex",children:[e.jsx(w.Item,{label:"",name:"execution_day",className:"w-[200px]",children:e.jsx(ne,{options:Le})}),e.jsx(w.Item,{label:"",name:"execution_time",className:"w-full",children:e.jsx(le,{format:"HH:mm",className:"w-full"})})]})]}):x===L.Monthly?e.jsxs("div",{children:[e.jsx(B,{label:"Execution time"}),e.jsxs("div",{className:"flex w-full",children:[e.jsx(w.Item,{label:"",name:"execution_date",className:"w-[150px]",children:e.jsx(ne,{options:Me(),className:"w-full"})}),e.jsx(w.Item,{name:"execution_time",className:"w-full",children:e.jsx(le,{format:"HH:mm",className:"w-full"})})]})]}):null,x!==L.Once&&e.jsxs("div",{children:[e.jsx(B,{label:"Start - End time",required:!0}),e.jsx(w.Item,{label:"",name:"start_end_time",rules:[()=>({validator(m,i){return i===null?Promise.reject(new Error(s("This field is required"))):i&&i[1]>=i[0]?Promise.resolve():Promise.reject(new Error(s("The end date must be greater than the start date!")))}})],children:e.jsx(ce.RangePicker,{format:"DD/MM/YYYY HH:mm",showTime:!0,className:"w-full"})})]})]})})})}const B=({label:t,required:a})=>{const[l]=T();return e.jsxs("div",{className:"flex items-center flex-row gap-x-[3px]",children:[e.jsx(F,{className:"!textx-[14px] font-semibold",label:l(t)}),a&&e.jsx("span",{className:"text-red-700",children:"*"})]})},E=[{title:"Input",key:"input"},{title:"Profiles",key:"profile",total:0},{title:"Settings",key:"settings"},{title:"Schedule",key:"schedule",total:0}];function Ya(){const[t,a]=c.useState(E[0].key),[l,s]=c.useState(!1),[u]=w.useForm(),f=H(),{message:d}=O.useApp(),[x,j]=c.useState([]),[o,r]=c.useState({limit:10,page:1}),[p,y]=c.useState({page:1,limit:10}),m=z(),i=De(),{state:h}=i,[S]=c.useState(h&&h.isActiveTabSchedule?h.isActiveTabSchedule:!1),{data:C}=D({queryFn:()=>Qe(f.campaign_id||""),queryKey:[$.campaign,f.campaign_id]});c.useEffect(()=>{S&&a(E[3].key)},[h]),c.useEffect(()=>{m.invalidateQueries($.campaign,{refetchInactive:!0}),m.invalidateQueries("Total_Profile_Campaign",{refetchInactive:!0})},[]);const{data:g}=D({queryFn:()=>Ye({campaignId:f.campaign_id}),queryKey:["Total_Profile_Campaign",f.campaign_id]}),{data:n}=D({queryKey:[$.schedule,f.campaign_id,p],queryFn:()=>ue({campaign_id:f.campaign_id,...p}),refetchOnMount:!0,refetchOnWindowFocus:!0}),v=c.useMemo(()=>(E.forEach(b=>{b.key==="profile"&&(b.total=(g==null?void 0:g.data.total)||0),b.key==="schedule"&&(b.total=(n==null?void 0:n.total)||0)}),[...E]),[g==null?void 0:g.data.total,n==null?void 0:n.total]),k=async()=>{const b=f.campaign_id,{uuid:_}=Be("AUTH")||{},A=u.getFieldsValue(),{arrangementLayoutCol:M,arrangementLayoutRow:ae,automationProcess:R,delayOpen:P,screenScalePercent:qe}=A;M&&ae&&R&&P>=0&&qe?($e(`settings-${_}`,A),await Je({campaignId:b,input:x,settings:A}).then(W=>{W.data.type==="success"?d.success(W.data.title):W.data.type==="error"&&d.error(W.data.title)}).catch(W=>{d.error(W)})):d.error("Settings fields cannot be left blank.")};return e.jsxs(e.Fragment,{children:[e.jsx(ze,{tabs:v,defaultActiveKey:t,handleChangeTab:a}),e.jsxs("section",{className:"main",children:[e.jsx(Bt,{tabActive:t,campaign:C,arrayField:x,onSaveData:k,setOpenCreate:s}),e.jsxs("div",{className:`${t!=="profile"?"h-[calc(100vh-255px)]":"h-[calc(100vh-205px)]"} pb-[20px] overflow-auto`,children:[e.jsx("div",{style:{display:`${t==="input"?"block":"none"}`},children:e.jsx(ht,{campaign:C,arrayField:x,setArrayField:j})}),e.jsx("div",{style:{display:`${t==="profile"?"block":"none"}`},children:e.jsx(Mt,{campaign:C,filterProfile:o,setFilterProfile:r})}),e.jsx("div",{style:{display:`${t==="settings"?"block":"none"}`},children:e.jsx(At,{campaign:C,form:u})}),e.jsx("div",{style:{display:`${t==="schedule"?"block":"none"}`},children:e.jsx(ft,{filterSchedule:p,setFilterSchedule:y})})]}),e.jsx("div",{className:"h-[64px]",children:e.jsx(Dt,{tabActive:t,totalProfile:g==null?void 0:g.data.total,filterProfile:o,setFilterProfile:r,filterSchedule:p,setFilterSchedule:y})})]}),e.jsx($t,{open:l,setOpen:s,campaign:C})]})}export{Ya as default};
