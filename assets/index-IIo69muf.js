import{r as i,k as e,a$ as N,p as B,q as K,j as V,P as G}from"./index-CJvg638n.js";import{Q as v}from"./queryKey.const-4yptRpGc.js";import{u as R}from"./useQuery-DJ-tefVM.js";import{l as O,e as J,f as U}from"./automationService-CEnPLggJ.js";import{T as _}from"./index-w6IqrXlL.js";import{u as S}from"./useTranslation-DN-CYzVf.js";import{P as X}from"./Pagination-BX02S7D7.js";import{L as Y}from"./LogDetails-B69BUudc.js";import{u as k}from"./theme-D5S-1fEx.js";import{T as Z}from"./Table-Bf5fO8hA.js";import{B as j}from"./index-BAIjI0rE.js";import{I as A}from"./Icon-BaWGP5av.js";import{T as I}from"./index.esm-h0RGFkVu.js";import{c as ee}from"./compareVersion-JynyrHBx.js";import{F as y}from"./index-YCIRg4HO.js";import{M as te}from"./index-Cn7Yo5Hv.js";import{R as se,C as D}from"./row-C7cWNtLw.js";import{S as ae}from"./index-Wc0f9ZXJ.js";import{D as oe}from"./index-BFNDRBPM.js";import{T as re}from"./index-D8gngLx0.js";import{f as le}from"./index-BlXw00gF.js";import{T as g}from"./index-BXlHKc3j.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./LeftOutlined-_e4uGCQm.js";import"./responsiveObserver-BQm3ddGk.js";import"./TextArea-DBRPcsh0.js";import"./index-DC1DAWbZ.js";import"./index-4M1x7pR3.js";import"./EyeOutlined-B-Yk7nA6.js";import"./SearchOutlined-Bmw6m_pM.js";import"./addEventListener-0hYE1V1V.js";import"./DownOutlined-BgG6dx4I.js";import"./index-DwCW4jpE.js";import"./index-Db4idn_r.js";import"./Dropdown-DXC0sGt_.js";import"./index-BtoCM6cC.js";import"./PurePanel-BiIzqeBG.js";import"./extendsObject-EOfQw3bh.js";import"./EllipsisOutlined-DODEOrOr.js";import"./Overflow-eyj8oHJy.js";import"./collapse-C1MjllT7.js";import"./index-CWlqhW57.js";import"./gapSize-U1swVQyS.js";import"./index-DRCSt6Z6.js";import"./CheckOutlined-CxiWyKpb.js";import"./index-C2OfIzMU.js";function ie({filterState:t,setFilterState:s}){const[a,n]=i.useState(t.page),[l,d]=i.useState(t.limit),{t:c}=S(),p=(...h)=>{const[m,f]=h;n(m),d(f),s(u=>({...u,page:m,limit:f}))};i.useEffect(()=>{n(t.page),d(t.limit)},[t]);const{data:r}=R({queryFn:()=>O(t),queryKey:[v.scheduleProfileList,t]});return e.jsxs("div",{className:"w-full h-[65px] flex items-center justify-end mt-2 gap-x-[10px] pr-[20px]",children:[e.jsx("div",{children:e.jsx(_,{label:`${c("Total")} : ${r==null?void 0:r.data.data.meta.total}`})}),(r==null?void 0:r.data.data.content.length)>0&&e.jsx(X,{pageSize:isNaN(l)?10:l,current:a,pageSizeOptions:[15,20,50,100],total:r==null?void 0:r.data.meta.total,showQuickJumper:!0,showSizeChanger:!0,onChange:p,locale:{items_per_page:c("page"),jump_to:c("Go to"),page:c("Page")}})]})}const ne={"header-fixed":"_header-fixed_8q965_1"},ce=({columns:t,filterState:s,selectedRowKeys:a,setSelectedRowKeys:n})=>{const l=k(),d=i.useRef(null),[c]=N(),p=c.get("schedule"),{data:r,isLoading:h}=R({queryFn:()=>O({...s,schedule_id:p?Number(p):""}),queryKey:[v.scheduleProfileList,s],refetchOnMount:!0,refetchOnWindowFocus:!0}),f={selectedRowKeys:a,onChange:u=>{n(u)}};return e.jsx("div",{className:"w-full h-[calc(100vh-200px)] overflow-auto pr-4",children:e.jsx(Z,{style:{borderColor:l.borderNormal},className:`${ne["header-fixed"]} w-full`,rowSelection:f,columns:t,dataSource:(r==null?void 0:r.data.data.content)||[],rowKey:"id",loading:h,pagination:!1,ref:d,size:"large"})})};function me({item:t}){const[s]=S(),a=i.useContext($),n=l=>{l.stopPropagation(),a==null||a.setItemViewLog(!0),a==null||a.setScheduleId(t.id)};return e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsxs("div",{className:"cursor-pointer gap-x-1 flex items-center",onClick:l=>n(l),children:[e.jsx(A.IconWorkLogDetailFigma,{width:16,height:16}),e.jsx(_,{className:"!text-[14px]",label:s("Log Detail")})]})})}const de={1:{backgroundColor:"#6D6D6D",label:"Pending"},2:{backgroundColor:"#E0822D",label:"Running"},3:{backgroundColor:"#2CDE35",label:"Complete"},4:{backgroundColor:"#EF1517",label:"Error"}};function pe({status:t}){const s=de[t],a=(s==null?void 0:s.backgroundColor)||"",n=(s==null?void 0:s.label)||"";return e.jsx(_,{className:"px-3 py-1 rounded-[5px] text-white text-nowrap",style:{backgroundColor:a},label:n})}const ue=[{title:e.jsx(g,{className:"text-nowrap",title:"No.STT"}),align:"center",render:(t,s,a)=>{const n=s.page?s.page-1:0,l=s.limit||0;return n*l+a+1}},{title:e.jsx(g,{className:"text-nowrap",title:"Uuid"}),align:"center",render:(t,s)=>s.profile_uuid},{title:e.jsx(g,{className:"text-nowrap",title:"Name"}),align:"center",render:(t,s)=>s.profile_name},{title:e.jsx(g,{className:"text-nowrap",title:"Status"}),align:"center",render:(t,s)=>e.jsx(pe,{status:s.status})},{title:e.jsx(g,{className:"text-nowrap",title:"Start run time"}),align:"center",dataIndex:"start_run_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"End run time"}),align:"center",dataIndex:"end_run_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"Expected start time"}),align:"center",dataIndex:"start_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"End time"}),align:"center",dataIndex:"end_time",render:t=>t},{title:e.jsx(g,{className:"text-nowrap",title:"Operation"}),fixed:"right",align:"center",render:t=>e.jsx(me,{item:t})}],xe=({filterState:t,setFilterState:s,selectedRowKeys:a,setSelectedRowKeys:n})=>{const l=k(),[d,c]=i.useState(!1),[p]=N(),[r,h]=i.useState(p.get("campaign")),[m]=y.useForm(),f=B(),{message:u}=K.useApp(),b=V(),{t:o}=S(),q=window.api.APP_VERSION,[T,P]=i.useState(!1);i.useEffect(()=>{h(p.get("campaign"))},[p.get("campaign")]);const M=()=>{s(x=>({...x,page:1,limit:15,status:void 0,startTime:void 0})),m.setFieldValue("status",void 0),m.setFieldValue("startTime",void 0),c(!1)};i.useEffect(()=>{const x=ee(q,"4.0.14");P(x!==-1)},[]);const z=()=>{const x=m.getFieldsValue(),C=x.status,E=x.startTime;s(w=>({...w,page:1,status:C,startTime:E})),c(!1)},H=async()=>{await J({ids:a}).then(()=>{n([]),b.invalidateQueries(v.scheduleProfileList),u.success(o("Deleted success")+"!")}).catch(x=>{u.error(x)})},F=async()=>{const x="work_log_"+le(new Date,"dd_MM_yyyy_HH_mm_ss")+".csv",C={limit:1e4,page:1,status:t.status,startTime:t.startTime};await U({rowSelected:a,filter:C}).then(w=>{const Q={data:w.data,fileName:x};window.api.exportFile(Q).then(W=>{W&&u.success(o("Export Success")+"!")})}).catch(w=>{u.error(w.data.title)})};return e.jsxs("div",{className:"w-full flex gap-x-[10px] py-[10px]",children:[r!==null&&e.jsx(j,{classStyle:"!h-[35.5px] mb-1 w-fit",typebutton:"warning",label:o("Back to campaign"),onClick:()=>f(`${G.campaign}/${r}`,{state:{isActiveTabSchedule:!0}})}),e.jsx(j,{onClick:()=>c(!0),classStyle:"!h-[35.5px] mb-1 w-fit",typebutton:"primary",solid:!0,label:e.jsxs("div",{className:"flex flex-row justify-center items-center gap-x-[5px] !text-[14px] !font-[500]",children:[e.jsx(A.IconFilterFigma,{width:"1em",height:"1em",color:"#ffffff"}),o("Filter work log")]})}),a.length>0?e.jsxs("div",{className:"flex gap-x-[10px]",children:[T&&e.jsx(j,{onClick:()=>F(),classStyle:"!h-[35.5px] mb-1 w-fit",typebutton:"primary",label:e.jsxs("div",{className:"flex flex-row justify-center items-center gap-x-[5px] !text-[14px] !font-[500]",children:[e.jsx(I,{}),o("Export")]})}),e.jsx(j,{classStyle:"!h-[35.5px] mb-1 w-fit",typebutton:"error",label:`${o("Delete")} ${a.length} ${a.length>1?o("work logs"):o("work log")}`,onClick:H})]}):T&&e.jsx(j,{onClick:()=>F(),classStyle:"!h-[35.5px] mb-1 w-fit",typebutton:"primary",solid:!0,label:e.jsxs("div",{className:"flex flex-row justify-center items-center gap-x-[5px] !text-[14px] !font-[500]",children:[e.jsx(I,{}),o("Export all")]})}),e.jsx(te,{title:e.jsx("div",{className:"text-[20px]",style:{color:l.textActiveNormal},children:o("Filter work log")}),open:d,onCancel:()=>c(!d),onOk:()=>m.submit(),footer:[e.jsxs("div",{className:"flex justify-end gap-x-5",children:[e.jsx(j,{onClick:M,label:o("Reset"),typebutton:"error",solid:!0},1),e.jsx(j,{typebutton:"primary",onClick:()=>m.submit(),label:o("Filter"),solid:!0},2)]},1)],children:e.jsx(y,{onFinish:z,form:m,layout:"vertical",className:"max-h-[700px] overflow-y-scroll overflow-x-hidden pr-[2px]",initialValues:{status:t.status,createdDate:t.createdDate},children:e.jsxs(se,{gutter:8,children:[e.jsx(D,{span:24,children:e.jsx(y.Item,{label:e.jsx(L,{label:o("Status")}),name:"status",children:e.jsx(ae,{allowClear:!0,placeholder:o("Select status"),options:[{value:"1",label:o("Pending")},{value:"2",label:o("Running")},{value:"3",label:o("Complete")},{value:"4",label:o("Error")}]})})}),e.jsx(D,{span:24,children:e.jsx(y.Item,{label:e.jsx(L,{label:o("Start date")}),name:"startTime",children:e.jsx(oe.RangePicker,{className:"w-full"})})})]})})})]})},L=({label:t})=>e.jsx(re.Text,{className:"font-semibold text-[14px]",children:t}),$=i.createContext(void 0);function nt(){const t=k(),s=V(),[a]=N(),[n,l]=i.useState({page:1,limit:15,schedule_id:"",status:void 0,startTime:void 0}),[d,c]=i.useState(!1),[p,r]=i.useState(0),[h,m]=i.useState([]);i.useEffect(()=>{window.electron.ipcRenderer.on("campaign_reload",()=>{s.invalidateQueries(v.scheduleProfileList)});const u=a.get("schedule");return l(b=>({...b,schedule_id:u||""})),()=>window.electron.ipcRenderer.removeAllListeners("campaign_reload")},[]),i.useEffect(()=>{a.get("schedule")||l(b=>({...b,schedule_id:""}))},[a.get("schedule")]);const f={scheduleId:p,setScheduleId:r,itemViewLog:d,setItemViewLog:c};return e.jsxs($.Provider,{value:f,children:[e.jsx(xe,{filterState:n,setFilterState:l,selectedRowKeys:h,setSelectedRowKeys:m}),e.jsx("div",{id:"table-hidemium",className:"h-[calc(100vh-200px)] mr-5 rounded-lg border border-solid shadow-sm overflow-auto",style:{backgroundColor:t.backgroundLight,borderColor:t.borderNormal},children:e.jsx(ce,{columns:ue,filterState:n,selectedRowKeys:h,setSelectedRowKeys:m})}),e.jsx(ie,{filterState:n,setFilterState:l}),e.jsx(Y,{open:!!d,setOpen:()=>c(!d),id:p,showVariable:!1})]})}export{$ as ProfilesCampContext,nt as default};
