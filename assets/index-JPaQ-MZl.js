import{i as F,b7 as O,b8 as P,b9 as D,ba as K,r as u,q as L,j as H,k as e,w as M}from"./index-rD5D3wIe.js";import{B as y}from"./index-Cnfr_LhE.js";import{Q as o}from"./queryKey.const-4yptRpGc.js";import{D as A}from"./DeleteConfirmModal-DSBDXsxU.js";import{a as q}from"./commonHelpers-BOkgPZYN.js";import{u as j}from"./useTranslation-CdVDZguR.js";import{F as U}from"./index-C7QdTRRe.js";import{T as g}from"./index-e-kTAu8U.js";import{H as z}from"./HeaderContext-BALBRazG.js";import{u as E}from"./theme-CwYL3eQV.js";import{u as Q}from"./useQuery-DGelT77v.js";import{P as W}from"./Pagination-Du9klKsI.js";import{T as B}from"./Table-CkCjhjFV.js";import"./commonjsHelpers__-BosuxZz1.js";import"./index-bFDahTXa.js";import"./gapSize-U1swVQyS.js";import"./index-WqkPP-4X.js";import"./index-VaFpLiuL.js";import"./index-BUNugdcr.js";import"./TextArea-D8GM8mUo.js";import"./CheckOutlined-CxcD5R4P.js";import"./index-CwHt7GoT.js";import"./index-DduQbOjH.js";import"./PurePanel-CzAY4fQy.js";import"./index-R7zUTNyO.js";import"./EyeOutlined-D2K23cwb.js";import"./SearchOutlined-DPpNmpde.js";import"./row-D9yJnvb0.js";import"./responsiveObserver-CoLEQsUO.js";import"./index-Phk2fyGs.js";import"./EllipsisOutlined-Cvv2ECO7.js";import"./Overflow-wzPxOxK8.js";import"./PlusOutlined-02efxpe5.js";import"./Dropdown-BA274VvY.js";import"./utils-Dji2qSVF.js";import"./LeftOutlined-hwnj7f46.js";import"./index-Cw8dqNCZ.js";import"./DownOutlined-U_yyBD4s.js";import"./addEventListener-Dnrwfmdl.js";import"./index-C97G-hLo.js";import"./index-c2ufQ9kY.js";import"./extendsObject-BTpHJDoQ.js";import"./collapse-C1MjllT7.js";import"./index-DEeuvegC.js";import"./index-Rll6gE4e.js";const k=async t=>await F.get(O,{params:t}),$=async t=>await F.delete(P,{data:{transfer_uuid:t}}),J=async t=>await F.post(D,{transfer_uuid:t}),V=async t=>await F.delete(K,{data:{transfer_uuid:t}}),C=u.createContext({confirmAccept:async t=>{},confirmCancel:async t=>{},confirmReject:async t=>{},selectedRowKeys:[],setSelectedRowKeys:t=>{},filterState:{},setFilterState:t=>{},activeType:"receive",setActiveType:t=>{}}),G={page:1,limit:10,search:"",option:"receive"},X={isOpenFilter:!1,dataFilter:G};function Y({children:t}){const{modal:r,message:s}=L.useApp(),a=H(),[l,c]=u.useState([]),[p,d]=u.useState(X),[f,h]=u.useState("receive"),x=async n=>{A().then(async i=>{i.isConfirmed&&await R(n)})},R=async n=>{await J(n).then(i=>{s.success("Accept success"),c([""]),a.invalidateQueries(o.transfer),a.invalidateQueries(o.listProfile,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_CLOUD,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_SHARE_WITH_ME,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_OWNER,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_SHARE,{refetchInactive:!0}),a.invalidateQueries(o.userDetail,{refetchInactive:!0})}).catch(i=>{console.log(i),s.error(i.response.data.title)})},v=async n=>{A().then(async i=>{i.isConfirmed&&await S(n).then(b=>{a.invalidateQueries(o.transfer),a.invalidateQueries(o.listProfile,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_CLOUD,{refetchInactive:!0}),a.invalidateQueries(o.PROFILE_SHARE_WITH_ME,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_OWNER,{refetchInactive:!0}),a.invalidateQueries(o.FOLDER_SHARE,{refetchInactive:!0}),a.invalidateQueries(o.userDetail,{refetchInactive:!0})})})},S=async n=>{await $(n).then(i=>{s.success("Cancel success"),c([""]),a.invalidateQueries(o.transfer)}).catch(i=>{console.log(i),s.error(i.response.data.title)})},w=async n=>{A().then(async i=>{i.isConfirmed&&await T(n)})},T=async n=>{await V(n).then(i=>{s.success("Reject success"),c([""]),a.invalidateQueries(o.transfer)}).catch(i=>{console.log(i),s.error(i.response.data.title)})},m={confirmAccept:x,confirmCancel:v,confirmReject:w,selectedRowKeys:l,setSelectedRowKeys:c,filterState:p,setFilterState:d,activeType:f,setActiveType:h};return e.jsx(C.Provider,{value:m,children:t})}function Z({item:t}){const{activeType:r,confirmAccept:s,confirmCancel:a,confirmReject:l}=u.useContext(C),{t:c}=j();return e.jsx(e.Fragment,{children:e.jsxs(U,{gap:"10px",justify:"center",children:[r=="receive"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{type:"success",className:"flex items-center",onClick:()=>s([t.uuid]),label:c("Accept"),disabled:(t==null?void 0:t.status)!="waiting"}),e.jsx(y,{type:"error",danger:!0,className:"flex items-center",onClick:()=>l([t.uuid]),label:c("Reject"),disabled:(t==null?void 0:t.status)!="waiting"})]}),r=="send"&&e.jsx(e.Fragment,{children:e.jsx(y,{type:"error",danger:!0,className:"flex items-center",onClick:()=>a([t.uuid]),label:c("Cancel"),disabled:(t==null?void 0:t.status)!="waiting"})})]})})}const ee=[{color:"417AFF",id:"waiting",name:"Waiting"},{color:"2CDE35",id:"accept",name:"Accept"},{color:"F5841F",id:"cancel",name:"Cancel"},{color:"ef4444",id:"reject",name:"Reject"}];function te({data:t}){const r=u.useMemo(()=>ee.find(({id:a})=>a===t.status),[t]),{t:s}=j();return e.jsx(e.Fragment,{children:e.jsx(y,{type:"normal",solid:!1,style:{color:`#${(r==null?void 0:r.color)||""}`,borderColor:`#${(r==null?void 0:r.color)||""}`},className:"!cursor-default !h-[25px]",label:s((r==null?void 0:r.name)||"No status")})})}const I=[{title:e.jsx(g,{title:"Profiles"}),align:"center",dataIndex:"browsers"},{title:e.jsx(g,{title:"From"}),align:"center",dataIndex:"from_user"},{title:e.jsx(g,{title:"To"}),align:"center",dataIndex:"to_user"},{title:e.jsx(g,{title:"Status"}),align:"center",render:(t,r)=>e.jsx(te,{data:r})},{title:e.jsx(g,{title:"Created at"}),align:"center",render:(t,r)=>q(r.created_at)},{title:e.jsx(g,{title:"Action"}),fixed:"right",align:"center",render:t=>e.jsx(Z,{item:t})}],re=["No","Profiles","To","Status","Created at","Action"],ae=["No","Profiles","From","Status","Created at","Action"];function se({columns:t,setColumns:r}){const s=E(),[a,l]=u.useState("");M.useToken();const{selectedRowKeys:c,setFilterState:p,activeType:d,setActiveType:f,confirmAccept:h,confirmCancel:x,confirmReject:R}=u.useContext(C),{t:v}=j(),S=m=>p(n=>({...n,dataFilter:{...n.dataFilter,search:m}})),w=m=>{f(m),p(n=>({dataFilter:{...n.dataFilter,option:m}}))},T=[{key:"receive",title:v("Receive"),type:"receive",id:[]},{key:"send",title:v("Send"),type:"send",id:[]}];return u.useEffect(()=>{const m=I.filter(n=>{var i,b,_,N;if(console.log({col:n}),d=="receive")return ae.includes((b=(i=n.title)==null?void 0:i.props)==null?void 0:b.title);if(d=="send")return re.includes((N=(_=n.title)==null?void 0:_.props)==null?void 0:N.title)});r(m)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(z,{tabs:T,handleChangeTab:w,search:a,onSearch:S,defaultActiveKey:d,namePage:"Transfer"}),c.length?e.jsxs("div",{style:{backgroundColor:s.backgroundNormal},className:"flex gap-x-3 !min-h-[55px] items-center py-2 rounded-md w-[calc(100%-4px)] overflow-x-scroll no-scorllbar overflow-y-hidden",children:[d=="receive"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{buttonMenu:!0,icon:"",label:v("Accept"),onClick:()=>h(c),type:"primary"},1),e.jsx(y,{buttonMenu:!0,icon:"",label:v("Reject"),onClick:()=>R(c),type:"error"},2)]}),d=="send"&&e.jsx(e.Fragment,{children:e.jsx(y,{buttonMenu:!0,icon:"",label:"Cancel",onClick:()=>x(c),type:"error"},2)})]}):""]})}function ne(){const{t}=j(),{filterState:r,setFilterState:s}=u.useContext(C),a=(...c)=>{const[p,d]=c;s(f=>({...f,dataFilter:{...f.dataFilter,page:p,limit:d}}))},{data:l}=Q({queryFn:()=>k(r.dataFilter),queryKey:[o.transfer,r.dataFilter]});return e.jsx("div",{className:"w-full p-4 text-end z-10",children:e.jsx(W,{pageSize:r.dataFilter.limit,current:r.dataFilter.page,pageSizeOptions:[10,20,50,100],total:(l==null?void 0:l.data.meta.total)||0,showQuickJumper:!0,onChange:a,showSizeChanger:!0,showTitle:!1,locale:{items_per_page:t("page")}})})}const ie={"header-fixed":"_header-fixed_8q965_1"};function oe({columns:t}){E();const{filterState:r,selectedRowKeys:s,setSelectedRowKeys:a}=u.useContext(C),{data:l,isFetching:c}=Q({queryFn:()=>k(r.dataFilter),queryKey:[o.transfer,r.dataFilter],onSuccess:f=>{const h=f.data.data.content.filter(x=>s.includes(x.uuid)).map(x=>x.uuid);a(h)}}),d={selectedRowKeys:s,onChange:f=>{a(f)}};return e.jsx("div",{className:"w-full overflow-auto",children:e.jsx(B,{rowSelection:d,className:`${ie["header-fixed"]}`,columns:t,rowKey:"uuid",loading:{spinning:c},rowClassName:(f,h)=>h===3?"scroll-row":"",dataSource:(l==null?void 0:l.data.data.content)||[],pagination:!1})})}function Ze(){const[t,r]=u.useState(I),s=E();return e.jsx(e.Fragment,{children:e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col h-full pr-5",children:[e.jsxs("div",{className:"rounded-tl-md overflow-y-hidden flex flex-col relative w-full h-full",style:{backgroundColor:s.backgroundNormal},children:[e.jsx(se,{columns:t,setColumns:r}),e.jsx("div",{id:"table-hidemium",className:"h-[calc(100vh-195px)] mr-5 rounded-lg border border-solid shadow-sm overflow-auto",style:{backgroundColor:s.backgroundLight,borderColor:s.borderNormal},children:e.jsx(oe,{columns:t})})]}),e.jsx(ne,{})]})})})}export{Ze as default};
