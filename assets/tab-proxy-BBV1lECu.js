import{r as u,A as De,h as We,k as e,ab as E,q as He,n as me,v as Ue,ar as Ye,g7 as Ve,N as R,i as he,U as Xe,g8 as Ke,g9 as xe,as as $e,s as Ge}from"./index-CJvg638n.js";import{u as fe}from"./useMutation-DtMNI5dJ.js";import{u as B}from"./useQuery-DJ-tefVM.js";import{a as ze,b as ye,B as Qe,T as U,P as Y,c as Je,d as ge,H as je,D as Ze,r as X,h as et,e as tt}from"./FormAddProxy-BdaFLVrk.js";import{P as S,a as rt,S as st}from"./SelectProxy-CDsaHMfo.js";import{S as Pe}from"./index-DlIx43FQ.js";import{i as ot,g as it,e as nt}from"./proxyService-B9Fwkvet.js";import{C as Z,a as be}from"./index-CYbll2wk.js";import{Q as N}from"./queryKey.const-4yptRpGc.js";import{b as O,d as ct,S as at}from"./style-DB2luWnx.js";import{g as ve,B as lt}from"./index-BsLpTvdc.js";import{u as ee}from"./useTranslation-DN-CYzVf.js";import{T as Se}from"./index-D8gngLx0.js";import{F as i}from"./index-YCIRg4HO.js";import{S as I}from"./index-Wc0f9ZXJ.js";import{g as ut}from"./auth-8cqRmsX-.js";import{T as dt}from"./index-BtoCM6cC.js";import{R as J,C as A}from"./row-C7cWNtLw.js";import{I as w}from"./index-4M1x7pR3.js";import{F as pt}from"./index-jmQoDNPY.js";import{T as mt}from"./index-BDCr05r-.js";import"./__commonjsHelpers__-BosuxZz1.js";import"./utils-Dji2qSVF.js";import"./index-DFACeEYN.js";import"./styled-components.browser.esm-BGP0i3rt.js";import"./index-DwCW4jpE.js";import"./index-Db4idn_r.js";import"./compareVersion-JynyrHBx.js";import"./index-DRCSt6Z6.js";import"./index-DFE2wc1V.js";import"./theme-D5S-1fEx.js";import"./index-Cn7Yo5Hv.js";import"./PurePanel-BiIzqeBG.js";import"./index-Bsl0EBBv.js";import"./index-BAIjI0rE.js";import"./DeleteConfirmModal-CCC5Ho8A.js";import"./index-TvTBJWU5.js";import"./index-DYrGpNsa.js";import"./EyeOutlined-B-Yk7nA6.js";import"./addEventListener-0hYE1V1V.js";import"./LeftOutlined-_e4uGCQm.js";import"./index-w6IqrXlL.js";import"./commonHelpers-BOkgPZYN.js";import"./rightMenuStyle.module-BozsqzbR.js";import"./index-D7PKG-E_.js";import"./index-DC1DAWbZ.js";import"./index-IXrIs-M6.js";import"./extendsObject-EOfQw3bh.js";import"./EllipsisOutlined-DODEOrOr.js";import"./Overflow-eyj8oHJy.js";import"./collapse-C1MjllT7.js";import"./responsiveObserver-BQm3ddGk.js";import"./Pagination-BX02S7D7.js";import"./TextArea-DBRPcsh0.js";import"./index-DXD2j7QG.js";import"./HeaderContext-CcFwS_UE.js";import"./index-BXlHKc3j.js";import"./Table-Bf5fO8hA.js";import"./DownOutlined-BgG6dx4I.js";import"./Dropdown-DXC0sGt_.js";import"./index-CWlqhW57.js";import"./gapSize-U1swVQyS.js";import"./SearchOutlined-Bmw6m_pM.js";import"./index-DGGwne6Z.js";import"./PlusOutlined-B9MlVXp_.js";import"./useModal-pIzqwJ6J.js";import"./Icon-BaWGP5av.js";import"./index-D1UX2WDf.js";import"./index-YXUFDw_N.js";import"./progress-BUBdB7Z0.js";import"./CheckOutlined-CxiWyKpb.js";import"./index-CSeHG7AI.js";import"./Skeleton-BvlGcf7B.js";import"./index-BlXw00gF.js";import"./index-C2OfIzMU.js";var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};const xt=ht;var ft=function(c,h){return u.createElement(De,We({},c,{ref:h,icon:xt}))},yt=u.forwardRef(ft);const gt=yt;function jt({type:o,proxyTab:c}){const{t:h}=ee(),{data:j,isFetching:K}=B({queryFn:()=>ve(),queryKey:[N.getListHidemiumProxy]}),T=u.useMemo(()=>{const y=(j==null?void 0:j.content.filter(b=>!b.is_expired))||[];if(c===S.HIDEMIUM_PROXY&&!y.some(b=>b.id===o)){const b=j==null?void 0:j.content.find($=>$.id===o);b&&y.push(b)}return y},[j,o,c]);return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(lt,{})}),e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(Se.Text,{strong:!0,children:h("Name")})}),e.jsx(i.Item,{name:"type",rules:[{required:!0,message:"This field is required"}],children:e.jsx(I,{loading:K,options:(T||[]).map(y=>({...y,label:y.name+(y.is_expired?`(${h("Expired")})`:""),value:y.id}))})})]})}const Pt=u.memo(jt),_e=E.sortBy(E.uniqBy(Z,"value"),[o=>o.label]);function bt(){var ce,ae;const[o]=i.useForm(),c=i.useWatch("type",o),h=i.useWatch("country",o),j=i.useWatch("state",o),K=i.useWatch("city",o),T=i.useWatch("formatProxy",o),y=i.useWatch("ipAddress",o),b=i.useWatch("port",o),$=i.useWatch("username",o),Ie=i.useWatch("pass",o),ke=i.useWatch("checker",o),V=i.useWatch("checkBeforeStart",o),{message:G}=He.useApp(),k=u.useRef(null),{proxy:q,isUpdate:we,proxyTab:x}=me(t=>t.newProfile),{is_Local:te}=me(t=>t.display),Te=u.useRef(q),{Text:d}=Se,{t:n}=ee(),L=u.useRef("NEW"),{data:z}=B({queryKey:[N.userDetail],queryFn:ut}),Ce=((ae=(ce=z==null?void 0:z.data)==null?void 0:ce.content)==null?void 0:ae.uuid)||"",{data:Fe}=B({queryFn:()=>ot(),queryKey:[N.checkIpLocal]});u.useEffect(()=>{M(null),L.current="NEW",k.current=null,Q()},[c,h,j,K,T,y,b,$,Ie,ke,V]),u.useEffect(()=>()=>{h&&o.setFieldValue("state","")},[h]),u.useEffect(()=>{if(T){const t=ze(T||"");t&&o.setFieldsValue(t)}},[T]);const[C,M]=u.useState(null),{data:P}=B({queryFn:it,queryKey:[N.proxyConfig]}),{data:_}=B({queryFn:()=>E.isNumber(c)&&!(P!=null&&P.some(t=>t.id===c))?ye(c):null,queryKey:[N.proxyConfig,c]}),D=u.useMemo(()=>{const t=(P==null?void 0:P.map(r=>({...r,label:r.name,value:r.id})))||[];return _&&!t.some(r=>r.value===(_==null?void 0:_.id))&&t.push({..._,label:_.name,value:_.id}),t},[P,_]),p=u.useMemo(()=>D==null?void 0:D.find(t=>t.id===Number(c)),[c,D]),Re=u.useMemo(()=>!(Qe.includes(c)||(p==null?void 0:p.type)===U.api||c===Y.Without_proxy),[c,p]),{data:m}=B({queryFn:()=>ve(),queryKey:[N.getListHidemiumProxy]}),Oe=u.useMemo(()=>{const t=(m==null?void 0:m.content.filter(r=>!r.is_expired))||[];if(x===S.HIDEMIUM_PROXY&&!t.some(r=>r.id===c)){const r=m==null?void 0:m.content.find(a=>a.id===c);r&&t.push(r)}return t},[m,c,x]),{isLoading:re,mutate:se}=fe({mutationFn:async t=>{var a,l,f,g,v,le,ue,de,pe;if(!t.type)return he.post("check-proxy",{});const r={urlcheck:t.checker,host:t.ipAddress,port:t.port,username:t.username,password:t.pass,typeProxy:t.type};if(!isNaN(Number(t.type))){let s=P.find(F=>F.id===t.type);if(s||(s=m==null?void 0:m.content.find(F=>F.id===Number(t.type))),s||(s=await ye(t.type)),!s){G.error("Proxy config not found");return}if((a=s.config)!=null&&a.type_service&&(s.config.user=(f=s.config)==null?void 0:f.user.replaceAll("{username}",(l=s.config)==null?void 0:l.user_format),s.config.pass=(v=s.config)==null?void 0:v.pass.replaceAll("{password}",(g=s.config)==null?void 0:g.pass_format)),s.user_service)r.host=s.ip,r.port=s.port,r.typeProxy=s.type,s.user=s.user.replace("{username}",s.user_service||""),r.username=X(s.user,t),r.password=X(s.pass,t);else if(s&&s.type===U.rotation)r.host=s.config.ip,r.port=s.config.port,r.typeProxy=s.config.type,r.username=X(s.config.user,t),r.password=X(s.config.pass,t);else if(s&&s.type===U.api)try{const F={host:t==null?void 0:t.ipAddress,port:t==null?void 0:t.port,username:t==null?void 0:t.username,password:t==null?void 0:t.pass,config_host:(le=s==null?void 0:s.config)==null?void 0:le.ip,config_port:(ue=s==null?void 0:s.config)==null?void 0:ue.port,config_username:(de=s==null?void 0:s.config)==null?void 0:de.user,config_password:(pe=s==null?void 0:s.config)==null?void 0:pe.pass},{data:Me}=await Xe.get(s.config.url,{params:F}),H=et(Me);r.host=H.ip||t.ipAddress||s.config.ip,r.port=H.port||t.port||s.config.port,r.typeProxy=H.type||s.config.type,r.username=H.user||t.username||s.config.user,r.password=H.pass||t.pass||s.config.pass}catch{return Promise.reject(`Request to ${s.config.url} error`)}}return!r.host||!r.port?Promise.reject("Proxy invalid!"):he.post("check-proxy",r)},onSuccess:({data:t})=>{L.current="LIVE",M(t),W(Ke(t)),W(xe(t)),Q(t)},onError:t=>{L.current="DIE",console.log({error:t}),G.error("Invalid proxy!"),M(null),Q()}}),oe=u.useMemo(()=>{const t=be.filter(r=>r.country_code===h);return E.sortBy(E.uniqBy(t,"value"),[r=>r.label])},[h]),ie=t=>{var r,a,l;return{type:(t==null?void 0:t.proxy_config_id)||(t==null?void 0:t.type)||Y.Without_proxy,country:((r=t==null?void 0:t.info)==null?void 0:r.country)||"",state:((a=t==null?void 0:t.info)==null?void 0:a.state)||"",city:((l=t==null?void 0:t.info)==null?void 0:l.city)||"",formatProxy:"",ipAddress:(t==null?void 0:t.ip)||"",port:(t==null?void 0:t.port)||"",username:(t==null?void 0:t.user)||"",pass:(t==null?void 0:t.pass)||"",checker:"multibrowser.io",checkBeforeStart:t.checkBeforeStart??!0}};u.useEffect(()=>{const t=E.cloneDeep(q);o.setFieldsValue(ie(t))},[]);const Ae=()=>{o.setFieldsValue({type:Y.Without_proxy,country:"",state:"",city:"",formatProxy:"",ipAddress:"",port:"",username:"",pass:"",checker:"multibrowser.io"}),W(xe(Fe))},{isLoading:Be,mutate:Ne}=fe({mutationFn:()=>nt(te),onSuccess:({data:t})=>{var a,l,f;const r=t.content.pop();r&&(o.setFieldsValue({type:r.proxy_config_id?r.proxy_config_id:r.type,country:((a=r==null?void 0:r.info)==null?void 0:a.country)||"",state:((l=r==null?void 0:r.info)==null?void 0:l.state)||"",city:((f=r==null?void 0:r.info)==null?void 0:f.city)||"",formatProxy:"",ipAddress:r.ip,port:r.port,username:r.user,pass:r.pass,checker:"multibrowser.io"}),setTimeout(()=>{k.current=r,M(null)}))}}),Ee=t=>{o.setFieldsValue(ie(t)),M(null),setTimeout(()=>k.current=t)},ne=async t=>{var a;const r=await o.validateFields().catch(()=>null);if(r)if(t==="CHECK"){let l=r;if(r.country==="random"&&(l.country=Z[Math.floor(Math.random()*Z.length)+1].value),r.state==="random"){let f=be.filter(g=>g.country_code===l.country);l.state=((a=f[Math.floor(Math.random()*f.length)+1])==null?void 0:a.value)||null}se(l)}else se({urlcheck:"multibrowser.io"})},qe=async t=>{var a,l,f;const r=await o.validateFields().catch(()=>null);if(r){if(c===Y.Without_proxy)return{...$e.proxy,checkBeforeStart:V};if(k.current){const g={...k.current,id:(a=Te.current)==null?void 0:a.uuid,checkBeforeStart:V,status:L.current};return(f=(l=k.current)==null?void 0:l.proxy_config)!=null&&f.proxy_type&&(g.type=k.current.proxy_config.proxy_type),delete g.uuid,g}else{const g=L.current,v={...r,id:q==null?void 0:q.uuid,ip:r.ipAddress,details:t||C||tt,user:r.username,info:{country:r.country,state:r.state,city:r.city},status:g,checkBeforeStart:V};return x===S.HIDEMIUM_PROXY?(v.proxy_config_id=Number(r.type),v.type="hidemium_proxy"):p&&(v.proxy_config_id=p.id,v.type=p.type),v}}},W=Ue(),Q=async t=>{const r=await qe(t);r&&W(Ye({key:"proxy",value:r}))};u.useEffect(()=>()=>{o.resetFields(["ip","port","user","pass","country","state","city"])},[x]);const Le=()=>{const t=o.getFieldsValue(),r={tab:x,...t};if(!isNaN(t.type)){const a=[...(m==null?void 0:m.content)||[],...P||[]].find(l=>l.id===t.type);a?(r.type=a.type,r.proxy_config_id=a.id,x==="HIDEMIUM_PROXY"&&(r.type="hidemium_proxy")):r.proxy_config_id=null}Ge(`DEFAULT_PROXY_${Ce.replaceAll("-","")}`,r),G.success(n("Success: Use this proxy for your next new profile."))};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(rt,{active:x,onChange:t=>{var r;W(Ve(t)),t===S.HIDEMIUM_PROXY?o.setFieldValue("type",(r=Oe[0])==null?void 0:r.id):t===S.YOUR_PROXY&&o.setFieldValue("type","HTTP")}}),!we&&e.jsx(dt,{title:n("Make default proxy (Use this proxy for your next new profile)"),className:"ml-3",children:e.jsx(R,{icon:e.jsx(gt,{className:"cursor-pointer"}),onClick:Le})})]}),e.jsx(i,{form:o,children:e.jsxs(J,{gutter:12,children:[e.jsx(A,{span:12,className:"!pr-5",children:x===S.YOUR_PROXY?e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Proxy Type")})}),e.jsx(ct,{children:e.jsx(i.Item,{name:"type",rules:[{required:!0,message:"This field is required"}],children:e.jsx(I,{style:{width:"100%"},options:[...Je,...D]})})})]}),Re?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Country")})}),e.jsx(i.Item,{name:"country",children:e.jsx(I,{showSearch:!0,options:[{label:"Global",value:"random"},..._e],optionFilterProp:"label"})}),e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("State")})}),e.jsx(i.Item,{name:"state",children:e.jsx(I,{showSearch:!0,options:[{label:"Random",value:"random"},...oe]})}),e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("City")})}),e.jsx(i.Item,{name:"city",children:e.jsx(w,{})})]}):c!==Y.Without_proxy?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Format Proxy")})}),e.jsx(i.Item,{name:"formatProxy",children:e.jsx(w,{})}),e.jsxs(J,{gutter:16,children:[e.jsxs(A,{span:12,children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("IP address")})}),e.jsx(i.Item,{name:"ipAddress",rules:(p==null?void 0:p.type)!==U.api?[{required:!0,message:"This field is required!"}]:[],children:e.jsx(w,{placeholder:"192.168.2.2"})})]}),e.jsxs(A,{span:12,children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Port")})}),e.jsx(i.Item,{name:"port",rules:(p==null?void 0:p.type)!==U.api?[{required:!0,message:"This field is required!"},ge]:[ge],children:e.jsx(w,{placeholder:"1111"})})]})]}),e.jsxs(J,{gutter:16,children:[e.jsxs(A,{span:12,children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Username")})}),e.jsx(i.Item,{name:"username",children:e.jsx(w,{})})]}),e.jsxs(A,{span:12,children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Password")})}),e.jsx(i.Item,{name:"pass",children:e.jsx(w,{})})]})]})]}):null,e.jsxs(O,{children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Check Proxy Host")})}),e.jsx(i.Item,{name:"checker",rules:[{required:!0,message:"This field is required!"}],children:e.jsx(I,{showSearch:!0,options:je})})]}),e.jsx(O,{children:e.jsxs(pt,{justify:"end",gap:18,children:[e.jsx(st,{onSelect:Ee,onlyShowTab:te?"LOCAL":"CLOUD",children:e.jsx(R,{type:"primary",className:"rounded-[10px]",style:{boxShadow:"0px 0.275rem 0px rgb(199 166 51)",background:"rgba(250, 176, 5, 1)",border:"1px solid rgb(199 166 51)",color:"#fff",fontWeight:"500"},children:n("Select")})}),e.jsx(R,{type:"primary",onClick:()=>Ne(),loading:Be,className:"rounded-[10px]",style:{boxShadow:"0px 0.275rem 0px rgb(61 130 185)",background:"rgba(20, 110, 190, 1)",border:"1px solid rgb(61 130 185)",color:"#fff",fontWeight:"500"},children:n("Random")}),e.jsx(R,{type:"primary",danger:!0,onClick:Ae,className:"rounded-[10px]",style:{boxShadow:"0px 0.275rem 0px rgb(185 70 70)",background:"rgba(224, 49, 49, 1)",border:"1px solid rgb(185 70 70)",color:"#fff",fontWeight:"500"},children:n("Delete")})]})}),e.jsx(at,{}),e.jsx(O,{children:e.jsx(i.Item,{name:"checkBeforeStart",valuePropName:"checked",children:e.jsx(Pe,{label:n("Check proxy before start profile")})})})]}):x===S.HIDEMIUM_PROXY?e.jsxs(e.Fragment,{children:[e.jsx(Pt,{type:c,proxyTab:x}),e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Country")})}),e.jsx(i.Item,{name:"country",children:e.jsx(I,{showSearch:!0,options:[{label:"Global",value:"random"},..._e],optionFilterProp:"label"})}),e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("State")})}),e.jsx(i.Item,{name:"state",children:e.jsx(I,{showSearch:!0,options:[{label:"Random",value:"random"},...oe]})}),e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("City")})}),e.jsx(i.Item,{name:"city",children:e.jsx(w,{})}),e.jsxs(O,{children:[e.jsx("div",{style:{paddingBottom:".5rem"},children:e.jsx(d,{strong:!0,children:n("Check Proxy Host")})}),e.jsx(i.Item,{name:"checker",rules:[{required:!0,message:"This field is required!"}],children:e.jsx(I,{showSearch:!0,options:je})})]}),e.jsx(O,{children:e.jsx(i.Item,{name:"checkBeforeStart",valuePropName:"checked",children:e.jsx(Pe,{label:n("Check proxy before start profile")})})})]}):null}),e.jsx(A,{span:12,children:e.jsxs("div",{className:"h-[500px] relative rounded-[10px] mt-2 shadow-[0_0_6px_0_#00000040]",children:[e.jsxs("div",{className:`${C?"shadow-[0_0.275rem_0_#0CA678] bg-white":"shadow-[0_0.275rem_0_#6D6D6D] bg-[#A6A6A6]"} ml-3 mr-3 mt-5 pb-4 pt-4 inline-block rounded-[16px]`,style:{width:"calc(100% - 24px)",border:` 1px solid var(${C?"--color-green-200":"--color-gray-200"})`},children:[e.jsxs(d,{className:`${C?"text-[#2263B3]":"text-white"} font-medium ps-[30px]`,children:[n("Detail Proxy"),":"]}),e.jsx("div",{className:"ps-[30px]",children:C&&e.jsx(Ze,{data:C})})]}),e.jsx("div",{className:"absolute bottom-[20px] right-[20px]",children:x===S.WITHOUT_PROXY?e.jsx(R,{type:"primary",loading:re,onClick:()=>ne("CHECK_LOCAL"),className:"rounded-[10px]",style:{boxShadow:"0px 0.275rem 0px rgb(116 99 165)",background:"rgba(103, 65, 217, 1)",border:"1px solid rgb(116 99 165)",color:"#fff",fontWeight:"500"},children:n("Check IP local")}):e.jsx(R,{type:"primary",loading:re,onClick:()=>ne("CHECK"),className:"rounded-[10px]",style:{boxShadow:"0px 0.275rem 0px rgb(116 99 165)",background:"rgba(103, 65, 217, 1)",border:"1px solid rgb(116 99 165)",color:"#fff",fontWeight:"500"},children:n("Check Proxy")})})]})})]})})]})}function Ur({active:o}){const{t:c}=ee(),h=[{key:"proxy",label:c("Proxy"),children:e.jsx(bt,{})}];return e.jsx("div",{style:{padding:"20px 24px",marginTop:"16px"},children:e.jsx(mt,{defaultActiveKey:"proxy",items:h})})}export{Ur as default};
